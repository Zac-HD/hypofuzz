var yt=Object.defineProperty;var jt=(s,r,t)=>r in s?yt(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var E=(s,r,t)=>jt(s,typeof r!="symbol"?r+"":r,t);import{r as wt,g as qe,a as h,u as Me,b as Nt,L as J,O as St,c as Ge,d as kt,H as At,e as Ct,f as Y,R as Rt}from"./react-DOgvK_Td.js";import{r as Et,S as U,F as P,f as Mt,a as Tt,b as Je,c as $t,d as Lt,L as Q,e as Pt,g as Ft,h as Bt,i as Dt,j as It,k as Ot,l as Ut,m as Vt,n as ae,o as oe,p as le,q as ce,s as zt,t as Qe,u as Ze,O as Wt}from"./vendor-BddXVpZ4.js";import{d as et,a as tt,b as st,c as Kt,o as nt,l as rt,q as Ht,e as Xt,f as Yt,g as qt,h as Gt,i as Jt,j as Qt,s as Zt}from"./d3-CO-FEQw9.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var je={exports:{}},te={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ie;function es(){if(Ie)return te;Ie=1;var s=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function t(n,i,a){var c=null;if(a!==void 0&&(c=""+a),i.key!==void 0&&(c=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:s,type:n,key:c,ref:i!==void 0?i:null,props:a}}return te.Fragment=r,te.jsx=t,te.jsxs=t,te}var Oe;function ts(){return Oe||(Oe=1,je.exports=es()),je.exports}var e=ts();Array.prototype.sortKey||(Array.prototype.sortKey=function(s){return this.sort((r,t)=>{const n=s(r),i=s(t);if(Array.isArray(n)&&Array.isArray(i)){for(let a=0;a<Math.min(n.length,i.length);a++){if(n[a]<i[a])return-1;if(n[a]>i[a])return 1}return 0}return n<i?-1:n>i?1:0})});var ss=wt();const ns=qe(ss);function Te(){const[s,r]=h.useState(!1);return h.useEffect(()=>{function t(){r(window.matchMedia("(max-width: 768px)").matches)}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),s}function re({value:s,onChange:r,options:t}){const n=Te();return e.jsx("div",{className:"scale-toggle",children:t.map(i=>e.jsx("button",{className:`scale-toggle__button${s===i.value?" scale-toggle__button--active":""}`,onClick:()=>{if(t.length==2&&s===i.value){const a=t.find(c=>c.value!==i.value).value;r(a)}else r(i.value)},children:n?i.mobileContent??i.content:i.content},String(i.value)))})}const it=h.createContext(null);function rs({state:s}){return s.visible?Nt.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${s.x+10}px`,top:`${s.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:s.content}}),document.body):null}function is({children:s}){const r=Me(),[t,n]=h.useState({visible:!1,content:"",x:0,y:0,owner:null});h.useEffect(()=>{n(o=>({...o,visible:!1,owner:null}))},[r.pathname]);const i=h.useCallback((o,l,d,m)=>{n({visible:!0,content:o,x:l,y:d,owner:m})},[]),a=h.useCallback(o=>{n(l=>l.owner===o?{...l,visible:!1,owner:null}:l)},[]),c=h.useCallback((o,l,d)=>{n(m=>m.visible&&m.owner===d&&(m.x!==o||m.y!==l)?{...m,x:o,y:l}:m)},[]),u=h.useMemo(()=>({showTooltip:i,hideTooltip:a,moveTooltip:c,visible:t.visible}),[i,a,c,t.visible]);return e.jsxs(it.Provider,{value:u,children:[s,e.jsx(rs,{state:t})]})}function $e(){const s=h.useContext(it);if(!s)throw new Error("useTooltip must be used within a TooltipProvider");return s}var as=Et();const ue=qe(as);function at(s,r=0){return Array.from(s).reduce((t,n)=>t+n,r)}function ot(s,r=!1){s.current&&(r&&s.current.querySelectorAll("code").forEach(t=>{t.removeAttribute("data-highlighted")}),s.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(t=>{ue.highlightElement(t)}))}function Ae(s,r){let t=null;for(let n=0;n<s.length;n++){const i=s[n],a=r?r(i):i;a!=null&&(t===null||a>t)&&(t=a)}return t}function we(s,r,t){let n=0,i=s.length;for(;n<i;){const a=n+i>>>1;(t?t(s[a])<=r:s[a]<=r)?n=a+1:i=a}return n}let se=null;function os(){return se||(se=document.createElement("div"),se.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(se)),se}function Ne(s,r=""){const t=os();t.className=r,t.textContent=s;const n=t.getBoundingClientRect();return{width:n.width,height:n.height}}function lt(s,r,t){if(s.metaKey||s.ctrlKey){const n=window.location,i=`${n.origin}${n.pathname}#${r}`;console.log(n.origin,n.pathname,r,i),window.open(i,"_blank")}else t(r)}function ct(s){return s.split("::").pop()||s}class ut{constructor(r,t,n,i){E(this,"createdAt");this.name=r,this.predicate=t,this.component=n,this.extraData=i,this.createdAt=Date.now()}}const dt=h.createContext(void 0);function ls({children:s}){const[r,t]=h.useState(new Map([["covering",new Map],["rolling",new Map]])),[n,i]=h.useState("covering"),a=r.get(n)||new Map,c=l=>{t(d=>{const m=new Map(d);return m.set(n,l),m})},o={filters:a,setFilters:c,removeFilter:(l,d)=>{const m=new Map(a),p=(m.get(l)||[]).filter(f=>f.name!==d);p.length===0?m.delete(l):m.set(l,p),c(m)},observationCategory:n,setObservationCategory:i};return e.jsx(dt.Provider,{value:o,children:s})}function xe(){const s=h.useContext(dt);if(s===void 0)throw new Error("useFilters must be used within a FilterProvider");return s}const H={select:et,scaleLinear:rt,scaleOrdinal:nt,scaleBand:Kt,axisBottom:st,axisLeft:tt},Ue=5,K=2.5;function cs({feature:s,observations:r}){const t=h.useRef(null),n=h.useRef(null),{filters:i,setFilters:a}=xe(),{showTooltip:c,hideTooltip:u,moveTooltip:o}=$e(),l=i.get(s)||[],d=h.useMemo(()=>{if(l.length===0)return U();console.assert(l.length===1);const p=l[0];return U(p.extraData.selectedValues)},[l]),m=h.useMemo(()=>({raw:r.raw.filter(p=>p.status!=="gave_up"),filtered:r.filtered.filter(p=>p.status!=="gave_up")}),[r]),x=p=>{let f=U();d.equals(U([p]))?f=U():f=U([p]);let b;f.size===1?b=f.first():b=f.map(C=>`${C}`).join(" or ");const w=[];f.size>0&&w.push(new ut(b,C=>f.some(M=>C.features.get(s)===M),s,{selectedValues:f}));const _=new Map(i);_.set(s,w),a(_)};return h.useEffect(()=>{const p=U(m.raw.map(y=>y.features.get(s)));let f=new Map;for(const y of m.filtered){const $=y.features.get(s);f.set($,(f.get($)||0)+1)}const b=at(Array.from(f.values()));f=new Map([...f.entries()].sortKey(([y,$])=>y===fe?0:y===_e?1:y)),H.select(n.current).selectAll("*").remove();const w=t.current.clientWidth,_=p.size<Ue?85:170,C=H.select(n.current).attr("width",w).attr("height",_).append("g"),M=function(y,$){const[j,v]=$;c(`${s}<br>${j}: ${v}`,y.clientX,y.clientY,"tyche-nominal")};if(p.size<Ue){const y={top:0,right:15,bottom:20,left:15},$=w-y.left-y.right,j=_-y.top-y.bottom,v=H.scaleLinear().domain([0,1]).range([0,$]);let S;f.has(fe)||f.has(_e)?S=I=>I===fe?O.SUCCESS:I===_e?O.ERROR:O.PRIMARY:S=H.scaleOrdinal().domain(Array.from(f.keys())).range([O.PRIMARY,O.ACCENT,O.ACCENT2,O.ACCENT3,O.ACCENT4]);const R=C.append("g").attr("transform",`translate(${y.left},${y.top})`);let k=0;const T=j-y.bottom;f.forEach((I,g)=>{const N=I/b*$,L=d.has(g);R.append("rect").attr("x",k).attr("y",0).attr("width",N).attr("height",T).attr("fill",S(g)).style("cursor","pointer").on("click",()=>x(g)).on("mouseover",F=>{M(F,[g,I])}).on("mousemove",F=>o(F.clientX,F.clientY,"tyche-nominal")).on("mouseleave",()=>u("tyche-nominal")),L&&R.append("rect").attr("x",k+K).attr("y",K).attr("width",N-2*K).attr("height",T-2*K).attr("fill",S(g)).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),R.append("text").attr("x",k+N/2).attr("y",T/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(g).style("font-size","12px"),k+=N}),R.append("g").attr("transform",`translate(0,${T})`).call(H.axisBottom(v).tickFormat(I=>`${Math.round(Number(I)*100)}%`)),R.append("text").attr("x",$/2).attr("y",T+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const y={top:5,right:5,bottom:30,left:30},$=w-y.left-y.right,j=_-y.top-y.bottom,v=H.scaleBand().domain(Array.from(f.keys())).range([0,$]).padding(.2),S=H.scaleLinear().domain([0,Ae(Array.from(f.values()))||0]).range([j,0]),R=C.append("g").attr("transform",`translate(${y.left},${y.top})`);R.selectAll(".bar").data(Array.from(f.entries())).enter().append("rect").attr("class","bar").attr("x",([k,T])=>v(k)||0).attr("y",([k,T])=>S(T)).attr("width",v.bandwidth()).attr("height",([k,T])=>j-S(T)).attr("fill",O.PRIMARY).style("cursor","pointer").on("click",function(k,[T,I]){x(T)}).on("mouseover",function(k,T){M(k,T)}).on("mousemove",k=>o(k.clientX,k.clientY,"tyche-nominal")).on("mouseleave",()=>u("tyche-nominal")),R.selectAll(".inner-bar").data(Array.from(f.entries()).filter(([k,T])=>d.has(k))).enter().append("rect").attr("class","inner-bar").attr("x",([k,T])=>(v(k)||0)+K).attr("y",([k,T])=>S(T)+K).attr("width",v.bandwidth()-2*K).attr("height",([k,T])=>j-S(T)-2*K).attr("fill",O.PRIMARY).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),R.append("g").attr("transform",`translate(0,${j})`).call(H.axisBottom(v)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),R.append("g").call(H.axisLeft(S).ticks(7).tickFormat(k=>Math.round(Number(k)).toString())),R.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-j/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}},[m]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:s}),e.jsx("div",{ref:t,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:n,style:{width:"100%"}})})]})}function Le({title:s,children:r,defaultState:t="open",onStateChange:n,headerClass:i="",contentClass:a=""}){const[c,u]=h.useState(t),o=()=>{const l=c==="open"?"closed":"open";u(l),n==null||n(l)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:o,children:[e.jsx("span",{className:"collapsible__toggle",children:c==="open"?e.jsx(P,{icon:Mt}):e.jsx(P,{icon:Tt})}),s]}),c==="open"&&e.jsx("div",{className:`${a}`,children:r})]})}function Pe({title:s,children:r,defaultState:t="open",onStateChange:n}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Le,{title:s,defaultState:t,onStateChange:n,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:r})})}function us({observations:s}){const r=new Set;return s.raw.forEach(t=>{for(const n of t.features.keys())n.startsWith("Retried draw from")||r.add(n)}),r.size===0?null:e.jsx(Pe,{title:"Features",children:Array.from(r).sort().map(t=>e.jsx(cs,{feature:t,observations:s}))})}function ds(){const{filters:s,removeFilter:r}=xe(),t=Array.from(s.values()).flat().sortKey(n=>n.createdAt);return t.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),t.map(n=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>r(n.component,n.name),children:e.jsx(P,{icon:Je})}),n.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:n.name})]},`${n.component}-${n.name}`))]})}function ht(s){const r=s.regex,t=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),n=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],u={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:n,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},o={className:"meta",begin:/^(>>>|\.\.\.) /},l={className:"subst",begin:/\{/,end:/\}/,keywords:u,illegal:/#/},d={begin:/\{\{/,relevance:0},m={className:"string",contains:[s.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[s.BACKSLASH_ESCAPE,o],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[s.BACKSLASH_ESCAPE,o],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[s.BACKSLASH_ESCAPE,o,d,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[s.BACKSLASH_ESCAPE,o,d,l]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[s.BACKSLASH_ESCAPE,d,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[s.BACKSLASH_ESCAPE,d,l]},s.APOS_STRING_MODE,s.QUOTE_STRING_MODE]},x="[0-9](_?[0-9])*",p=`(\\b(${x}))?\\.(${x})|\\b(${x})\\.`,f=`\\b|${n.join("|")}`,b={className:"number",relevance:0,variants:[{begin:`(\\b(${x})|(${p}))[eE][+-]?(${x})[jJ]?(?=${f})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${f})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${f})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${f})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${f})`},{begin:`\\b(${x})[jJ](?=${f})`}]},w={className:"comment",begin:r.lookahead(/# type:/),end:/$/,keywords:u,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},_={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:u,contains:["self",o,b,m,s.HASH_COMMENT_MODE]}]};return l.contains=[m,b,o],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:u,illegal:/(<\/|\?)|=>/,contains:[o,b,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},m,w,s.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,t],scope:{1:"keyword",3:"title.function"},contains:[_]},{variants:[{match:[/\bclass/,/\s+/,t,/\s*/,/\(\s*/,t,/\s*\)/]},{match:[/\bclass/,/\s+/,t]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[b,_,m]}]}}function Ve({currentPage:s,pageCount:r,onPageChange:t}){console.assert(r>1);function n(){return r<=7?Array.from({length:r},(o,l)=>l):s<=3?[0,1,2,3,4,"ellipsis",r-1]:s>=r-4?[0,"ellipsis",r-5,r-4,r-3,r-2,r-1]:[0,"ellipsis",s-1,s,s+1,"ellipsis",r-1]}const i=n();function a(o){typeof o=="number"&&s!==o&&t(o)}function c(){s>0&&t(s-1)}function u(){s<r-1&&t(s+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${s===0?"pagination__nav--disabled":""}`,onClick:c,children:e.jsx(P,{icon:$t})}),i.map((o,l)=>{if(o==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${l}`);const d=o===s;return e.jsx("div",{className:`pagination__number ${d?"pagination__number--current":""}`,onClick:()=>a(o),children:o+1},o)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${s===r-1?"pagination__nav--disabled":""}`,onClick:u,children:e.jsx(P,{icon:Lt})})]})}ue.registerLanguage("python",ht);const Se=30;function hs({observations:s,observationCategory:r}){const t=h.useRef(null),[n,i]=h.useState(0);h.useEffect(()=>{i(0)},[r]);function a(){t.current&&t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(l=>{ue.highlightElement(l)})}h.useEffect(()=>{a()},[s,n]);const c=new Map;s.filtered.forEach(l=>{const d=l.representation;c.set(d,(c.get(d)||0)+1)});const u=Math.ceil(c.size/Se),o=Array.from(c.entries()).sortKey(([l,d])=>-d).slice(n*Se,(n+1)*Se);return e.jsx(Pe,{title:"Textual representation",defaultState:"closed",onStateChange:l=>{l==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:t,children:[u>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(Ve,{currentPage:n,pageCount:u,onPageChange:i})}),o.map(([l,d])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:l})}),d>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",d]})]},l)),u>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(Ve,{currentPage:n,pageCount:u,onPageChange:i})})]})})}const ze=640;function ms({name:s,observations:r,verticalAxis:t,horizontalAxis:n,cssStyle:i=(a,c)=>({})}){const{filters:a,setFilters:c}=xe(),{showTooltip:u,hideTooltip:o,moveTooltip:l}=$e(),d=a.get(s)||[],m=h.useMemo(()=>{if(d.length===0)return U();console.assert(d.length===1);const g=d[0];return U(g.extraData.selectedCells)},[d]),x=[],p=Array(t.length).fill(0),f=Array(n.length).fill(0);let b=0;for(let g=0;g<t.length;g++){x[g]=[];for(let N=0;N<n.length;N++)x[g][N]={count:0,widthPercent:0}}r.filtered.forEach(g=>{for(let N=0;N<t.length;N++){const[,L]=t[N];if(L(g)){for(let F=0;F<n.length;F++){const[,z]=n[F];if(z(g)){x[N][F].count++,p[N]++,f[F]++,b++;break}}break}}});const w=p.map((g,N)=>g>0?N:null).filter(g=>g!==null),_=f.map((g,N)=>g>0?N:null).filter(g=>g!==null),C=(g,N)=>{let L=U();if(g!==null&&N!==null){const A=Q([g,N]);m.equals(U([A]))?L=U():L=U([A])}else g!==null?(console.assert(N===null),_.forEach(A=>{x[g][A].count>0&&(L=L.add(Q([g,A])))})):N!==null&&(console.assert(g===null),w.forEach(A=>{x[A][N].count>0&&(L=L.add(Q([A,N])))}));function F(){if(L.size===0)return"";let A=L;const W=[],de=[...w.map(D=>({name:t[D][0],cells:_.filter(V=>x[D][V].count>0).map(V=>Q([D,V]))})),..._.map(D=>({name:n[D][0],cells:w.filter(V=>x[V][D].count>0).map(V=>Q([V,D]))}))];for(const D of de)D.cells.length>0&&D.cells.every(V=>A.has(V))&&(W.push(D.name),A=A.subtract(U(D.cells)));for(;A.size>0;){const D=A.first(),[V,ye]=D.toArray();W.push(`${t[V][0]}+${n[ye][0]}`),A=A.delete(D)}return console.assert(A.size==0),W.join(" or ")}const z=[];L.size>0&&z.push(new ut(F(),A=>L.some(W=>{const[de,D]=W.toArray(),V=t[de][1],ye=n[D][1];return V(A)&&ye(A)}),s,{selectedCells:L}));const X=new Map(a);X.set(s,z),c(X)};if(w.length===0||_.length===0)return e.jsx("div",{children:"No observations"});const M=30,y=30,$=45*w.length;for(let g=0;g<t.length;g++)for(let N=0;N<n.length;N++)x[g][N].widthPercent=p[g]>0?x[g][N].count/p[g]*100:0;const v=w.map(g=>p[g]/b*$).map(g=>Math.max(g,y)),S=_.map((g,N)=>N===0?0:N===_.length-1?100:N/(_.length-1)*100),{rowHeaderWidth:R,columnHeaderHeight:k,rowTotalWidth:T}=h.useMemo(()=>({rowHeaderWidth:Math.max(...w.map(g=>Ne(t[g][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(..._.map(g=>Ne(n[g][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...w.map(g=>Ne(p[g].toString(),"tyche__mosaic__row-total").width))}),[w,_,t,n,p]),I=ze-R-T;return w.forEach(g=>{const N=_.map(F=>x[g][F]);if(N.reduce((F,z)=>F+z.widthPercent,0)>0){const z=N.map(A=>A.widthPercent/100*I).map((A,W)=>N[W].count>0&&A>0&&A<M?M:A),X=z.reduce((A,W)=>A+W,0);_.forEach((A,W)=>{x[g][A].widthPercent=X>0?z[W]/X*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${ze}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${R}px`,marginRight:`${T}px`,height:`${k}px`},children:_.map((g,N)=>{const L=N===0,F=N===_.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${S[N]}%`,transform:L?"translateX(0%)":F?"translateX(-100%)":"translateX(-50%)",textAlign:L?"left":F?"right":"center"},onClick:()=>C(null,g),children:n[g][0]},`header-${g}`)})}),w.map((g,N)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${v[N]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${R}px`,cursor:"pointer"},onClick:()=>C(g,null),children:t[g][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:_.map(L=>{const F=x[g][L];if(F.count===0)return null;const z=m.has(Q([g,L])),X=`${t[g][0]} and ${n[L][0]}<br>Count: ${F.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${z?" tyche__mosaic__cell--selected":""}`,style:{width:`${F.widthPercent}%`,minWidth:`${M}px`,minHeight:`${y}px`,...i(t[g][0],n[L][0])},onClick:()=>C(g,L),onMouseEnter:A=>u(X,A.clientX,A.clientY,"tyche-mosaic"),onMouseMove:A=>l(A.clientX,A.clientY,"tyche-mosaic"),onMouseLeave:()=>o("tyche-mosaic"),children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:F.count})},`cell-${g}-${L}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${T}px`},children:p[g]})]},`row-${g}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${k}px`},children:[e.jsx("div",{style:{width:`${R}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${T}px`},children:_.map((g,N)=>{const L=N===0,F=N===_.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${S[N]}%`,transform:L?"translateX(0%)":F?"translateX(-100%)":"translateX(-50%)",textAlign:L?"left":F?"right":"center"},children:f[g]},`total-${g}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${T}px`},children:b})]})]})}function ps({observations:s}){function r(t,n){const i={};return t==="Passed"?i.backgroundColor=O.SUCCESS:t==="Invalid"?i.backgroundColor=O.WARNING:t==="Failed"&&(i.backgroundColor=O.ERROR),n==="Duplicate"&&(i.opacity=.7),i}return e.jsx(Pe,{title:"Sample breakdown",children:e.jsx(ms,{name:"samples",observations:s,verticalAxis:[["Passed",t=>t.status==="passed"],["Invalid",t=>t.status==="gave_up"]],horizontalAxis:[["Unique",t=>t.isUnique??!1],["Duplicate",t=>t.isDuplicate??!1]],cssStyle:r})})}const fe="Present",_e="Not present";var O=(s=>(s.PRIMARY="#6b8ab5",s.SUCCESS="#8ba86b",s.WARNING="#d59a7e",s.ERROR="#c77a7e",s.ACCENT="#c1a2bb",s.ACCENT2="#9fc7c6",s.ACCENT3="#edd39a",s.ACCENT4="#99c7d6",s.ACCENT5="#8faac6",s))(O||{});function fs({test:s}){const{filters:r,observationCategory:t,setObservationCategory:n}=xe(),i=t==="rolling"?s.rolling_observations.sortKey(u=>-u.run_start):s.corpus_observations,a=h.useMemo(()=>{const u=Array.from(r.values()).flat();return u.length===0?i:i.filter(o=>u.every(l=>l.predicate(o)))},[i,r]),c={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:t,onChange:n,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx(ds,{}),c.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ps,{observations:c}),e.jsx(us,{observations:c}),e.jsx(hs,{observations:c,observationCategory:t})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function _s({test:s}){return e.jsx(ls,{children:e.jsx(fs,{test:s})})}class ve{withProperties(r){return Object.assign(Object.create(this.constructor.prototype),this,r)}}class G extends ve{constructor(r=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=r}static fromJson(r){const t=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[n,i]of Object.entries(r))console.assert(typeof i=="number"),t.set(Number(n),i);return new G(t)}add(r){const t=new Map(this.counts);for(const[n,i]of r.counts.entries())t.set(n,t.get(n)+i);return new G(t)}subtract(r){const t=new Map(this.counts);for(const[n,i]of r.counts.entries())t.set(n,t.get(n)-i);return new G(t)}sum(){return at(this.counts.values())}}var mt=(s=>(s[s.OVERRUN=0]="OVERRUN",s[s.INVALID=1]="INVALID",s[s.VALID=2]="VALID",s[s.INTERESTING=3]="INTERESTING",s))(mt||{});class be extends ve{constructor(t,n,i,a,c,u,o,l){super();E(this,"status_counts_diff");E(this,"elapsed_time_diff");E(this,"timestamp_monotonic");this.elapsed_time=t,this.timestamp=n,this.status_counts=i,this.behaviors=a,this.fingerprints=c,this.since_new_behavior=u,this.phase=o,this.worker_uuid=l,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(t,n){return new be(n.elapsed_time,n.timestamp,G.fromJson(n.status_counts),n.behaviors,n.fingerprints,n.since_new_behavior,n.phase,t)}}function We(s,r){const t=r?r.status_counts:new G,n=r?r.elapsed_time:0,i=s.status_counts.subtract(t),a=s.elapsed_time-n,c=r?Math.max(s.timestamp,r.timestamp_monotonic+a):s.timestamp;return console.assert(Array.from(i.counts.values()).every(u=>u>=0)),console.assert(a>=0),s.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:c})}class ee extends ve{constructor(t,n,i,a,c,u,o,l,d,m,x){super();E(this,"isDuplicate",null);E(this,"isUnique",null);this.type=t,this.status=n,this.status_reason=i,this.representation=a,this.arguments_=c,this.how_generated=u,this.features=o,this.timing=l,this.metadata=d,this.property=m,this.run_start=x}static fromJson(t){return new ee(t.type,t.status,t.status_reason,t.representation,new Map(Object.entries(t.arguments)),t.how_generated,new Map(Object.entries(t.features)),new Map(Object.entries(t.timing)),new Map(Object.entries(t.metadata)),t.property,Number(t.run_start))}}var ge=(s=>(s[s.FAILED=0]="FAILED",s[s.SHRINKING=1]="SHRINKING",s[s.RUNNING=2]="RUNNING",s[s.WAITING=3]="WAITING",s))(ge||{});const ie=class ie extends ve{constructor(t,n,i,a,c,u){super();E(this,"linear_reports");E(this,"_status_counts_cumsum");E(this,"_elapsed_time_cumsum");this.database_key=t,this.nodeid=n,this.rolling_observations=i,this.corpus_observations=a,this.failure=c,this.reports_by_worker=u,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map;const o=this.reports_by_worker;this.reports_by_worker=new Map;const l=Array.from(o.entries()).flatMap(([d,m])=>m.map(x=>[d,x])).sortKey(([d,m])=>m.timestamp);for(const[d,m]of l)this.add_report(d,m);this._check_invariants()}static fromJson(t){return new ie(t.database_key,t.nodeid,[],[],t.failure?ee.fromJson(t.failure):null,new Map(Object.entries(t.reports_by_worker).map(([n,i])=>[n,i.map(be.fromJson)])))}_assert_reports_ordered(t){for(let n=0;n<t.length-1;n++)console.assert(t[n].timestamp_monotonic<=t[n+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const t=this.linear_status_counts(null);for(let i=0;i<t.length-1;i++)console.assert(t[i].sum()<=t[i+1].sum());const n=this.linear_elapsed_time(null);for(let i=0;i<n.length-1;i++)console.assert(n[i]<=n[i+1]);console.assert(n.length===t.length&&t.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(t,n){let i=null,a=0;if(this.reports_by_worker.has(t)){const u=this.reports_by_worker.get(t);a=we(u,n.elapsed_time,o=>o.elapsed_time),i=a!=0?u[a-1]:null}const c=We(n,i);if(this.reports_by_worker.has(t)||this.reports_by_worker.set(t,[]),this.reports_by_worker.get(t).splice(a,0,c),c.phase!=="replay"){const u=we(this.linear_reports,c.timestamp_monotonic,o=>o.timestamp_monotonic);if(this.linear_reports.splice(u,0,c),u!=this.linear_reports.length-1){let o=null,l;for(l=0;l<this.linear_reports.length-(u+1);l++){const d=this.linear_reports[u+1+l];if(c.worker_uuid===d.worker_uuid){o=d;break}}o&&(console.assert(this.linear_reports[u+1+l]===o),this.linear_reports[u+1+l]=We(o,c));for(const d of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[m,[x,p]]of d.entries())u>=x&&d.set(m,[x,p.slice(0,u-x)])}}}get status(){if(this.failure)return 0;if(this.linear_reports.length===0)return 3;const t=this.linear_reports[this.linear_reports.length-1],n=new Date().getTime()/1e3;return t.phase=="shrink"?1:t.ninputs===0||t.timestamp<n-ie.WAITING_STATUS_DURATION?3:2}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_behavior(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_behavior}elapsed_time(t){const n=this.linear_elapsed_time(t);return n.length===0?0:n[n.length-1]}ninputs(t){const n=this.linear_status_counts(t);return n.length===0?0:n[n.length-1].sum()}_cumsum(t,n,i,a,c){if(a===null&&(a=-1/0),t.has(a)){const[d,m]=t.get(a);if(m.length<this.linear_reports.slice(d).length){let x=m.length>0?m[m.length-1]:c;for(const p of this.linear_reports.slice(d+m.length))x=i(x,p[n]),m.push(x);t.set(a,[d,m])}return m}const u=[],o=we(this.linear_reports,a,d=>d.timestamp_monotonic);let l=c;for(const d of this.linear_reports.slice(o))l=i(l,d[n]),u.push(l);return t.set(a,[o,u]),u}linear_status_counts(t){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(n,i)=>n.add(i),t,new G)}linear_elapsed_time(t){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(n,i)=>n+i,t,0)}};E(ie,"WAITING_STATUS_DURATION",120);let Ce=ie;function gs({message:s,onDismiss:r,isVisible:t}){const[n,i]=h.useState(t);return h.useEffect(()=>{if(t){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[t]),n?e.jsxs("div",{className:`notification ${t?"notification--visible":"notification--hidden"}`,onClick:r,children:[e.jsx("div",{className:"notification__content",children:s}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),r()},"aria-label":"Close notification",children:e.jsx(P,{icon:Je})})]}):null}const pt=h.createContext(null);function xs({children:s}){const[r,t]=h.useState([]),n=h.useRef(new Map),i=h.useRef(0),a=h.useCallback(o=>{clearTimeout(n.current.get(o)),n.current.delete(o),t(l=>l.filter(d=>d.id!==o))},[]),c=h.useCallback((o,l)=>{const d=++i.current,m={id:d,message:o,duration:l};if(t(x=>[...x,m]),l!==null){const x=setTimeout(()=>{a(d)},l);n.current.set(d,x)}return d},[a]),u=h.useCallback((o,l,d)=>{if(t(m=>m.map(x=>x.id===o?{...x,message:l,duration:d}:x)),d!==null){clearTimeout(n.current.get(o));const m=setTimeout(()=>{a(o)},d);n.current.set(o,m)}},[a]);return e.jsxs(pt.Provider,{value:{addNotification:c,updateNotification:u,dismissNotification:a},children:[s,e.jsx("div",{className:"notifications",children:r.map((o,l)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+l*80}px`},children:e.jsx(gs,{message:o.message,isVisible:!0,onDismiss:()=>a(o.id)})},o.id))})]})}function vs(){const s=h.useContext(pt);if(!s)throw new Error("useNotification must be used within a NotificationProvider");return s}const ft=h.createContext(null);function Ke(s){const r=new Map;s.forEach(n=>{r.set(n.representation,(r.get(n.representation)||0)+1)}),s.forEach(n=>{const i=r.get(n.representation);n.isUnique=i==1,n.isDuplicate=i>1});const t=new Set;s.forEach(n=>{n.features.forEach((i,a)=>{t.add(a)})}),s.forEach(n=>{t.forEach(i=>{n.features.has(i)||n.features.set(i,_e)});for(const[i,a]of n.features)a===""&&n.features.set(i,fe)})}function bs(s,r){const t=new Map(s);function n(i){if(t.has(i))return t.get(i);{const a=new Ce(null,i,[],[],null,new Map);return t.set(a.nodeid,a),a}}switch(r.type){case 1:return s;case 2:{const{tests:i}=r;for(const{database_key:a,nodeid:c,failure:u}of i){const o=n(c);o.database_key=a,o.failure=u?ee.fromJson(u):null}return t}case 3:{const{nodeid:i,worker_uuid:a,reports:c}=r,u=n(i);for(const o of c)u.add_report(a,o);return t}case 5:{const{nodeid:i,failure:a}=r,c=n(i);return c.failure=a,t}case 4:{const{nodeid:i,observation_type:a,observations:c}=r,u=n(i);return a==="rolling"?(u.rolling_observations.push(...c),u.rolling_observations=u.rolling_observations.sortKey(o=>-o.run_start).slice(0,300),Ke(u.rolling_observations)):(console.assert(a==="corpus"),u.corpus_observations.push(...c),Ke(u.corpus_observations)),t}default:throw new Error("non-exhaustive switch in testsReducer")}}function ys({children:s}){const[r,t]=h.useState(null),[n,i]=h.useReducer(bs,new Map),[a,c]=h.useState(!1),[u,o]=h.useState(null),{addNotification:l,updateNotification:d,dismissNotification:m}=vs();h.useRef(null);const x=h.useCallback(p=>{c(!0),o(p)},[]);return h.useEffect(()=>{if(a){n.clear();{fetch(new URL("dashboard_state/tests.json",import.meta.url)).then(f=>f.text()).then(f=>JSON.parse(f)).then(f=>{Object.entries(f).forEach(([b,w])=>{i({type:2,tests:[{database_key:w.database_key,nodeid:b,failure:w.failure}]});for(const[_,C]of Object.entries(w.reports_by_worker))i({type:3,nodeid:b,worker_uuid:_,reports:C.map(M=>be.fromJson(_,M))})})});const p=new Worker(new URL("/preview-154/example-dashboard/assets/jsonWorker-KJVNTzbb.js",import.meta.url));return fetch(new URL("dashboard_state/observations.json",import.meta.url)).then(f=>f.text()).then(f=>new Promise(b=>{p.onmessage=w=>b(w.data),p.postMessage(f)})).then(f=>{for(const[b,w]of Object.entries(f))i({type:4,nodeid:b,observation_type:"rolling",observations:w.rolling.map(ee.fromJson)}),i({type:4,nodeid:b,observation_type:"corpus",observations:w.corpus.map(ee.fromJson)})}),()=>p.terminate()}}},[u,a]),e.jsx(ft.Provider,{value:{tests:n,socket:r,doLoadData:x},children:s})}function Fe(s=null){const r=h.useContext(ft);if(!r)throw new Error("useData must be used within a DataProvider");return h.useEffect(()=>{r.doLoadData(s)},[s,r.doLoadData]),r}function he({to:s,children:r,isActive:t}){const n=Me();return e.jsx(J,{to:s,className:`sidebar__link ${t(n.pathname)?"sidebar__link--active":""}`,children:r})}function js(){const s=Me(),[r,t]=h.useState(!1),n=h.useRef(null);return h.useEffect(()=>{function i(a){var c;r&&((c=n.current)==null?void 0:c.contains(a.target))===!1&&t(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[r]),h.useEffect(()=>{t(!1)},[s]),e.jsxs("div",{className:"layout",children:[!r&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>t(!0),children:e.jsx(P,{icon:Pt,size:"lg"})}),r&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:n,className:`sidebar ${r?"sidebar--open":""}`,children:[e.jsx(J,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(he,{to:"/",isActive:i=>i==="/"||i.startsWith("/tests/"),children:"Tests"}),e.jsx(he,{to:"/patches",isActive:i=>i==="/patches",children:"Patches"}),e.jsx(he,{to:"/collected",isActive:i=>i==="/collected",children:"Collection"}),e.jsx(he,{to:"/workers",isActive:i=>i==="/workers",children:"Workers"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/preview-154/example-dashboard".replace(/\/$/,"")}/docs/`,className:"sidebar__link",children:"Docs"})]})]}),e.jsx("div",{className:"content",children:e.jsx(St,{})})]})}function Be({headers:s,data:r,row:t,mobileRow:n,getKey:i,onFilterChange:a,filterStrings:c}){const[u,o]=h.useState(null),[l,d]=h.useState(0),[m,x]=h.useState(""),p=Te(),f=h.useMemo(()=>{let _=r;if(m&&(_=r.filter(M=>c?c(M).some(y=>y.toLowerCase().includes(m.toLowerCase())):!0)),u===null)return _;const C=[..._].sortKey(M=>s[u].sortKey(M));return l===0?C:C.reverse()},[r,u,l,s,m,t,c,n,p]),b=_=>{s[_].sortKey&&(u===_?d(C=>C===0?1:0):(o(_),d(0)))};function w(_){x(_),a==null||a(_)}return e.jsxs("div",{className:"table",children:[c!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:m,onChange:_=>w(_.target.value),className:"table__filter__input"}),m&&e.jsx("span",{className:"table__filter__clear",onClick:()=>w(""),children:e.jsx(P,{icon:Ft})})]}),n!==void 0&&p?f.map(_=>e.jsx("div",{children:n(_)},i?i(_):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:s.map((_,C)=>e.jsx("th",{onClick:()=>b(C),className:_.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${_.align??"left"}`,children:[_.content,_.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(M=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${M===0?"asc":"desc"} ${u===C&&l===M?"table__sort__arrow--active":""}`,children:M===0?e.jsx(P,{icon:Bt}):e.jsx(P,{icon:Dt})}))})]})},C))})}),e.jsx("tbody",{children:f.map(_=>{const C=t(_);return console.assert(C.length===s.length),e.jsx("tr",{children:C.map((M,y)=>e.jsx("td",{children:M},y))},i?i(_):void 0)})})]}),m&&f.length<r.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",f.length," of ",r.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{x(""),a==null||a("")},children:"[clear]"})]})]})}async function De(s){return await(await fetch(new URL("dashboard_state/api.json",import.meta.url))).json()}async function ws(s){var t;const r=await De();return(t=r==null?void 0:r.patches)==null?void 0:t[s]}async function _t(){const s=await De();return s==null?void 0:s.available_patches}async function Ns(){const s=await De();return s==null?void 0:s.collected_tests.collection_status}const He={not_collected:0,collected:1};function Ss(){const[s,r]=h.useState(null);if(h.useEffect(()=>{Ns().then(a=>{r(a)})},[]),s===null)return null;if(!s.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const t=[...s].sortKey(a=>[He[a.status],a.status_reason,a.nodeid]),n=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[He[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(J,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(Be,{headers:n,data:t,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function ks(){return e.jsx("h1",{children:"Page not found!"})}function As(s){const r=s.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:r.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:r.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}ue.registerLanguage("diff",As);function gt({nodeid:s}){const[r,t]=h.useState({}),[n,i]=h.useState(!0),[a,c]=h.useState(null),[u,o]=h.useState(!1),l=h.useRef(null);if(h.useEffect(()=>{ws(s).then(b=>{b&&t(b),i(!1)})},[s]),h.useEffect(()=>{ot(l,!0)},[r,a]),n)return e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading patches..."})});if(Object.values(r).every(b=>b===null))return e.jsx("div",{className:"card",children:e.jsx("p",{children:"No patches for this test"})});const d=new Map([["failing","Failing"],["covering","Covering"]]),m=a??Array.from(d.keys()).find(b=>r[b]),x=r[m],p=async()=>{await navigator.clipboard.writeText(x),o(!0),setTimeout(()=>{o(!1)},2e3)},f=()=>{const b=new Blob([x],{type:"text/plain"}),w=URL.createObjectURL(b),_=document.createElement("a");_.href=w,_.download=`${m}-${s.split("::").pop()}.patch`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(w)};return e.jsxs("div",{ref:l,children:[e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:m,onChange:c,options:Array.from(d.entries()).filter(([b])=>r[b]).map(([b,w])=>({value:b,content:w}))})}),e.jsxs("pre",{className:"patch__pre",children:[e.jsxs("div",{className:"patch__controls",children:[e.jsx("div",{className:`patch__controls__control ${u?"patch__controls__control--success":""}`,onClick:p,title:"Copy patch",children:e.jsx(P,{icon:u?It:Ot})}),e.jsx("div",{className:"patch__controls__control",onClick:f,title:"Download patch",children:e.jsx(P,{icon:Ut})})]}),e.jsx("code",{className:"language-diff",children:x})]})]})}function Cs(){const[s,r]=h.useState(null);return h.useEffect(()=>{_t().then(t=>{r(t)})},[]),s===null||s.length===0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No tests collected"})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Patches"}),s.map(t=>e.jsx(Le,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:t}),e.jsxs(J,{to:`/tests/${encodeURIComponent(t)}`,style:{color:"var(--secondary-color, #888)",fontSize:"0.9em",textDecoration:"none",marginLeft:"12px"},children:["View test ",e.jsx(P,{icon:Vt})]})]}),headerClass:"patches__test",defaultState:"closed",children:e.jsx(gt,{nodeid:t})}))]})}function ke(s,r){const[t,n]=h.useState(()=>{const i=sessionStorage.getItem(s);return i===null?r:JSON.parse(i)});return h.useEffect(()=>{sessionStorage.setItem(s,JSON.stringify(t))},[t,s]),[t,n]}const B={scaleSymlog:Zt,scaleLinear:rt,select:et,zoom:Qt,zoomIdentity:Jt,pointer:Gt,line:qt,axisBottom:st,axisLeft:tt,brush:Yt,scaleOrdinal:nt,schemeCategory10:Xt,quadtree:Ht};typeof window<"u"&&window.addEventListener("mousemove",s=>{s.clientX,s.clientY});const Rs=10;function Xe(s,r,t="horizontal",n=12,i=6){const a=s.node().getBBox(),c=B.select(s.node().parentNode);let u,o;u=a.x-n-i,o=a.y+(a.height-n)/2,c.append("svg").attr("x",u).attr("y",o).attr("width",n).attr("height",n).attr("viewBox",`0 0 ${r.icon[0]} ${r.icon[1]}`).append("path").attr("d",r.icon[4])}class Es{constructor(r,t,n,i,a,c,u,o){E(this,"reports");E(this,"scaleSetting");E(this,"axisSettingX");E(this,"axisSettingY");E(this,"xValue");E(this,"yValue");E(this,"width");E(this,"height");E(this,"margin");E(this,"x");E(this,"y");E(this,"g");E(this,"zoom");E(this,"chartArea");E(this,"navigate");E(this,"tooltip");E(this,"brush",null);E(this,"eventListeners",new Map);E(this,"xAxis");E(this,"yAxis");E(this,"reportsColor");E(this,"viewportX");E(this,"viewportY");E(this,"quadtree");this.reports=t,this.scaleSetting=i,this.axisSettingX=a,this.axisSettingY=c,this.navigate=u,this.xValue=_=>a=="time"?_.linear_elapsed_time:_.linear_status_counts.sum(),this.yValue=_=>c=="behaviors"?_.behaviors:_.fingerprints,this.margin={top:20,right:20,bottom:o?40:45,left:o?50:60},this.width=r.clientWidth-this.margin.left-this.margin.right,this.height=300-this.margin.top-this.margin.bottom,this.reportsColor=n;const l=Array.from(t.values()).flat();this.x=(i==="log"?B.scaleSymlog():B.scaleLinear()).domain([0,Ae(l,_=>this.xValue(_))||1]).range([0,this.width]),this.y=B.scaleLinear().domain([0,Ae(l,_=>this.yValue(_))||0]).range([this.height,0]),this.viewportX=this.x,this.viewportY=this.y,this.g=B.select(r).append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`),this.g.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width).attr("height",this.height+5).attr("x",0).attr("y",-5),this.chartArea=this.g.append("g").attr("class","chart-area").attr("clip-path","url(#clip)"),this.chartArea.append("rect").attr("width",this.width).attr("height",this.height).attr("fill","none").attr("pointer-events","all"),this.zoom=B.zoom().scaleExtent([1,1/0]).on("zoom",_=>this.zoomTo(_.transform,!1)),this.chartArea.call(this.zoom),this.chartArea.on("dblclick.zoom",()=>{this.chartArea.transition().duration(500).call(this.zoom.transform,B.zoomIdentity)}),this.tooltip=B.select(".coverage-graph__tooltip"),this.xAxis=this.g.append("g").attr("transform",`translate(0,${this.height})`).call(this.createXAxis(this.x)),this.yAxis=this.g.append("g").call(this.createYAxis(this.y));const d=this.g.append("g").attr("transform",`translate(${-this.margin.left}, ${this.height/2}) rotate(-90)`),m=this.axisSettingY=="behaviors"?ae:oe,x=this.axisSettingY=="behaviors"?"Behaviors":"Fingerprints",p=d.append("text").attr("x",0).attr("y",0).attr("dy","1em").style("text-anchor","middle").text(x);Xe(p,m,"vertical");const f=this.axisSettingX=="time"?ce:le,b=this.axisSettingX=="time"?"Time (s)":"Inputs",w=this.g.append("text").attr("x",this.width/2).attr("y",this.height+this.margin.bottom-5).style("text-anchor","middle").text(b);Xe(w,f,"horizontal"),this.chartArea.on("mousemove",_=>{const[C,M]=B.pointer(_),y=this.quadtree.find(C,M,Rs);y?this.tooltip.style("display","block").style("left",`${_.pageX+10}px`).style("top",`${_.pageY-10}px`).html(`
              <strong>${ct(y.nodeid)}</strong><br/>
              ${y.behaviors.toLocaleString()} behaviors / ${y.fingerprints.toLocaleString()} fingerprints<br/>
              ${y.ninputs.toLocaleString()} inputs / ${y.elapsed_time.toFixed(1)} seconds
            `):this.tooltip.style("display","none")}).on("mouseout",()=>{this.tooltip.style("display","none")}),this.drawLines(),this.updateQuadtree()}createXAxis(r){if(this.scaleSetting==="log"){const t=r.domain()[1],n=[0];let i=1;for(;i<=t;)n.push(i),i*=10;return B.axisBottom(r).tickValues(n).tickFormat(a=>{const c=a.valueOf();return console.assert(c>=0),c>=1e6?`${Math.floor(c/1e6)}M`:c>=1e3?`${Math.floor(c/1e3)}k`:c>0?c.toLocaleString():"0"})}else return B.axisBottom(r).ticks(5).tickFormat(t=>t.toLocaleString())}createYAxis(r){return B.axisLeft(r).ticks(5)}updateQuadtree(){const r=Array.from(this.reports.values()).flat();this.quadtree=B.quadtree().x(t=>this.viewportX(this.xValue(t))).y(t=>this.viewportY(this.yValue(t))).addAll(r)}zoomTo(r,t){const n=r.rescaleX(this.x),i=t?r.rescaleY(this.y):this.y;this.viewportX=n,this.viewportY=i,this.xAxis.call(this.createXAxis(n)),t&&this.yAxis.call(this.createYAxis(i)),this.g.selectAll(".chart-area path").attr("d",B.line().x(a=>n(this.xValue(a))).y(a=>i(this.yValue(a)))),this.updateQuadtree()}drawLines(){const r=B.line().x(t=>this.x(this.xValue(t))).y(t=>this.y(this.yValue(t)));Array.from(this.reports.entries()).forEach(([t,n])=>{this.chartArea.append("path").datum(n).attr("fill","none").attr("stroke",this.reportsColor(t)).attr("d",r).attr("class","coverage-line").style("cursor","pointer").on("mouseover",function(){B.select(this).classed("coverage-line__selected",!0)}).on("mouseout",function(){B.select(this).classed("coverage-line__selected",!1)}).on("click",i=>{lt(i,`/tests/${encodeURIComponent(t)}`,this.navigate)})})}enableBoxBrush(){for(const r of["wheel","mousedown","mousemove","mouseup"])this.chartArea.on(`${r}.zoom`,null);this.brush=B.brush().extent([[0,0],[this.width,this.height]]).on("end",r=>{if(!r.selection)return;const[[t,n],[i,a]]=r.selection;if(this.chartArea.call(this.brush.clear),this.chartArea.call(this.zoom),Math.abs(i-t)<5||Math.abs(a-n)<5){this.emit("boxSelectEnd");return}const c=this.width/(i-t),u=this.height/(a-n),o=Math.max(c,u),l=B.zoomIdentity.translate(this.width/2,this.height/2).scale(o).translate(-(t+i)/2,-(n+a)/2);this.chartArea.transition().duration(250).call(this.zoom.transform,l).on("end",()=>{this.emit("boxSelectEnd")})}),this.chartArea.style("cursor","crosshair").call(this.brush)}cleanup(){this.tooltip.style("display","none"),this.g.selectAll("path").classed("coverage-line__selected",!1)}on(r,t){this.eventListeners.has(r)||this.eventListeners.set(r,[]),this.eventListeners.get(r).push(t)}off(r,t){this.eventListeners.has(r)&&this.eventListeners.set(r,this.eventListeners.get(r).filter(n=>n!==t))}emit(r){this.eventListeners.has(r)&&this.eventListeners.get(r).forEach(t=>t())}}function xt({tests:s,filterString:r=""}){const t=h.useRef(null),[n,i]=ke("graph_scale","log"),[a,c]=ke("graph_axis_x","time"),[u,o]=ke("graph_axis_y","behaviors"),[l,d]=h.useState(!0),[m,x]=h.useState({transform:null,zoomY:!1}),[p,f]=h.useState(!1),b=Ge(),w=Te(),[_,C]=h.useState(!1),M=h.useMemo(()=>new Map(Array.from(s.entries()).sortKey(([v,S])=>v).map(([v,S])=>{const R=S.linear_status_counts(null),k=S.linear_elapsed_time(null),T=[];for(let I=0;I<R.length;I++){const g=S.linear_reports[I];T.push({nodeid:v,linear_status_counts:R[I],linear_elapsed_time:k[I],behaviors:g.behaviors,fingerprints:g.fingerprints,ninputs:g.ninputs,elapsed_time:g.elapsed_time})}return[v,T]})),[s]),y=h.useMemo(()=>r?new Map(Array.from(M.entries()).filter(([v])=>v.toLowerCase().includes(r.toLowerCase()))):M,[M,r]),$=B.scaleOrdinal(B.schemeCategory10).domain(M.keys());h.useEffect(()=>{if(!t.current||!l&&_)return;l&&d(!1),B.select(t.current).selectAll("*").remove();const v=new Es(t.current,y,$,n,a,u,b,w);return m.transform&&v.zoom.transform(v.chartArea,m.transform),v.zoomTo(m.transform??B.zoomIdentity,m.zoomY),v.zoom.on("zoom.saveTransform",S=>{x({transform:S.transform,zoomY:!1})}),p&&v.enableBoxBrush(),v.on("boxSelectEnd",j),()=>{v.cleanup()}},[y,n,a,u,l,p,b]);const j=()=>{f(!p),d(!0)};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Coverage"}),e.jsxs("div",{className:"coverage-graph__controls",children:[e.jsx(re,{value:u,onChange:o,options:[{value:"behaviors",content:e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:ae})," Behaviors"]}),mobileContent:e.jsx(P,{icon:ae})},{value:"fingerprints",content:e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:oe})," Fingerprints"]}),mobileContent:e.jsx(P,{icon:oe})}]}),e.jsx(re,{value:a,onChange:c,options:[{value:"inputs",content:e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:le})," Inputs"]}),mobileContent:e.jsx(P,{icon:le})},{value:"time",content:e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:ce})," Time"]}),mobileContent:e.jsx(P,{icon:ce})}]}),e.jsx(re,{value:n,onChange:i,options:[{value:"linear",content:"Linear"},{value:"log",content:"Log"}]})]}),e.jsx("div",{className:"coverage-graph__tooltip"}),e.jsx("svg",{className:"coverage-graph__svg",ref:t,style:{width:"100%",height:"300px"},onMouseEnter:()=>C(!0),onMouseLeave:()=>{C(!1),d(!0)}})]})}function Re({status:s}){return e.jsx("span",{style:{textAlign:"center"},children:s===ge.FAILED?e.jsx("span",{className:"pill pill__failure",children:"Failed"}):s===ge.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:"Shrinking"}):s===ge.RUNNING?e.jsx("span",{className:"pill pill__success",children:"Running"}):e.jsx("span",{className:"pill pill__neutral",children:"Waiting"})})}function q({content:s,tooltip:r}){return e.jsxs("span",{className:"tooltip",children:[s,e.jsx("div",{className:"tooltip__text",children:r})]})}function vt(s){const r=Math.floor(s/3600),t=Math.floor(s%3600/60),n=Math.floor(s%60);return`${r>0?`${r}:${t.toString().padStart(2,"0")}`:t}:${n.toString().padStart(2,"0")}`}function bt(s){const r=s.ninputs(null),t=s.elapsed_time(null);return t===0?null:r/t}function Ee(s){var t;if(s.linear_reports.length===0)return{inputs:"",behaviors:"",fingerprints:"",executions:"",inputsSinceBranch:"",timeSpent:""};const r=bt(s);return{inputs:s.ninputs(null).toLocaleString(),behaviors:s.behaviors.toLocaleString(),fingerprints:s.fingerprints.toLocaleString(),executions:r===null?"":`${r.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((t=s.since_new_behavior)==null?void 0:t.toLocaleString())??"",timeSpent:vt(s.elapsed_time(null))}}ue.registerLanguage("python",ht);function Ms(){const{nodeid:s}=kt(),{tests:r}=Fe(s),t=h.useRef(null),[n,i]=h.useState(null);h.useEffect(()=>{_t().then(o=>{i(o)})},[]);const a=r.get(s)??null;if(h.useEffect(()=>{a&&ot(t)},[a==null?void 0:a.failure]),!s||!a)return e.jsx("div",{children:"Test not found"});const c=Ee(a),u=[{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:le})}),tooltip:"Number of inputs"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:ae})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:oe})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:Qe})}),tooltip:"Inputs per second"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:Ze})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:ce})}),tooltip:"Total time spent running"})}];return e.jsxs("div",{ref:t,children:[e.jsxs(J,{to:"/",className:"back-link",children:[e.jsx(P,{icon:zt})," Back to all tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:s}),e.jsx(Re,{status:a.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(Be,{headers:u,data:[c],row:o=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.timeSpent})]})})]}),e.jsx(xt,{tests:new Map([[s,a]])}),a.failure&&e.jsxs("div",{className:"test-failure",children:[e.jsx("h2",{children:"Failure"}),e.jsxs("div",{className:"test-failure__item",children:[e.jsx("h3",{children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:a.failure.metadata.get("reproduction_decorator")+`
`+a.failure.representation})}),e.jsx("h3",{children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:a.failure.metadata.get("traceback")})})]})]}),e.jsx(_s,{test:a}),(n==null?void 0:n.includes(s))&&e.jsx("div",{className:"card",children:e.jsx(Le,{title:"Patches",defaultState:"closed",headerClass:"card__header",children:e.jsx(gt,{nodeid:s})})})]})}function Z({icon:s,tooltip:r}){return e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(P,{icon:s})}),tooltip:r})}function ne({icon:s,value:r}){return e.jsxs("div",{className:"table__inline-statistic",children:[s,e.jsx("span",{className:"table__inline-statistic__value",children:r})]})}function Ts({tests:s,onFilterChange:r}){const t=Array.from(s).sortKey(([p,f])=>[f.status,p]).map(([p,f])=>f),n=e.jsx(Z,{icon:le,tooltip:"Number of inputs"}),i=e.jsx(Z,{icon:ae,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(Z,{icon:oe,tooltip:"Number of fingerprints (sets of behaviors) found"}),c=e.jsx(Z,{icon:Qe,tooltip:"Inputs per second"}),u=e.jsx(Z,{icon:Ze,tooltip:"Number of inputs since a new behavior"}),o=e.jsx(Z,{icon:ce,tooltip:"Total time spent running"}),l=[{content:"Test",sortKey:p=>p.nodeid},{content:"Status",sortKey:p=>p.status,align:"center"},{content:n,align:"right",sortKey:p=>p.ninputs(null)},{content:i,align:"right",sortKey:p=>p.behaviors},{content:a,align:"right",sortKey:p=>p.fingerprints},{content:c,align:"right",sortKey:p=>bt(p)??-1},{content:u,align:"right",sortKey:p=>p.since_new_behavior??0},{content:o,align:"right",sortKey:p=>p.elapsed_time(null)}],d=p=>{const f=Ee(p);return[e.jsx(J,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Re,{status:p.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:f.timeSpent})]};function m(p){const f=Ee(p);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(J,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx(Re,{status:p.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(ne,{icon:n,value:f.inputs}),e.jsx(ne,{icon:i,value:f.behaviors}),e.jsx(ne,{icon:c,value:f.executions}),e.jsx(ne,{icon:u,value:f.inputsSinceBranch}),e.jsx(ne,{icon:o,value:f.timeSpent})]})]})}function x(p){return[p.nodeid,mt[p.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(Be,{headers:l,data:t,row:d,mobileRow:m,filterStrings:x,onFilterChange:r})]})}function $s(){const{tests:s}=Fe(),[r,t]=h.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx(xt,{tests:s,filterString:r}),e.jsx(Ts,{tests:s,onFilterChange:t})]})}function Ls({min:s,max:r,value:t,onChange:n,step:i=1}){const[a,c]=h.useState(null),u=h.useRef(null);console.assert(s<=r,`min: ${s} max: ${r}`);const[o,l]=t,d=r-s,m=d===0?0:(o-s)/d*100,x=d===0?100:(l-s)/d*100,p=m<50?1:2,f=x<50?2:1,b=h.useCallback(y=>{if(!u.current)return s;const $=u.current.getBoundingClientRect(),j=Math.max(0,Math.min(100,(y-$.left)/$.width*100)),v=s+j/100*d,S=Math.round(v/i)*i;return Math.max(s,Math.min(r,S))},[s,r,d,i]),w=y=>$=>{$.preventDefault(),c(y)},_=h.useCallback(y=>{if(!a)return;const $=b(y.clientX);n(a==="min"?[Math.min($,l),l]:[o,Math.max($,o)])},[a,b,o,l,n]),C=h.useCallback(()=>{c(null)},[]),M=y=>{if(a)return;const $=b(y.clientX),j=Math.abs($-o),v=Math.abs($-l);j<v?n([Math.min($,l),l]):n([o,Math.max($,o)])};return h.useEffect(()=>a?(document.addEventListener("mousemove",_),document.addEventListener("mouseup",C),()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",C)}):()=>{},[a,_,C]),e.jsx("div",{className:"range-slider",children:e.jsx("div",{className:"range-slider__container",children:e.jsxs("div",{ref:u,className:"range-slider__track",onClick:M,children:[e.jsx("div",{className:"range-slider__range",style:{left:`${m}%`,width:`${x-m}%`}}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--min",style:{left:`${m}%`,zIndex:p},onMouseDown:w("min")}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--max",style:{left:`${x}%`,zIndex:f},onMouseDown:w("max")})]})})})}function me(s){return new Date(s*1e3).toLocaleString()}const Ps=24*60*60;function Ye(s,r){return[Math.max(s,r-Ps),r]}function Fs(s){let r=0;for(let a=0;a<s.length;a++)r=(r<<5)-r+s.charCodeAt(a)&4294967295;const t=Math.abs(r)%360,n=45+Math.abs(r>>8)%30,i=45+Math.abs(r>>16)%20;return`hsl(${t}, ${n}%, ${i}%)`}function pe({label:s,value:r}){return e.jsxs("div",{className:"workers__worker__details__item",children:[e.jsx("span",{className:"workers__worker__details__label",children:s}),e.jsx("span",{className:"workers__worker__details__value",children:r})]})}function Bs(){const{tests:s}=Fe(),r=Ge(),{showTooltip:t,hideTooltip:n,moveTooltip:i}=$e(),[a,c]=h.useState(new Set),u=Wt(Array.from(s.values()).map(j=>Array.from(j.reports_by_worker.keys())).flat().sortKey(j=>j)),o=new Map;u.forEach(j=>{const v=[];o.set(j,v),Array.from(s.values()).forEach(S=>{if(!S.reports_by_worker.has(j))return;const R=S.reports_by_worker.get(j);v.push(...R.map(k=>({timestamp_monotonic:k.timestamp_monotonic,nodeid:S.nodeid})))}),v.sortKey(S=>S.timestamp_monotonic)});let l=1/0,d=-1/0,m=new Map;u.forEach(j=>{const v=o.get(j),S=[];let R=null;v.forEach((k,T)=>{l=Math.min(l,k.timestamp_monotonic),d=Math.max(d,k.timestamp_monotonic),!R||R.nodeid!==k.nodeid?(R&&S.push(R),R={nodeid:k.nodeid,start:k.timestamp_monotonic,end:k.timestamp_monotonic}):R.end=k.timestamp_monotonic,T===v.length-1&&R&&S.push(R)}),m.set(j,S)}),m=new Map([...m.entries()].sortKey(([j,v])=>v[0].start));const[x,p]=h.useState(Ye(l,d));h.useEffect(()=>{p(Ye(l,d))},[l,d]);const[f,b]=x,w=b-f,_=h.useCallback(j=>{let v,S;return w===0?(v=0,S=100):(v=(j.start-f)/w*100,S=(j.end-j.start)/w*100),{left:`${v}%`,width:`${S}%`,backgroundColor:Fs(j.nodeid)}},[w,f,b]),C=h.useMemo(()=>{const j=new Map;for(const[v,S]of m.entries())j.set(v,S.filter(R=>R.end>=f&&R.start<=b));return j},[m,f,b]);function M(j){c(v=>{const S=new Set(v);return S.has(j)?S.delete(j):S.add(j),S})}function y({uuid:j,segments:v}){return e.jsxs("div",{className:`workers__worker ${a.has(j)?"workers__worker--expanded":""}`,onClick:()=>M(j),onMouseLeave:()=>n("workers"),children:[e.jsx("div",{className:"workers__worker__bar",onMouseLeave:()=>n("workers"),children:v.map((S,R)=>e.jsx("div",{className:"workers__timeline__segment",style:_(S),onClick:k=>{lt(k,`/tests/${encodeURIComponent(S.nodeid)}`,r),k.stopPropagation()},onMouseEnter:k=>t(ct(S.nodeid),k.clientX,k.clientY,"workers"),onMouseLeave:()=>n("workers"),onMouseMove:k=>i(k.clientX,k.clientY,"workers")},R))}),a.has(j)&&e.jsx($,{uuid:j,segments:v})]},j)}function $({uuid:j,segments:v}){return e.jsx("div",{className:"workers__worker__details",children:e.jsxs("div",{className:"workers__worker__details__grid",children:[e.jsx(pe,{label:"Worker UUID",value:j}),e.jsx(pe,{label:"Lifetime",value:vt(v[v.length-1].end-v[0].start)}),e.jsx(pe,{label:"Started",value:me(v[0].start)}),e.jsx(pe,{label:"Last seen",value:me(v[v.length-1].end)})]})})}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Workers "}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"card__text",children:[e.jsx("div",{className:"card__text__paragraph",children:"This page shows the history of your workers, and what tests they have been fuzzing."}),e.jsx("div",{className:"card__text__paragraph",children:'Roughly speaking, "one worker" = "one CPU core".'})]}),e.jsxs("div",{className:"workers",children:[e.jsx("div",{className:"workers__controls",children:e.jsx(Ls,{min:l,max:d,value:x,onChange:j=>p(j),step:(d-l)/1e3})}),e.jsxs("div",{className:"workers__timeline-header",children:[e.jsx("span",{className:"workers__timeline-header__label",children:me(f)}),e.jsx("span",{className:"workers__timeline-header__label",children:me(b)})]}),Array.from(C.entries()).map(([j,v])=>v.length>0&&e.jsx(y,{uuid:j,segments:v}))]})]})]})}function Ds(){const s=At;return e.jsx(s,{children:e.jsx(xs,{children:e.jsx(ys,{children:e.jsx(is,{children:e.jsx(Ct,{children:e.jsxs(Y,{element:e.jsx(js,{}),children:[e.jsx(Y,{path:"/",element:e.jsx($s,{})}),e.jsx(Y,{path:"/patches",element:e.jsx(Cs,{})}),e.jsx(Y,{path:"/collected",element:e.jsx(Ss,{})}),e.jsx(Y,{path:"/workers",element:e.jsx(Bs,{})}),e.jsx(Y,{path:"/tests/:nodeid",element:e.jsx(Ms,{})}),e.jsx(Y,{path:"*",element:e.jsx(ks,{})})]})})})})})})}ns.createRoot(document.getElementById("app")).render(e.jsx(Rt.StrictMode,{children:e.jsx(Ds,{})}));
