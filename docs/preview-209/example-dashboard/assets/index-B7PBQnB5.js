var Bt=Object.defineProperty;var zt=(t,n,s)=>n in t?Bt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var C=(t,n,s)=>zt(t,typeof n!="symbol"?n+"":n,s);import{r as Ot,g as dt,a as m,u as Pe,b as Ut,L as Q,O as Vt,c as ht,d as Kt,R as De,H as Wt,e as Ht,f as G}from"./react-DOgvK_Td.js";import{F as A,f as mt,S as O,r as Yt,a as Xt,b as Gt,c as qt,d as Jt,L as Z,e as Qt,g as Zt,h as es,i as ts,j as Le,k as ss,l as ns,m as rs,n as is,o as as,p as os,q as ls,s as cs,t as qe,u as Je,v as xe,w as ve,x as be,y as ye,z as us,A as pt,B as ft,O as ds}from"./vendor-CnT9-Eog.js";import{d as Be,a as _t,b as gt,c as hs,o as ze,l as Oe,s as ms,q as ps,e as xt,f as vt,g as fs,h as _s,i as gs,j as bt,k as yt,m as xs}from"./d3-kcbYKKJK.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Ae={exports:{}},re={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qe;function vs(){if(Qe)return re;Qe=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function s(r,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var d in i)d!=="key"&&(a[d]=i[d])}else a=i;return i=a.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:a}}return re.Fragment=n,re.jsx=s,re.jsxs=s,re}var Ze;function bs(){return Ze||(Ze=1,Ae.exports=vs()),Ae.exports}var e=bs();Array.prototype.sortKey||(Array.prototype.sortKey=function(t){return this.sort((n,s)=>{const r=t(n),i=t(s);if(Array.isArray(r)&&Array.isArray(i)){for(let a=0;a<Math.min(r.length,i.length);a++){if(r[a]<i[a])return-1;if(r[a]>i[a])return 1}return 0}return r<i?-1:r>i?1:0})});var ys=Ot();const js=dt(ys);function ws({message:t,onDismiss:n,isVisible:s}){const[r,i]=m.useState(s);return m.useEffect(()=>{if(s){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[s]),r?e.jsxs("div",{className:`notification ${s?"notification--visible":"notification--hidden"}`,onClick:n,children:[e.jsx("div",{className:"notification__content",children:t}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),n()},"aria-label":"Close notification",children:e.jsx(A,{icon:mt})})]}):null}const jt=m.createContext(null);function Ns({children:t}){const[n,s]=m.useState([]),r=m.useRef(new Map),i=m.useRef(0),a=m.useCallback(u=>{clearTimeout(r.current.get(u)),r.current.delete(u),s(l=>l.filter(h=>h.id!==u))},[]),o=m.useCallback((u,l)=>{const h=++i.current,c={id:h,message:u,duration:l};if(s(g=>[...g,c]),l!==null){const g=setTimeout(()=>{a(h)},l);r.current.set(h,g)}return h},[a]),d=m.useCallback((u,l,h)=>{if(s(c=>c.map(g=>g.id===u?{...g,message:l,duration:h}:g)),h!==null){clearTimeout(r.current.get(u));const c=setTimeout(()=>{a(u)},h);r.current.set(u,c)}},[a]);return e.jsxs(jt.Provider,{value:{addNotification:o,updateNotification:d,dismissNotification:a},children:[t,e.jsx("div",{className:"notifications",children:n.map((u,l)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+l*80}px`},children:e.jsx(ws,{message:u.message,isVisible:!0,onDismiss:()=>a(u.id)})},u.id))})]})}function Ss(){const t=m.useContext(jt);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t}function Ue(){const[t,n]=m.useState(!1);return m.useEffect(()=>{function s(){n(window.matchMedia("(max-width: 768px)").matches)}return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function ne({value:t,onChange:n,options:s,disabled:r=!1}){const i=Ue();return console.assert(O(s.map(a=>a.value)).size===s.length),e.jsx("div",{className:`toggle ${r?"toggle--disabled":""}`,children:s.map(a=>e.jsx("button",{className:`toggle__button${t===a.value?" toggle__button--active":""} ${r?"toggle__button--disabled":""}`,onClick:()=>{if(!r)if(s.length==2&&t===a.value){const o=s.find(d=>d.value!==a.value).value;n(o)}else n(a.value)},children:i?a.mobileContent??a.content:a.content},String(a.value)))})}class wt{constructor(n,s,r,i){C(this,"createdAt");this.name=n,this.predicate=s,this.component=r,this.extraData=i,this.createdAt=Date.now()}}const Nt=m.createContext(void 0);function ks({children:t}){const[n,s]=m.useState(new Map([["covering",new Map],["rolling",new Map]])),[r,i]=m.useState("covering"),a=n.get(r)||new Map,o=l=>{s(h=>{const c=new Map(h);return c.set(r,l),c})},u={filters:a,setFilters:o,removeFilter:(l,h)=>{const c=new Map(a),f=(c.get(l)||[]).filter(v=>v.name!==h);f.length===0?c.delete(l):c.set(l,f),o(c)},observationCategory:r,setObservationCategory:i};return e.jsx(Nt.Provider,{value:u,children:t})}function Ne(){const t=m.useContext(Nt);if(t===void 0)throw new Error("useFilters must be used within a FilterProvider");return t}const St=m.createContext(null);function As({state:t}){return t.visible?Ut.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${t.x+10}px`,top:`${t.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:t.content}}),document.body):null}function Cs({children:t}){const n=Pe(),[s,r]=m.useState({visible:!1,content:"",x:0,y:0,owner:null});m.useEffect(()=>{r(u=>({...u,visible:!1,owner:null}))},[n.pathname]);const i=m.useCallback((u,l,h,c)=>{r({visible:!0,content:u,x:l,y:h,owner:c})},[]),a=m.useCallback(u=>{r(l=>l.owner===u?{...l,visible:!1,owner:null}:l)},[]),o=m.useCallback((u,l,h)=>{r(c=>c.visible&&c.owner===h&&(c.x!==u||c.y!==l)?{...c,x:u,y:l}:c)},[]),d=m.useMemo(()=>({showTooltip:i,hideTooltip:a,moveTooltip:o,visible:s.visible}),[i,a,o,s.visible]);return e.jsxs(St.Provider,{value:d,children:[t,e.jsx(As,{state:s})]})}function Ve(){const t=m.useContext(St);if(!t)throw new Error("useTooltip must be used within a TooltipProvider");return t}var Es=Yt();const de=dt(Es);function kt(t,n=0){return Array.from(t).reduce((s,r)=>s+r,n)}function At(t,n=!1){t.current&&(n&&t.current.querySelectorAll("code").forEach(s=>{s.removeAttribute("data-highlighted")}),t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(s=>{de.highlightElement(s)}))}function ce(t,n){if(n){let s=null,r=null;for(let i=0;i<t.length;i++){const a=t[i],o=n(a);o!=null&&(r===null||o>r)&&(r=o,s=a)}return s}else{let s=null;for(let r=0;r<t.length;r++){const i=t[r];i!=null&&(s===null||i>s)&&(s=i)}return s}}function Rs(t,n){{let s=null;for(let r=0;r<t.length;r++){const i=t[r];i!=null&&(s===null||i<s)&&(s=i)}return s}}function Ce(t,n,s){let r=0,i=t.length;for(;r<i;){const a=r+i>>>1;(s?s(t[a])<=n:t[a]<=n)?r=a+1:i=a}return r}let ie=null;function Ls(){return ie||(ie=document.createElement("div"),ie.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(ie)),ie}function Ee(t,n=""){const s=Ls();s.className=n,s.textContent=t;const r=s.getBoundingClientRect();return{width:r.width,height:r.height}}function Ct(t,n,s){if(t.metaKey||t.ctrlKey){const r=window.location,i=`${r.origin}${r.pathname}#${n}`;console.log(r.origin,r.pathname,n,i),window.open(i,"_blank")}else s(n)}function Et(t){return t.split("::").pop()||t}const Y={select:Be,scaleLinear:Oe,scaleOrdinal:ze,scaleBand:hs,axisBottom:gt,axisLeft:_t},et=5,H=2.5;function Ts({feature:t,observations:n}){const s=m.useRef(null),r=m.useRef(null),{filters:i,setFilters:a}=Ne(),{showTooltip:o,hideTooltip:d,moveTooltip:u}=Ve(),l=m.useMemo(()=>{const g=i.get(t)||[];if(g.length===0)return O();console.assert(g.length===1);const f=g[0];return O(f.extraData.selectedValues)},[i,t]),h=m.useMemo(()=>({raw:n.raw.filter(g=>g.status!=="gave_up"),filtered:n.filtered.filter(g=>g.status!=="gave_up")}),[n]),c=m.useCallback(g=>{let f=O();l.equals(O([g]))?f=O():f=O([g]);let v;f.size===1?v=f.first():v=f.map(x=>`${x}`).join(" or ");const y=[];f.size>0&&y.push(new wt(v,x=>f.some(S=>x.features.get(t)===S),t,{selectedValues:f}));const j=new Map(i);j.set(t,y),a(j)},[i,t,l,a]);return m.useEffect(()=>{const g=O(h.raw.map(_=>_.features.get(t)));let f=new Map;for(const _ of h.filtered){const N=_.features.get(t);f.set(N,(f.get(N)||0)+1)}const v=kt(Array.from(f.values()));f=new Map([...f.entries()].sortKey(([_,N])=>_===_e?0:_===ge?1:_)),Y.select(r.current).selectAll("*").remove();const y=s.current.clientWidth,j=g.size<et?85:170,x=Y.select(r.current).attr("width",y).attr("height",j).append("g"),S=function(_,N){const[w,L]=N;o(`${t}<br>${w}: ${L}`,_.clientX,_.clientY,"tyche-nominal")};if(g.size<et){const _={top:0,right:15,bottom:20,left:15},N=y-_.left-_.right,w=j-_.top-_.bottom,L=Y.scaleLinear().domain([0,1]).range([0,N]);let T;f.has(_e)||f.has(ge)?T=P=>P===_e?V.SUCCESS:P===ge?V.ERROR:V.PRIMARY:T=Y.scaleOrdinal().domain(Array.from(f.keys())).range([V.PRIMARY,V.ACCENT,V.ACCENT2,V.ACCENT3,V.ACCENT4]);const I=x.append("g").attr("transform",`translate(${_.left},${_.top})`);let M=0;const $=w-_.bottom;f.forEach((P,p)=>{const b=P/v*N,E=l.has(p);I.append("rect").attr("x",M).attr("y",0).attr("width",b).attr("height",$).attr("fill",T(p)).style("cursor","pointer").on("click",()=>c(p)).on("mouseover",R=>{S(R,[p,P])}).on("mousemove",R=>u(R.clientX,R.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),E&&I.append("rect").attr("x",M+H).attr("y",H).attr("width",b-2*H).attr("height",$-2*H).attr("fill",T(p)).attr("stroke","white").attr("stroke-width",H).style("pointer-events","none"),I.append("text").attr("x",M+b/2).attr("y",$/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(p).style("font-size","12px"),M+=b}),I.append("g").attr("transform",`translate(0,${$})`).call(Y.axisBottom(L).tickFormat(P=>`${Math.round(Number(P)*100)}%`)),I.append("text").attr("x",N/2).attr("y",$+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const _={top:5,right:5,bottom:30,left:30},N=y-_.left-_.right,w=j-_.top-_.bottom,L=Y.scaleBand().domain(Array.from(f.keys())).range([0,N]).padding(.2),T=Y.scaleLinear().domain([0,ce(Array.from(f.values()))||0]).range([w,0]),I=x.append("g").attr("transform",`translate(${_.left},${_.top})`);I.selectAll(".bar").data(Array.from(f.entries())).enter().append("rect").attr("class","bar").attr("x",([M,$])=>L(M)||0).attr("y",([M,$])=>T($)).attr("width",L.bandwidth()).attr("height",([M,$])=>w-T($)).attr("fill",V.PRIMARY).style("cursor","pointer").on("click",function(M,[$,P]){c($)}).on("mouseover",function(M,$){S(M,$)}).on("mousemove",M=>u(M.clientX,M.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),I.selectAll(".inner-bar").data(Array.from(f.entries()).filter(([M,$])=>l.has(M))).enter().append("rect").attr("class","inner-bar").attr("x",([M,$])=>(L(M)||0)+H).attr("y",([M,$])=>T($)+H).attr("width",L.bandwidth()-2*H).attr("height",([M,$])=>w-T($)-2*H).attr("fill",V.PRIMARY).attr("stroke","white").attr("stroke-width",H).style("pointer-events","none"),I.append("g").attr("transform",`translate(0,${w})`).call(Y.axisBottom(L)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),I.append("g").call(Y.axisLeft(T).ticks(7).tickFormat(M=>Math.round(Number(M)).toString())),I.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-w/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}},[h,t,d,u,c,l,o]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:t}),e.jsx("div",{ref:s,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:r,style:{width:"100%"}})})]})}function Ke({title:t,children:n,defaultState:s="open",onStateChange:r,headerClass:i="",contentClass:a=""}){const[o,d]=m.useState(s),u=()=>{const l=o==="open"?"closed":"open";d(l),r==null||r(l)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:u,children:[e.jsx("span",{className:"collapsible__toggle",children:o==="open"?e.jsx(A,{icon:Xt}):e.jsx(A,{icon:Gt})}),t]}),o==="open"&&e.jsx("div",{className:`${a}`,children:n})]})}function We({title:t,children:n,defaultState:s="open",onStateChange:r}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Ke,{title:t,defaultState:s,onStateChange:r,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:n})})}function Ms({observations:t}){const n=new Set;return t.raw.forEach(s=>{for(const r of s.features.keys())r.startsWith("Retried draw from")||n.add(r)}),n.size===0?null:e.jsx(We,{title:"Features",children:Array.from(n).sort().map(s=>e.jsx(Ts,{feature:s,observations:t}))})}function $s(){const{filters:t,removeFilter:n}=Ne(),s=Array.from(t.values()).flat().sortKey(r=>r.createdAt);return s.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),s.map(r=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>n(r.component,r.name),children:e.jsx(A,{icon:mt})}),r.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:r.name})]},`${r.component}-${r.name}`))]})}function Rt(t){const n=t.regex,s=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),r=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],d={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:r,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},u={className:"meta",begin:/^(>>>|\.\.\.) /},l={className:"subst",begin:/\{/,end:/\}/,keywords:d,illegal:/#/},h={begin:/\{\{/,relevance:0},c={className:"string",contains:[t.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,u],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,u],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,u,h,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,u,h,l]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[t.BACKSLASH_ESCAPE,h,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[t.BACKSLASH_ESCAPE,h,l]},t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},g="[0-9](_?[0-9])*",f=`(\\b(${g}))?\\.(${g})|\\b(${g})\\.`,v=`\\b|${r.join("|")}`,y={className:"number",relevance:0,variants:[{begin:`(\\b(${g})|(${f}))[eE][+-]?(${g})[jJ]?(?=${v})`},{begin:`(${f})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${v})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${v})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${v})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${v})`},{begin:`\\b(${g})[jJ](?=${v})`}]},j={className:"comment",begin:n.lookahead(/# type:/),end:/$/,keywords:d,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},x={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:d,contains:["self",u,y,c,t.HASH_COMMENT_MODE]}]};return l.contains=[c,y,u],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:d,illegal:/(<\/|\?)|=>/,contains:[u,y,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},c,j,t.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,s],scope:{1:"keyword",3:"title.function"},contains:[x]},{variants:[{match:[/\bclass/,/\s+/,s,/\s*/,/\(\s*/,s,/\s*\)/]},{match:[/\bclass/,/\s+/,s]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[y,x,c]}]}}function tt({currentPage:t,pageCount:n,onPageChange:s}){console.assert(n>1);function r(){return n<=7?Array.from({length:n},(u,l)=>l):t<=3?[0,1,2,3,4,"ellipsis",n-1]:t>=n-4?[0,"ellipsis",n-5,n-4,n-3,n-2,n-1]:[0,"ellipsis",t-1,t,t+1,"ellipsis",n-1]}const i=r();function a(u){typeof u=="number"&&t!==u&&s(u)}function o(){t>0&&s(t-1)}function d(){t<n-1&&s(t+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${t===0?"pagination__nav--disabled":""}`,onClick:o,children:e.jsx(A,{icon:qt})}),i.map((u,l)=>{if(u==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${l}`);const h=u===t;return e.jsx("div",{className:`pagination__number ${h?"pagination__number--current":""}`,onClick:()=>a(u),children:u+1},u)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${t===n-1?"pagination__nav--disabled":""}`,onClick:d,children:e.jsx(A,{icon:Jt})})]})}de.registerLanguage("python",Rt);const Re=30;function Is({observations:t,observationCategory:n}){const s=m.useRef(null),[r,i]=m.useState(0);m.useEffect(()=>{i(0)},[n]);function a(){s.current&&s.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(l=>{de.highlightElement(l)})}m.useEffect(()=>{a()},[t,r]);const o=new Map;t.filtered.forEach(l=>{const h=l.representation;o.set(h,(o.get(h)||0)+1)});const d=Math.ceil(o.size/Re),u=Array.from(o.entries()).sortKey(([l,h])=>-h).slice(r*Re,(r+1)*Re);return e.jsx(We,{title:"String representations",defaultState:"closed",onStateChange:l=>{l==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:s,children:[d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(tt,{currentPage:r,pageCount:d,onPageChange:i})}),u.map(([l,h])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:l})}),h>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",h]})]},l)),d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(tt,{currentPage:r,pageCount:d,onPageChange:i})})]})})}const st=640;function Fs({name:t,observations:n,verticalAxis:s,horizontalAxis:r,cssStyle:i=(a,o)=>({})}){const{filters:a,setFilters:o}=Ne(),{showTooltip:d,hideTooltip:u,moveTooltip:l}=Ve(),h=m.useMemo(()=>{const p=a.get(t)||[];if(p.length===0)return O();console.assert(p.length===1);const b=p[0];return O(b.extraData.selectedCells)},[a,t]),c=[],g=Array(s.length).fill(0),f=Array(r.length).fill(0);let v=0;for(let p=0;p<s.length;p++){c[p]=[];for(let b=0;b<r.length;b++)c[p][b]={count:0,widthPercent:0}}n.filtered.forEach(p=>{for(let b=0;b<s.length;b++){const[,E]=s[b];if(E(p)){for(let R=0;R<r.length;R++){const[,B]=r[R];if(B(p)){c[b][R].count++,g[b]++,f[R]++,v++;break}}break}}});const y=g.map((p,b)=>p>0?b:null).filter(p=>p!==null),j=f.map((p,b)=>p>0?b:null).filter(p=>p!==null),x=(p,b)=>{let E=O();if(p!==null&&b!==null){const k=Z([p,b]);h.equals(O([k]))?E=O():E=O([k])}else p!==null?(console.assert(b===null),j.forEach(k=>{c[p][k].count>0&&(E=E.add(Z([p,k])))})):b!==null&&(console.assert(p===null),y.forEach(k=>{c[k][b].count>0&&(E=E.add(Z([k,b])))}));function R(){if(E.size===0)return"";let k=E;const K=[],me=[...y.map(z=>({name:s[z][0],cells:j.filter(W=>c[z][W].count>0).map(W=>Z([z,W]))})),...j.map(z=>({name:r[z][0],cells:y.filter(W=>c[W][z].count>0).map(W=>Z([W,z]))}))];for(const z of me)z.cells.length>0&&z.cells.every(W=>k.has(W))&&(K.push(z.name),k=k.subtract(O(z.cells)));for(;k.size>0;){const z=k.first(),[W,ke]=z.toArray();K.push(`${s[W][0]}+${r[ke][0]}`),k=k.delete(z)}return console.assert(k.size==0),K.join(" or ")}const B=[];E.size>0&&B.push(new wt(R(),k=>E.some(K=>{const[me,z]=K.toArray(),W=s[me][1],ke=r[z][1];return W(k)&&ke(k)}),t,{selectedCells:E}));const U=new Map(a);U.set(t,B),o(U)},{rowHeaderWidth:S,columnHeaderHeight:_,rowTotalWidth:N}=m.useMemo(()=>({rowHeaderWidth:Math.max(...y.map(p=>Ee(s[p][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(...j.map(p=>Ee(r[p][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...y.map(p=>Ee(g[p].toString(),"tyche__mosaic__row-total").width))}),[y,j,s,r,g]);if(y.length===0||j.length===0)return e.jsx("div",{children:"No observations"});const w=30,L=30,T=45*y.length;for(let p=0;p<s.length;p++)for(let b=0;b<r.length;b++)c[p][b].widthPercent=g[p]>0?c[p][b].count/g[p]*100:0;const M=y.map(p=>g[p]/v*T).map(p=>Math.max(p,L)),$=j.map((p,b)=>b===0?0:b===j.length-1?100:b/(j.length-1)*100),P=st-S-N;return y.forEach(p=>{const b=j.map(R=>c[p][R]);if(b.reduce((R,B)=>R+B.widthPercent,0)>0){const B=b.map(k=>k.widthPercent/100*P).map((k,K)=>b[K].count>0&&k>0&&k<w?w:k),U=B.reduce((k,K)=>k+K,0);j.forEach((k,K)=>{c[p][k].widthPercent=U>0?B[K]/U*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${st}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${S}px`,marginRight:`${N}px`,height:`${_}px`},children:j.map((p,b)=>{const E=b===0,R=b===j.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${$[b]}%`,transform:E?"translateX(0%)":R?"translateX(-100%)":"translateX(-50%)",textAlign:E?"left":R?"right":"center"},onClick:()=>x(null,p),children:r[p][0]},`header-${p}`)})}),y.map((p,b)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${M[b]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${S}px`,cursor:"pointer"},onClick:()=>x(p,null),children:s[p][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:j.map(E=>{const R=c[p][E];if(R.count===0)return null;const B=h.has(Z([p,E])),U=`${s[p][0]} and ${r[E][0]}<br>Count: ${R.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${B?" tyche__mosaic__cell--selected":""}`,style:{width:`${R.widthPercent}%`,minWidth:`${w}px`,minHeight:`${L}px`,...i(s[p][0],r[E][0])},onClick:()=>x(p,E),onMouseEnter:k=>d(U,k.clientX,k.clientY,"tyche-mosaic"),onMouseMove:k=>l(k.clientX,k.clientY,"tyche-mosaic"),onMouseLeave:()=>u("tyche-mosaic"),children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:R.count})},`cell-${p}-${E}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${N}px`},children:g[p]})]},`row-${p}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${_}px`},children:[e.jsx("div",{style:{width:`${S}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${N}px`},children:j.map((p,b)=>{const E=b===0,R=b===j.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${$[b]}%`,transform:E?"translateX(0%)":R?"translateX(-100%)":"translateX(-50%)",textAlign:E?"left":R?"right":"center"},children:f[p]},`total-${p}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${N}px`},children:v})]})]})}function Ps({observations:t}){function n(s,r){const i={};return s==="Passed"?i.backgroundColor=V.SUCCESS:s==="Invalid"?i.backgroundColor=V.WARNING:s==="Failed"&&(i.backgroundColor=V.ERROR),r==="Duplicate"&&(i.opacity=.7),i}return e.jsx(We,{title:"Samples",children:e.jsx(Fs,{name:"samples",observations:t,verticalAxis:[["Passed",s=>s.status==="passed"],["Invalid",s=>s.status==="gave_up"]],horizontalAxis:[["Unique",s=>s.isUnique??!1],["Duplicate",s=>s.isDuplicate??!1]],cssStyle:n})})}const _e="Present",ge="Not present";var V=(t=>(t.PRIMARY="#6b8ab5",t.SUCCESS="#8ba86b",t.WARNING="#d59a7e",t.ERROR="#c77a7e",t.ACCENT="#c1a2bb",t.ACCENT2="#9fc7c6",t.ACCENT3="#edd39a",t.ACCENT4="#99c7d6",t.ACCENT5="#8faac6",t))(V||{});function Ds({test:t}){const{filters:n,observationCategory:s,setObservationCategory:r}=Ne(),i=s==="rolling"?t.rolling_observations.sortKey(d=>-d.run_start):t.corpus_observations,a=m.useMemo(()=>{const d=Array.from(n.values()).flat();return d.length===0?i:i.filter(u=>d.every(l=>l.predicate(u)))},[i,n]),o={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(ne,{value:s,onChange:r,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx($s,{}),o.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Ps,{observations:o}),e.jsx(Ms,{observations:o}),e.jsx(Is,{observations:o,observationCategory:s})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function Bs({test:t}){return e.jsx(ks,{children:e.jsx(Ds,{test:t})})}const nt=["Skipped","SkipTest"];class he{withProperties(n){return Object.assign(Object.create(this.constructor.prototype),this,n)}}class He extends he{constructor(n,s){super(),this.state=n,this.observation=s}static fromJson(n){return new He(n.state,ue.fromJson(n.observation))}}class J extends he{constructor(n=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=n}static fromJson(n){const s=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[r,i]of Object.entries(n))console.assert(typeof i=="number"),s.set(Number(r),i);return new J(s)}add(n){const s=new Map(this.counts);for(const[r,i]of n.counts.entries())s.set(r,s.get(r)+i);return new J(s)}subtract(n){const s=new Map(this.counts);for(const[r,i]of n.counts.entries())s.set(r,s.get(r)-i);return new J(s)}sum(){return kt(this.counts.values())}}var Te=(t=>(t.GENERATE="generate",t.REPLAY="replay",t.DISTILL="distill",t.SHRINK="shrink",t.FAILED="failed",t))(Te||{});class Se extends he{constructor(s,r,i,a,o,d,u,l){super();C(this,"status_counts_diff");C(this,"elapsed_time_diff");C(this,"timestamp_monotonic");this.elapsed_time=s,this.timestamp=r,this.status_counts=i,this.behaviors=a,this.fingerprints=o,this.since_new_behavior=d,this.phase=u,this.worker_uuid=l,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(s,r){return new Se(r.elapsed_time,r.timestamp,J.fromJson(r.status_counts),r.behaviors,r.fingerprints,r.since_new_behavior,r.phase,s)}}class ue extends he{constructor(s,r,i,a,o,d,u,l,h,c,g){super();C(this,"isDuplicate",null);C(this,"isUnique",null);this.type=s,this.status=r,this.status_reason=i,this.representation=a,this.arguments_=o,this.how_generated=d,this.features=u,this.timing=l,this.metadata=h,this.property=c,this.run_start=g}static fromJson(s){return new ue(s.type,s.status,s.status_reason,s.representation,new Map(Object.entries(s.arguments)),s.how_generated,new Map(Object.entries(s.features)),new Map(Object.entries(s.timing)),new Map(Object.entries(s.metadata)),s.property,Number(s.run_start))}}var D=(t=>(t[t.FAILED_FATALLY=0]="FAILED_FATALLY",t[t.FAILED=1]="FAILED",t[t.SHRINKING=2]="SHRINKING",t[t.RUNNING=3]="RUNNING",t[t.SKIPPED_DYNAMICALLY=4]="SKIPPED_DYNAMICALLY",t[t.WAITING=5]="WAITING",t))(D||{});function rt(t,n){const s=n?n.status_counts:new J,r=n?n.elapsed_time:0,i=t.status_counts.subtract(s),a=t.elapsed_time-r,o=n?Math.max(t.timestamp,n.timestamp_monotonic+a):t.timestamp;return console.assert(Array.from(i.counts.values()).every(d=>d>=0)),console.assert(a>=0),t.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:o})}const le=class le extends he{constructor(s,r,i,a,o,d,u){super();C(this,"linear_reports");C(this,"_status_counts_cumsum");C(this,"_elapsed_time_cumsum");C(this,"load_finished_at",null);this.database_key=s,this.nodeid=r,this.rolling_observations=i,this.corpus_observations=a,this.failures=o,this.fatal_failure=d,this.reports_by_worker=u,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map,this.load_finished_at=null;const l=this.reports_by_worker;this.reports_by_worker=new Map;const h=Array.from(l.entries()).flatMap(([c,g])=>g.map(f=>[c,f])).sortKey(([c,g])=>g.timestamp);for(const[c,g]of h)this.add_report(c,g);this._check_invariants()}static fromJson(s){return new le(s.database_key,s.nodeid,[],[],new Map(Object.entries(s.failures).map(([r,i])=>[r,He.fromJson(i)])),s.fatal_failure,new Map(Object.entries(s.reports_by_worker).map(([r,i])=>[r,i.map(Se.fromJson)])))}_assert_reports_ordered(s){for(let r=0;r<s.length-1;r++)console.assert(s[r].timestamp_monotonic<=s[r+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const s=this.linear_status_counts(null);for(let i=0;i<s.length-1;i++)console.assert(s[i].sum()<=s[i+1].sum());const r=this.linear_elapsed_time(null);for(let i=0;i<r.length-1;i++)console.assert(r[i]<=r[i+1]);console.assert(r.length===s.length&&s.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(s,r){let i=null,a=0;if(this.reports_by_worker.has(s)){const d=this.reports_by_worker.get(s);a=Ce(d,r.elapsed_time,u=>u.elapsed_time),i=a!=0?d[a-1]:null}const o=rt(r,i);if(this.reports_by_worker.has(s)||this.reports_by_worker.set(s,[]),this.reports_by_worker.get(s).splice(a,0,o),o.phase!==Te.REPLAY||o.behaviors>=this.behaviors&&o.fingerprints>=this.fingerprints){const d=Ce(this.linear_reports,o.timestamp_monotonic,u=>u.timestamp_monotonic);if(this.linear_reports.splice(d,0,o),d!=this.linear_reports.length-1){let u=null,l;for(l=0;l<this.linear_reports.length-(d+1);l++){const h=this.linear_reports[d+1+l];if(o.worker_uuid===h.worker_uuid){u=h;break}}u&&(console.assert(this.linear_reports[d+1+l]===u),this.linear_reports[d+1+l]=rt(u,o));for(const h of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[c,[g,f]]of h.entries())d>=g&&h.set(c,[g,f.slice(0,d-g)])}}}get normalFailures(){return Array.from(this.failures.entries()).filter(([s,r])=>!nt.some(i=>s.includes(`${i} at`))).map(([s,r])=>r)}get skipFailures(){return Array.from(this.failures.entries()).filter(([s,r])=>nt.some(i=>s.includes(`${i} at`))).map(([s,r])=>r)}get status(){if(this.skipFailures.length>0)return D.SKIPPED_DYNAMICALLY;if(this.fatal_failure)return D.FAILED_FATALLY;if(this.failures.size>0)return D.FAILED;if(this.linear_reports.length===0)return D.WAITING;const s=this.linear_reports[this.linear_reports.length-1],r=new Date().getTime()/1e3;return s.phase==Te.SHRINK?D.SHRINKING:s.ninputs===0||s.timestamp<r-le.WAITING_STATUS_DURATION?D.WAITING:D.RUNNING}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_behavior(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_behavior}elapsed_time(s){const r=this.linear_elapsed_time(s);return r.length===0?0:r[r.length-1]}ninputs(s){const r=this.linear_status_counts(s);return r.length===0?0:r[r.length-1].sum()}_cumsum(s,r,i,a,o){if(a===null&&(a=-1/0),s.has(a)){const[h,c]=s.get(a);if(c.length<this.linear_reports.slice(h).length){let g=c.length>0?c[c.length-1]:o;for(const f of this.linear_reports.slice(h+c.length))g=i(g,f[r]),c.push(g);s.set(a,[h,c])}return c}const d=[],u=Ce(this.linear_reports,a,h=>h.timestamp_monotonic);let l=o;for(const h of this.linear_reports.slice(u))l=i(l,h[r]),d.push(l);return s.set(a,[u,d]),d}linear_status_counts(s){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(r,i)=>r.add(i),s,new J)}linear_elapsed_time(s){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(r,i)=>r+i,s,0)}};C(le,"WAITING_STATUS_DURATION",120);let Me=le;const Lt=m.createContext(null);function it(t){const n=new Map;t.forEach(r=>{n.set(r.representation,(n.get(r.representation)||0)+1)}),t.forEach(r=>{const i=n.get(r.representation);r.isUnique=i==1,r.isDuplicate=i>1});const s=new Set;t.forEach(r=>{r.features.forEach((i,a)=>{s.add(a)})}),t.forEach(r=>{s.forEach(i=>{r.features.has(i)||r.features.set(i,ge)});for(const[i,a]of r.features)a===""&&r.features.set(i,_e)})}function zs(t,n){const s=new Map(t);function r(i){if(s.has(i))return s.get(i);{const a=new Me(null,i,[],[],new Map,null,new Map);return s.set(a.nodeid,a),a}}switch(n.type){case 1:return t;case 2:{const{tests:i}=n;for(const{database_key:a,nodeid:o,failures:d,fatal_failure:u}of i){const l=r(o);l.database_key=a,d.forEach((h,c)=>{l.failures.set(c,h)}),l.fatal_failure=u}return s}case 3:{const{nodeid:i,worker_uuid:a,reports:o}=n,d=r(i);for(const u of o)d.add_report(a,u);return s}case 5:{const{nodeid:i,failures:a}=n,o=r(i);return a.forEach((d,u)=>{o.failures.set(u,d)}),s}case 4:{const{nodeid:i,observation_type:a,observations:o}=n,d=r(i);return a==="rolling"?(d.rolling_observations.push(...o),d.rolling_observations=d.rolling_observations.sortKey(u=>-u.run_start).slice(0,300),it(d.rolling_observations)):(console.assert(a==="corpus"),d.corpus_observations.push(...o),it(d.corpus_observations)),s}case 7:{const{nodeid:i}=n,a=r(i);return a.load_finished_at=Date.now(),s}default:throw new Error("non-exhaustive switch in testsReducer")}}function Os({children:t}){const[n,s]=m.useState(null),[r,i]=m.useReducer(zs,new Map),[a,o]=m.useState(!1),[d,u]=m.useState(null),[l,h]=m.useState({count_tests:null,count_tests_loaded:null}),{addNotification:c,updateNotification:g,dismissNotification:f}=Ss();m.useRef(null);const v=m.useCallback(j=>{o(!0),u(j)},[]),y=m.useCallback(()=>{const j=Date.now();return l.count_tests_loaded!==null&&l.count_tests!==null&&l.count_tests_loaded===l.count_tests&&Array.from(r.values()).every(x=>x.load_finished_at===null?!1:j-x.load_finished_at>200)},[l,r]);return m.useEffect(()=>{if(a){r.clear(),h({count_tests:null,count_tests_loaded:null});{fetch(new URL("dashboard_state/tests.json",import.meta.url)).then(x=>x.text()).then(x=>JSON.parse(x)).then(x=>{Object.entries(x).forEach(([S,_])=>{i({type:2,tests:[{database_key:_.database_key,nodeid:S,failures:_.failures,fatal_failure:_.fatal_failure}]});for(const[N,w]of Object.entries(_.reports_by_worker))i({type:3,nodeid:S,worker_uuid:N,reports:w.map(L=>Se.fromJson(N,L))});i({type:7,nodeid:S})})});const j=new Worker(new URL("/preview-209/example-dashboard/assets/jsonWorker-KJVNTzbb.js",import.meta.url));return fetch(new URL("dashboard_state/observations.json",import.meta.url)).then(x=>x.text()).then(x=>new Promise(S=>{j.onmessage=_=>S(_.data),j.postMessage(x)})).then(x=>{for(const[S,_]of Object.entries(x))i({type:4,nodeid:S,observation_type:"rolling",observations:_.rolling.map(ue.fromJson)}),i({type:4,nodeid:S,observation_type:"corpus",observations:_.corpus.map(ue.fromJson)})}),()=>j.terminate()}}},[d,a,c,f,g]),e.jsx(Lt.Provider,{value:{tests:r,socket:n,doLoadData:v,testsLoaded:y},children:t})}function Ye(t=null){const n=m.useContext(Lt);if(!n)throw new Error("useData must be used within a DataProvider");return m.useEffect(()=>{n.doLoadData(t)},[t,n]),n}function pe({to:t,icon:n,children:s,isActive:r}){const i=Pe();return e.jsx(Q,{to:t,className:"sidebar__link__text",children:e.jsxs("div",{className:`sidebar__link ${r(i.pathname)?"sidebar__link--active":""}`,children:[e.jsx("span",{className:"sidebar__link__icon",children:n}),s]})})}function Us(){const t=Pe(),[n,s]=m.useState(!1),r=m.useRef(null);return m.useEffect(()=>{function i(a){var o;n&&((o=r.current)==null?void 0:o.contains(a.target))===!1&&s(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[n]),m.useEffect(()=>{s(!1)},[t]),e.jsxs("div",{className:"layout",children:[!n&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>s(!0),children:e.jsx(A,{icon:Qt,size:"lg"})}),n&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:r,className:`sidebar ${n?"sidebar--open":""}`,children:[e.jsx(Q,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(pe,{to:"/",isActive:i=>i==="/"||i.startsWith("/tests/"),icon:e.jsx(A,{icon:Zt}),children:"Tests"}),e.jsx(pe,{icon:e.jsx(A,{icon:es}),to:"/patches",isActive:i=>i==="/patches",children:"Patches"}),e.jsx(pe,{icon:e.jsx(A,{icon:ts}),to:"/collected",isActive:i=>i==="/collected",children:"Collection"}),e.jsx(pe,{icon:e.jsx(A,{icon:Le}),to:"/workers",isActive:i=>i==="/workers",children:"Workers"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/preview-209/example-dashboard".replace(/\/$/,"")}/docs/`,className:"sidebar__link__text",children:e.jsxs("div",{className:"sidebar__link",children:[e.jsx("span",{className:"sidebar__link__icon",children:e.jsx(A,{icon:ss})}),"Docs"]})})]})]}),e.jsx("div",{className:"content",children:e.jsx(Vt,{})})]})}function Xe({headers:t,data:n,row:s,mobileRow:r,getKey:i,onFilterChange:a,filterStrings:o}){const[d,u]=m.useState(null),[l,h]=m.useState(0),[c,g]=m.useState(""),f=Ue(),v=m.useMemo(()=>{let x=n;if(c&&(x=n.filter(_=>o?o(_).some(N=>N.toLowerCase().includes(c.toLowerCase())):!0)),d===null)return x;const S=[...x].sortKey(_=>t[d].sortKey(_));return l===0?S:S.reverse()},[n,d,l,t,c,o]),y=x=>{t[x].sortKey&&(d===x?h(S=>S===0?1:0):(u(x),h(0)))};function j(x){g(x),a==null||a(x)}return e.jsxs("div",{className:"table",children:[o!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:c,onChange:x=>j(x.target.value),className:"table__filter__input"}),c&&e.jsx("span",{className:"table__filter__clear",onClick:()=>j(""),children:e.jsx(A,{icon:ns})})]}),r!==void 0&&f?v.map(x=>e.jsx("div",{children:r(x)},i?i(x):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.map((x,S)=>e.jsx("th",{onClick:()=>y(S),className:x.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${x.align??"left"}`,children:[x.content,x.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(_=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${_===0?"asc":"desc"} ${d===S&&l===_?"table__sort__arrow--active":""}`,children:_===0?e.jsx(A,{icon:rs}):e.jsx(A,{icon:is})}))})]})},S))})}),e.jsx("tbody",{children:v.map(x=>{const S=s(x);return console.assert(S.length===t.length),e.jsx("tr",{children:S.map((_,N)=>e.jsx("td",{children:_},N))},i?i(x):void 0)})})]}),c&&v.length<n.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",v.length," of ",n.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{g(""),a==null||a("")},children:"[clear]"})]})]})}async function Ge(t){return await(await fetch(new URL("dashboard_state/api.json",import.meta.url))).json()}async function Vs(t){var s;const n=await Ge();return(s=n==null?void 0:n.patches)==null?void 0:s[t]}async function Tt(){const t=await Ge();return t==null?void 0:t.available_patches}async function Ks(){const t=await Ge();return t==null?void 0:t.collection_status}const at={not_collected:0,collected:1};function Ws(){const[t,n]=m.useState(null);if(m.useEffect(()=>{Ks().then(a=>{n(a)})},[]),t===null)return null;if(!t.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const s=[...t].sortKey(a=>[at[a.status],a.status_reason,a.nodeid]),r=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[at[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(Q,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(Xe,{headers:r,data:s,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function Hs(){return e.jsx("h1",{children:"Page not found!"})}function Ys(t){const n=t.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:n.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:n.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}de.registerLanguage("diff",Ys);function Mt({nodeid:t}){const[n,s]=m.useState({}),[r,i]=m.useState(!0),[a,o]=m.useState(null),[d,u]=m.useState(!1),l=m.useRef(null);if(m.useEffect(()=>{Vs(t).then(y=>{y&&s(y),i(!1)})},[t]),m.useEffect(()=>{At(l,!0)},[n,a]),r)return e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading patches..."})});if(Object.values(n).every(y=>y===null))return e.jsx("div",{className:"card",children:e.jsx("p",{children:"No patches for this test"})});const h=new Map([["failing","Failing"],["covering","Covering"]]),c=a??Array.from(h.keys()).find(y=>n[y]),g=n[c],f=async()=>{await navigator.clipboard.writeText(g),u(!0),setTimeout(()=>{u(!1)},2e3)},v=()=>{const y=new Blob([g],{type:"text/plain"}),j=URL.createObjectURL(y),x=document.createElement("a");x.href=j,x.download=`${c}-${t.split("::").pop()}.patch`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(j)};return e.jsxs("div",{ref:l,children:[e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(ne,{value:c,onChange:o,options:Array.from(h.entries()).filter(([y])=>n[y]).map(([y,j])=>({value:y,content:j}))})}),e.jsxs("pre",{className:"patch__pre",children:[e.jsxs("div",{className:"patch__controls",children:[e.jsx("div",{className:`patch__controls__control ${d?"patch__controls__control--success":""}`,onClick:f,title:"Copy patch",children:e.jsx(A,{icon:d?as:os})}),e.jsx("div",{className:"patch__controls__control",onClick:v,title:"Download patch",children:e.jsx(A,{icon:ls})})]}),e.jsx("code",{className:"language-diff",children:g})]})]})}function Xs(){const[t,n]=m.useState(null);return m.useEffect(()=>{Tt().then(s=>{n(s)})},[]),t===null||t.length===0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No tests with patches present."})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Patches"}),t.map(s=>e.jsx(Ke,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:s}),e.jsxs(Q,{to:`/tests/${encodeURIComponent(s)}`,className:"patches__test__link",style:{marginLeft:"8px"},children:["View test ",e.jsx(A,{icon:cs})]})]}),headerClass:"patches__test",defaultState:"closed",children:e.jsx(Mt,{nodeid:s})}))]})}const F={scaleSymlog:ms,scaleLinear:Oe,select:Be,zoom:yt,zoomIdentity:bt,pointer:gs,line:_s,axisBottom:gt,axisLeft:_t,brush:fs,scaleOrdinal:ze,schemeCategory10:vt,interpolateViridis:xt,quadtree:ps};class je{constructor(n,s,r,i,a){this.nodeid=n,this.linear_status_counts=s,this.linear_elapsed_time=r,this.behaviors=i,this.fingerprints=a}static fromReport(n,s){return new je(n,s.status_counts,s.elapsed_time,s.behaviors,s.fingerprints)}}const Gs=10,$t=270,ot=5;class qs{constructor(n,s,r,i,a,o,d,u){C(this,"lines");C(this,"scaleSetting");C(this,"scaleSettingY");C(this,"axisSettingX");C(this,"axisSettingY");C(this,"xValue");C(this,"yValue");C(this,"width");C(this,"height");C(this,"margin");C(this,"x");C(this,"y");C(this,"g");C(this,"zoom");C(this,"chartArea");C(this,"navigate");C(this,"tooltip");C(this,"brush",null);C(this,"eventListeners",new Map);C(this,"xAxis");C(this,"yAxis");C(this,"viewportX");C(this,"viewportY");C(this,"quadtree");this.lines=s,this.scaleSetting=r,this.scaleSettingY=i,this.axisSettingX=a,this.axisSettingY=o,this.navigate=d,this.xValue=c=>a=="time"?c.linear_elapsed_time:c.linear_status_counts.sum(),this.yValue=c=>o=="behaviors"?c.behaviors:c.fingerprints,this.margin={top:5,right:5,bottom:25,left:40},this.width=n.clientWidth-this.margin.left-this.margin.right,this.height=$t-this.margin.top-this.margin.bottom;const l=s.map(c=>c.reports).flat();this.x=(r==="log"?F.scaleSymlog():F.scaleLinear()).domain([0,ce(l.map(c=>this.xValue(c)))||1]).range([0,this.width]),this.y=(i==="log"?F.scaleSymlog():F.scaleLinear()).domain([0,ce(l.map(c=>this.yValue(c)))||0]).range([this.height,0]),this.viewportX=this.x,this.viewportY=this.y,this.g=F.select(n).append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`);const h=this.g.append("defs");h.append("clipPath").attr("id","clip-content").append("rect").attr("width",this.width).attr("height",this.height+5).attr("x",0).attr("y",-5),h.append("clipPath").attr("id","clip-x-axis").append("rect").attr("width",this.width+ot*2).attr("height",this.height).attr("x",-ot).attr("y"),this.chartArea=this.g.append("g").attr("class","chart-area").attr("clip-path","url(#clip-content)"),this.chartArea.append("rect").attr("width",this.width).attr("height",this.height).attr("fill","none").attr("pointer-events","all"),this.zoom=F.zoom().scaleExtent([1,1/0]).on("zoom",c=>this.zoomTo(c.transform,!1)),this.chartArea.call(this.zoom),this.chartArea.on("dblclick.zoom",()=>{this.chartArea.transition().duration(500).call(this.zoom.transform,F.zoomIdentity)}),this.tooltip=F.select(".coverage-graph__tooltip"),this.xAxis=this.g.append("g").attr("transform",`translate(0,${this.height})`).attr("clip-path","url(#clip-x-axis)").call(this.createXAxis(this.x)),this.yAxis=this.g.append("g").call(this.createYAxis(this.y)),this.chartArea.on("mousemove",c=>{const[g,f]=F.pointer(c),v=this.quadtree.find(g,f,Gs);if(v){const y=v.behaviors==1?"":"s",j=v.fingerprints==1?"":"s",x=v.linear_status_counts.sum()==1?"":"s",S=v.linear_elapsed_time==1?"":"s";this.tooltip.style("display","block").style("left",`${c.pageX+10}px`).style("top",`${c.pageY-10}px`).html(`
                <strong>${Et(v.nodeid)}</strong><br/>
                ${v.behaviors.toLocaleString()} behavior${y} / ${v.fingerprints.toLocaleString()} fingerprint${j}<br/>
                ${v.linear_status_counts.sum().toLocaleString()} input${x} / ${v.linear_elapsed_time.toFixed(1)} second${S}
              `)}else this.tooltip.style("display","none")}).on("mouseout",()=>{this.tooltip.style("display","none")}),this.drawLines(),this.updateQuadtree()}logAxis(n,s){const r=[0];let i=1;for(;i<=s;)r.push(i),i*=10;return n.tickValues(r).tickFormat(a=>{const o=a.valueOf();return console.assert(o>=0),o>=1e6?`${Math.floor(o/1e6)}M`:o>=1e3?`${Math.floor(o/1e3)}k`:o>0?o.toLocaleString():"0"})}createXAxis(n){if(this.scaleSetting==="log"){const s=n.domain()[1];return this.logAxis(F.axisBottom(n),s)}else return F.axisBottom(n).ticks(5).tickFormat(s=>s.toLocaleString())}createYAxis(n){if(this.scaleSettingY==="log"){const s=n.domain()[1];return this.logAxis(F.axisLeft(n),s)}else return F.axisLeft(n).ticks(5)}updateQuadtree(){const n=this.lines.map(s=>s.reports).flat();this.quadtree=F.quadtree().x(s=>this.viewportX(this.xValue(s))).y(s=>this.viewportY(this.yValue(s))).addAll(n)}zoomTo(n,s){const r=n.rescaleX(this.x),i=s?n.rescaleY(this.y):this.y;this.viewportX=r,this.viewportY=i,this.xAxis.call(this.createXAxis(r)),s&&this.yAxis.call(this.createYAxis(i)),this.g.selectAll(".chart-area path").attr("d",F.line().x(a=>r(this.xValue(a))).y(a=>i(this.yValue(a)))),this.updateQuadtree()}drawLines(){const n=F.line().x(s=>this.x(this.xValue(s))).y(s=>this.y(this.yValue(s)));this.lines.forEach(s=>{this.chartArea.append("path").datum(s.reports).attr("fill","none").attr("stroke",s.color).attr("d",n).attr("class","coverage-line").style("cursor","pointer").on("mouseover",function(){F.select(this).classed("coverage-line__selected",!0)}).on("mouseout",function(){F.select(this).classed("coverage-line__selected",!1)}).on("click",r=>{s.url&&Ct(r,s.url,this.navigate)})})}enableBoxBrush(){for(const n of["wheel","mousedown","mousemove","mouseup"])this.chartArea.on(`${n}.zoom`,null);this.brush=F.brush().extent([[0,0],[this.width,this.height]]).on("end",n=>{if(!n.selection)return;const[[s,r],[i,a]]=n.selection;if(this.chartArea.call(this.brush.clear),this.chartArea.call(this.zoom),Math.abs(i-s)<5||Math.abs(a-r)<5){this.emit("boxSelectEnd");return}const o=this.width/(i-s),d=this.height/(a-r),u=Math.max(o,d),l=F.zoomIdentity.translate(this.width/2,this.height/2).scale(u).translate(-(s+i)/2,-(r+a)/2);this.chartArea.transition().duration(250).call(this.zoom.transform,l).on("end",()=>{this.emit("boxSelectEnd")})}),this.chartArea.style("cursor","crosshair").call(this.brush)}cleanup(){this.tooltip.style("display","none"),this.g.selectAll("path").classed("coverage-line__selected",!1)}on(n,s){this.eventListeners.has(n)||this.eventListeners.set(n,[]),this.eventListeners.get(n).push(s)}off(n,s){this.eventListeners.has(n)&&this.eventListeners.set(n,this.eventListeners.get(n).filter(r=>r!==s))}emit(n){this.eventListeners.has(n)&&this.eventListeners.get(n).forEach(s=>s())}}const ae=new Map;function X(t,n){const[s,r]=m.useState(()=>{const a=sessionStorage.getItem(t);return a===null?n:JSON.parse(a)});m.useEffect(()=>(ae.has(t)||ae.set(t,new Set),ae.get(t).add(r),()=>{ae.get(t).delete(r)}),[t]);function i(a){sessionStorage.setItem(t,JSON.stringify(a)),ae.get(t).forEach(o=>o(a))}return[s,i]}const se={zoom:yt,zoomIdentity:bt,select:Be,scaleLinear:Oe,scaleOrdinal:ze,interpolateViridis:xt,interpolateRgb:xs,schemeCategory10:vt},lt=se.scaleLinear().domain([0,1]).range(["rgb(255, 198, 128)","rgb(240, 136, 62)","rgb(219, 109, 40)","rgb(189, 86, 29)","rgb(155, 66, 21)","rgb(118, 45, 10)","rgb(90, 30, 2)"]).interpolate(se.interpolateRgb);var $e=(t=>(t.TOGETHER="linearized",t.SEPARATE="individual",t.LATEST="latest",t))($e||{});function Js(t,n){const s=t.linear_status_counts(n),r=t.linear_elapsed_time(n),i=[];for(let a=0;a<s.length;a++){const o=t.linear_reports[a];i.push({nodeid:t.nodeid,linear_status_counts:s[a],linear_elapsed_time:r[a],behaviors:o.behaviors,fingerprints:o.fingerprints})}return i}function It({value:t,onChange:n}){return e.jsx(ne,{value:t,onChange:n,options:[{value:"log",content:"Log"},{value:"linear",content:"Linear"}]})}function Qs(){const[t,n]=X("graph_scale_x","log"),[s,r]=X("graph_axis_x","time");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--x",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(A,{icon:s==="inputs"?be:ye,style:{fontSize:"0.9rem"}}),s==="inputs"?"Inputs":"Time"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(It,{value:t,onChange:n}),e.jsx(ne,{value:s,onChange:r,options:[{value:"inputs",content:e.jsx(A,{icon:be})},{value:"time",content:e.jsx(A,{icon:ye})}]})]})]})}function Zs(){const[t,n]=X("graph_scale_y","linear"),[s,r]=X("graph_axis_y","behaviors");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--y",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(It,{value:t,onChange:n}),e.jsx(ne,{value:s,onChange:r,options:[{value:"behaviors",content:e.jsx(A,{icon:xe})},{value:"fingerprints",content:e.jsx(A,{icon:ve})}]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(A,{icon:s==="behaviors"?xe:ve,style:{fontSize:"0.9rem"}}),s==="behaviors"?"Behaviors":"Fingerprints"]})]})}const ct={linearized:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:Le})," Together"]}),mobileContent:e.jsx(A,{icon:Le})},individual:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:Je})," Separate"]}),mobileContent:e.jsx(A,{icon:Je})},latest:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:qe})," Latest"]}),mobileContent:e.jsx(A,{icon:qe})}};function en({tests:t,filterString:n="",testsLoaded:s,workers_after:r=null,viewSetting:i}){const a=m.useRef(null),[o,d]=X("graph_scale_x","log"),[u,l]=X("graph_scale_y","linear"),[h,c]=X("graph_axis_x","time"),[g,f]=X("graph_axis_y","behaviors"),[v,y]=m.useState(!0),[j,x]=m.useState({transform:null,zoomY:!1}),[S,_]=m.useState(!1),N=ht(),w=Ue(),[L,T]=m.useState(!1),I=se.scaleOrdinal(se.schemeCategory10).domain(Array.from(t.keys())),M=m.useMemo(()=>{let P=[];if(i==="linearized")P=Array.from(t.entries()).sortKey(([p,b])=>p).map(([p,b])=>({url:`/tests/${encodeURIComponent(p)}`,reports:Js(b,r),color:I(p)}));else if(i==="individual"){let p=function(B){if(b.length<=1)return lt(.5);const U=(B-E)/(R-E);return lt(U)};const b=[];for(const B of t.values())for(const U of B.reports_by_worker.values())U.length>0&&b.push(U[0].timestamp);const E=Rs(b)??0,R=ce(b)??0;for(const[B,U]of t.entries())for(const k of U.reports_by_worker.values())k.length>0&&P.push({url:null,reports:k.map(K=>je.fromReport(B,K)),color:p(k[0].timestamp)})}else if(i==="latest")for(const[p,b]of t.entries()){const E=ce(Array.from(b.reports_by_worker.values()),R=>R[0].elapsed_time);E&&P.push({url:null,reports:E.map(R=>je.fromReport(p,R)),color:I(p)})}return P},[t,r,i,I]),$=m.useMemo(()=>n?M.filter(P=>{var p;return(p=P.url)==null?void 0:p.toLowerCase().includes(n.toLowerCase())}):M,[M,n]);return m.useEffect(()=>{const P=()=>{_(!S),y(!0)};if(!a.current||!v&&L&&s())return;v&&y(!1),se.select(a.current).selectAll("*").remove();const p=new qs(a.current,$,o,u,h,g,N,w);return j.transform&&p.zoom.transform(p.chartArea,j.transform),p.zoomTo(j.transform??se.zoomIdentity,j.zoomY),p.zoom.on("zoom.saveTransform",b=>{x({transform:b.transform,zoomY:!1})}),S&&p.enableBoxBrush(),p.on("boxSelectEnd",P),()=>{p.cleanup()}},[t,o,u,h,g,i,v,S,N,w,L,s,n]),e.jsx("svg",{className:"coverage-graph__svg",ref:a,style:{width:"100%",height:`${$t}px`},onMouseEnter:()=>T(!0),onMouseLeave:()=>{T(!1),y(!0)}})}function tn(){const t=["rgb(255, 198, 128)","rgb(240, 136, 62)","rgb(219, 109, 40)","rgb(189, 86, 29)","rgb(155, 66, 21)","rgb(118, 45, 10)","rgb(90, 30, 2)"];return e.jsxs("div",{className:"coverage-graph__color-legend",children:[e.jsx("span",{children:"Older"}),e.jsx("div",{style:{display:"flex",gap:"2px"},children:t.map((n,s)=>e.jsx("div",{className:"coverage-graph__color-legend__square",style:{backgroundColor:n}},s))}),e.jsx("span",{children:"Newer"})]})}function Ft({tests:t,filterString:n="",testsLoaded:s,workers_after:r=null,workerViews:i=["linearized","individual","latest"],workerViewSetting:a}){let[o,d]=X(a,"linearized");const l=O(Array.from(t.values()).flatMap(h=>Array.from(h.reports_by_worker.values()))).size==1;return l&&(o="linearized"),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Coverage"}),e.jsx("div",{className:"coverage-graph__tooltip"}),e.jsxs("div",{style:{display:"flex",justifyContent:o==="individual"?"space-between":"flex-end",alignItems:o==="individual"?"center":"default",marginBottom:"1rem"},children:[o==="individual"&&e.jsx(tn,{}),e.jsxs("span",{className:"tooltip",children:[e.jsx(ne,{value:o,onChange:d,options:i.map(h=>({value:h,content:ct[h].content,mobileContent:ct[h].mobileContent})),disabled:l}),l&&e.jsx("span",{className:"tooltip__text",children:"Switching worker display mode requires multiple workers"})]})]}),e.jsx("div",{className:"coverage-graph__container",children:e.jsxs("div",{className:"coverage-graph__grid",style:{marginRight:"15px",flex:1,height:"auto"},children:[e.jsx(Zs,{}),e.jsx(en,{tests:t,testsLoaded:s,viewSetting:o,workers_after:r,filterString:n}),e.jsx("div",{}),e.jsx(Qs,{})]})})]})}const te={[D.FAILED_FATALLY]:"Failed fatally",[D.FAILED]:"Failed",[D.SHRINKING]:"Shrinking",[D.RUNNING]:"Running",[D.SKIPPED_DYNAMICALLY]:"Skipped dynamically",[D.WAITING]:"Waiting"};function Ie({status:t}){return e.jsx("span",{style:{textAlign:"center"},children:t===D.FAILED_FATALLY?e.jsx("span",{className:"pill pill__failure",children:te[t]}):t===D.FAILED?e.jsx("span",{className:"pill pill__failure",children:te[t]}):t===D.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:te[t]}):t===D.RUNNING?e.jsx("span",{className:"pill pill__success",children:te[t]}):e.jsx("span",{className:"pill pill__neutral",children:te[t]})})}function q({content:t,tooltip:n}){return e.jsxs("span",{className:"tooltip tooltip--underline",children:[t,e.jsx("div",{className:"tooltip__text",children:n})]})}function Pt(t){const n=Math.floor(t/3600),s=Math.floor(t%3600/60),r=Math.floor(t%60);return`${n>0?`${n}:${s.toString().padStart(2,"0")}`:s}:${r.toString().padStart(2,"0")}`}function Dt(t){const n=t.ninputs(null),s=t.elapsed_time(null);return s===0?null:n/s}function Fe(t){var s;if(t.linear_reports.length===0)return{inputs:"—",behaviors:"—",fingerprints:"—",executions:"—",inputsSinceBranch:"—",timeSpent:"—"};const n=Dt(t);return{inputs:t.ninputs(null).toLocaleString(),behaviors:t.behaviors.toLocaleString(),fingerprints:t.fingerprints.toLocaleString(),executions:n===null?"—":`${n.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((s=t.since_new_behavior)==null?void 0:s.toLocaleString())??"—",timeSpent:Pt(t.elapsed_time(null))}}de.registerLanguage("python",Rt);function sn({failure:t}){return e.jsx("span",{style:{textAlign:"center"},children:t.state==="shrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Fully shrunk"}):t.state==="unshrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Still shrinking..."}):e.jsx(e.Fragment,{})})}function nn({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem",marginBottom:"1rem"},children:[e.jsx("div",{className:"failure__title",children:"Failure"}),e.jsx(sn,{failure:t})]}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("reproduction_decorator")+`
`+t.observation.representation})}),e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("traceback")})})]})]})}function rn({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"failure__title",children:"Fatal failure"}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",style:{whiteSpace:"pre-wrap"},children:t})})]})]})}function an(){const{nodeid:t}=Kt(),{tests:n,testsLoaded:s}=Ye(t),r=m.useRef(null),[i,a]=m.useState(null);m.useEffect(()=>{Tt().then(l=>{a(l)})},[]);const o=n.get(t)??null;if(m.useEffect(()=>{o&&At(r)},[o]),!t||!o)return e.jsx("div",{children:"Test not found"});const d=Fe(o),u=[{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:be})}),tooltip:"Number of inputs"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:xe})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:ve})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:pt})}),tooltip:"Inputs per second"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:ft})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:ye})}),tooltip:"Total time spent running"})}];return e.jsxs("div",{ref:r,children:[e.jsxs(Q,{to:"/",className:"back-link",children:[e.jsx(A,{icon:us})," All tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:t}),e.jsx(Ie,{status:o.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(Xe,{headers:u,data:[d],row:l=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.timeSpent})]})})]}),e.jsx(Ft,{tests:new Map([[t,o]]),testsLoaded:s,workerViewSetting:"graph_worker_view_test"}),o.normalFailures.map(l=>e.jsx(nn,{failure:l})),o.fatal_failure&&e.jsx(rn,{failure:o.fatal_failure}),e.jsx(Bs,{test:o}),(i==null?void 0:i.includes(t))&&e.jsx("div",{className:"card",children:e.jsx(Ke,{title:"Patches",defaultState:"closed",headerClass:"card__header",children:e.jsx(Mt,{nodeid:t})})})]})}function ee({icon:t,tooltip:n}){return e.jsx(q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:t})}),tooltip:n})}function oe({icon:t,value:n}){return e.jsxs("div",{className:"table__inline-statistic",children:[t,e.jsx("span",{className:"table__inline-statistic__value",children:n})]})}function on({tests:t,onFilterChange:n}){const s=Array.from(t).sortKey(([f,v])=>{const y=v.ninputs(null);return[v.status,y!=null?-y:-1,f]}).map(([f,v])=>v),r=e.jsx(ee,{icon:be,tooltip:"Number of inputs"}),i=e.jsx(ee,{icon:xe,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(ee,{icon:ve,tooltip:"Number of fingerprints (sets of behaviors) found"}),o=e.jsx(ee,{icon:pt,tooltip:"Inputs per second"}),d=e.jsx(ee,{icon:ft,tooltip:"Number of inputs since a new behavior"}),u=e.jsx(ee,{icon:ye,tooltip:"Total time spent running"}),l=[{content:"Test",sortKey:f=>f.nodeid},{content:"Status",sortKey:f=>f.status,align:"center"},{content:r,align:"right",sortKey:f=>f.ninputs(null)},{content:i,align:"right",sortKey:f=>f.behaviors},{content:a,align:"right",sortKey:f=>f.fingerprints},{content:o,align:"right",sortKey:f=>Dt(f)??-1},{content:d,align:"right",sortKey:f=>f.since_new_behavior??0},{content:u,align:"right",sortKey:f=>f.elapsed_time(null)}],h=f=>{const v=Fe(f);return[e.jsx(Q,{to:`/tests/${encodeURIComponent(f.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:f.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Ie,{status:f.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:v.timeSpent})]};function c(f){const v=Fe(f);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(Q,{to:`/tests/${encodeURIComponent(f.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:f.nodeid}),e.jsx(Ie,{status:f.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(oe,{icon:r,value:v.inputs}),e.jsx(oe,{icon:i,value:v.behaviors}),e.jsx(oe,{icon:o,value:v.executions}),e.jsx(oe,{icon:d,value:v.inputsSinceBranch}),e.jsx(oe,{icon:u,value:v.timeSpent})]})]})}function g(f){return[f.nodeid,te[f.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(Xe,{headers:l,data:s,row:h,mobileRow:c,getKey:f=>f.database_key??void 0,filterStrings:g,onFilterChange:n})]})}function ln(){const{tests:t,testsLoaded:n}=Ye(),[s,r]=m.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx(Ft,{tests:t,filterString:s,testsLoaded:n,workerViews:[$e.TOGETHER,$e.LATEST],workerViewSetting:"graph_worker_view_tests"}),e.jsx(on,{tests:t,onFilterChange:r})]})}function cn({min:t,max:n,value:s,onChange:r,step:i=1}){const[a,o]=m.useState(null),d=m.useRef(null);console.assert(t<=n,`min: ${t} max: ${n}`);const[u,l]=s,h=n-t,c=h===0?0:(u-t)/h*100,g=h===0?100:(l-t)/h*100,f=c<50?1:2,v=g<50?2:1,y=m.useCallback(N=>{if(!d.current)return t;const w=d.current.getBoundingClientRect(),L=Math.max(0,Math.min(100,(N-w.left)/w.width*100)),T=t+L/100*h,I=Math.round(T/i)*i;return Math.max(t,Math.min(n,I))},[t,n,h,i]),j=N=>w=>{w.preventDefault(),o(N)},x=m.useCallback(N=>{if(!a)return;const w=y(N.clientX);r(a==="min"?[Math.min(w,l),l]:[u,Math.max(w,u)])},[a,y,u,l,r]),S=m.useCallback(()=>{o(null)},[]),_=N=>{if(a)return;const w=y(N.clientX),L=Math.abs(w-u),T=Math.abs(w-l);L<T?r([Math.min(w,l),l]):r([u,Math.max(w,u)])};return m.useEffect(()=>a?(document.addEventListener("mousemove",x),document.addEventListener("mouseup",S),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",S)}):()=>{},[a,x,S]),e.jsx("div",{className:"range-slider",children:e.jsx("div",{className:"range-slider__container",children:e.jsxs("div",{ref:d,className:"range-slider__track",onClick:_,children:[e.jsx("div",{className:"range-slider__range",style:{left:`${c}%`,width:`${g-c}%`}}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--min",style:{left:`${c}%`,zIndex:f},onMouseDown:j("min")}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--max",style:{left:`${g}%`,zIndex:v},onMouseDown:j("max")})]})})})}let un=class{constructor(n,s){this.uuid=n,this.segments=s}visibleSegments(n){return this.segments.filter(s=>s.end>=n[0]&&s.start<=n[1])}};function we(t){return new Date(t*1e3).toLocaleString()}const dn=24*60*60;function ut(t,n){return[Math.max(t,n-dn),n]}function hn(t){let n=0;for(let a=0;a<t.length;a++)n=(n<<5)-n+t.charCodeAt(a)&4294967295;const s=Math.abs(n)%360,r=45+Math.abs(n>>8)%30,i=45+Math.abs(n>>16)%20;return`hsl(${s}, ${r}%, ${i}%)`}function fe({label:t,value:n}){return e.jsxs("div",{className:"workers__worker__details__item",children:[e.jsx("span",{className:"workers__worker__details__label",children:t}),e.jsx("span",{className:"workers__worker__details__value",children:n})]})}const mn=De.memo(({worker:t,range:n,expandedWorkers:s,onWorkerClick:r,segmentStyle:i,navigate:a,showTooltip:o,hideTooltip:d,moveTooltip:u})=>e.jsxs("div",{className:`workers__worker ${s.has(t.uuid)?"workers__worker--expanded":""}`,onClick:()=>r(t.uuid),onMouseLeave:()=>d("workers"),children:[e.jsx("div",{className:"workers__worker__bar",onMouseLeave:()=>d("workers"),children:t.visibleSegments(n).map((l,h)=>e.jsx("div",{className:"workers__timeline__segment",style:i(l),onClick:c=>{Ct(c,`/tests/${encodeURIComponent(l.nodeid)}`,a),c.stopPropagation()},onMouseEnter:c=>o(Et(l.nodeid),c.clientX,c.clientY,"workers"),onMouseLeave:()=>d("workers"),onMouseMove:c=>u(c.clientX,c.clientY,"workers")},h))}),s.has(t.uuid)&&e.jsx(pn,{worker:t})]},t.uuid)),pn=De.memo(({worker:t})=>e.jsx("div",{className:"workers__worker__details",children:e.jsxs("div",{className:"workers__worker__details__grid",children:[e.jsx(fe,{label:"Worker UUID",value:t.uuid}),e.jsx(fe,{label:"Lifetime",value:Pt(t.segments[t.segments.length-1].end-t.segments[0].start)}),e.jsx(fe,{label:"Started",value:we(t.segments[0].start)}),e.jsx(fe,{label:"Last seen",value:we(t.segments[t.segments.length-1].end)})]})}));function fn(){const{tests:t}=Ye(),n=ht(),{showTooltip:s,hideTooltip:r,moveTooltip:i}=Ve(),[a,o]=m.useState(new Set),d=ds(Array.from(t.values()).map(_=>Array.from(_.reports_by_worker.keys())).flat().sortKey(_=>_)),u=new Map;d.forEach(_=>{const N=[];u.set(_,N),Array.from(t.values()).forEach(w=>{if(!w.reports_by_worker.has(_))return;const L=w.reports_by_worker.get(_);N.push(...L.map(T=>({timestamp_monotonic:T.timestamp_monotonic,nodeid:w.nodeid})))}),N.sortKey(w=>w.timestamp_monotonic)});let l=1/0,h=-1/0,c=[];d.forEach(_=>{const N=u.get(_),w=[];let L=null;N.forEach((T,I)=>{l=Math.min(l,T.timestamp_monotonic),h=Math.max(h,T.timestamp_monotonic),!L||L.nodeid!==T.nodeid?(L&&w.push(L),L={nodeid:T.nodeid,start:T.timestamp_monotonic,end:T.timestamp_monotonic}):L.end=T.timestamp_monotonic,I===N.length-1&&L&&w.push(L)}),c.push(new un(_,w))}),c.sortKey(_=>_.segments[0].start);const[g,f]=m.useState(ut(l,h));m.useEffect(()=>{f(ut(l,h))},[l,h]);const[v,y]=g,j=y-v,x=m.useCallback(_=>{let N,w;return j===0?(N=0,w=100):(N=(_.start-v)/j*100,w=(_.end-_.start)/j*100),{left:`${N}%`,width:`${w}%`,backgroundColor:hn(_.nodeid)}},[j,v]),S=m.useCallback(_=>{o(N=>{const w=new Set(N);return w.has(_)?w.delete(_):w.add(_),w})},[]);return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Workers "}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"card__text",children:[e.jsx("div",{className:"card__text__paragraph",children:"This page shows the history of your workers, and what tests they have been fuzzing."}),e.jsx("div",{className:"card__text__paragraph",children:'Roughly speaking, "one worker" = "one CPU core".'})]}),e.jsxs("div",{className:"workers",children:[e.jsx("div",{className:"workers__controls",children:e.jsx(cn,{min:l,max:h,value:g,onChange:_=>f(_),step:(h-l)/1e3})}),e.jsxs("div",{className:"workers__timeline-header",children:[e.jsx("span",{className:"workers__timeline-header__label",children:we(v)}),e.jsx("span",{className:"workers__timeline-header__label",children:we(y)})]}),c.map(_=>_.visibleSegments(g).length>0&&e.jsx(mn,{worker:_,range:g,expandedWorkers:a,onWorkerClick:S,segmentStyle:x,navigate:n,showTooltip:s,hideTooltip:r,moveTooltip:i},_.uuid))]})]})]})}function _n(){const t=Wt;return e.jsx(t,{children:e.jsx(Ns,{children:e.jsx(Os,{children:e.jsx(Cs,{children:e.jsx(Ht,{children:e.jsxs(G,{element:e.jsx(Us,{}),children:[e.jsx(G,{path:"/",element:e.jsx(ln,{})}),e.jsx(G,{path:"/patches",element:e.jsx(Xs,{})}),e.jsx(G,{path:"/collected",element:e.jsx(Ws,{})}),e.jsx(G,{path:"/workers",element:e.jsx(fn,{})}),e.jsx(G,{path:"/tests/:nodeid",element:e.jsx(an,{})}),e.jsx(G,{path:"*",element:e.jsx(Hs,{})})]})})})})})})}js.createRoot(document.getElementById("app")).render(e.jsx(De.StrictMode,{children:e.jsx(_n,{})}));
