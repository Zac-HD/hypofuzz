var ct=Object.defineProperty;var ut=(s,r,t)=>r in s?ct(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var w=(s,r,t)=>ut(s,typeof r!="symbol"?r+"":r,t);import{r as dt,g as Ve,u as ht,a as f,L as X,O as pt,b as mt,c as ft,d as _t,H as gt,e as xt,f as q,R as vt}from"./react-DOgvK_Td.js";import{F as T,f as bt,S as O,a as yt,b as jt,c as Ue,r as wt,d as Nt,e as St,L as Q,g as At,h as Rt,i as Et,j as ae,k as oe,l as le,m as ce,n as Ct,o as ze,p as Ke}from"./vendor-C4Ccat8y.js";import{d as We,a as He,b as Xe,c as Tt,o as Ye,l as Ge,q as kt,e as $t,f as Lt,g as Mt,h as Pt,i as Ft,j as Bt,s as It}from"./d3-CO-FEQw9.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var be={exports:{}},se={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $e;function Dt(){if($e)return se;$e=1;var s=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function t(n,i,a){var l=null;if(a!==void 0&&(l=""+a),i.key!==void 0&&(l=""+i.key),"key"in i){a={};for(var o in i)o!=="key"&&(a[o]=i[o])}else a=i;return i=a.ref,{$$typeof:s,type:n,key:l,ref:i!==void 0?i:null,props:a}}return se.Fragment=r,se.jsx=t,se.jsxs=t,se}var Le;function Ot(){return Le||(Le=1,be.exports=Dt()),be.exports}var e=Ot();Array.prototype.sortKey||(Array.prototype.sortKey=function(s){return this.sort((r,t)=>{const n=s(r),i=s(t);if(Array.isArray(n)&&Array.isArray(i)){for(let a=0;a<Math.min(n.length,i.length);a++){if(n[a]<i[a])return-1;if(n[a]>i[a])return 1}return 0}return n<i?-1:n>i?1:0})});var Vt=dt();const Ut=Ve(Vt);function zt(){const s=ht(),r=s.pathname==="/"||s.pathname.startsWith("/tests/"),[t,n]=f.useState(!1),i=f.useRef(null);return f.useEffect(()=>{function a(l){var o;t&&((o=i.current)==null?void 0:o.contains(l.target))===!1&&n(!1)}return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[t]),f.useEffect(()=>{n(!1)},[s]),e.jsxs("div",{className:"layout",children:[!t&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>n(!0),children:e.jsx(T,{icon:bt,size:"lg"})}),t&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:i,className:`sidebar ${t?"sidebar--open":""}`,children:[e.jsx(X,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(X,{to:"/",className:`sidebar__link ${r?"sidebar__link--active":""}`,children:"Tests"}),e.jsx(X,{to:"/patches",className:`sidebar__link ${s.pathname==="/patches"?"sidebar__link--active":""}`,children:"Patches"}),e.jsx(X,{to:"/collected",className:`sidebar__link ${s.pathname==="/collected"?"sidebar__link--active":""}`,children:"Collection"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/preview-138/example-dashboard".replace(/\/$/,"")}/docs/`,className:"sidebar__link",children:"Docs"})]})]}),e.jsx("div",{className:"content",children:e.jsx(pt,{})})]})}function Ce(){const[s,r]=f.useState(!1);return f.useEffect(()=>{function t(){r(window.matchMedia("(max-width: 768px)").matches)}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),s}function he({value:s,onChange:r,options:t}){const n=Ce();return e.jsx("div",{className:"scale-toggle",children:t.map(i=>e.jsx("button",{className:`scale-toggle__button${s===i.value?" scale-toggle__button--active":""}`,onClick:()=>{if(t.length==2&&s===i.value){const a=t.find(l=>l.value!==i.value).value;r(a)}else r(i.value)},children:n?i.mobileContent??i.content:i.content},String(i.value)))})}const Je=f.createContext(null);function Kt({state:s}){return s.visible?mt.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${s.x+10}px`,top:`${s.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:s.content}}),document.body):null}function Wt({children:s}){const[r,t]=f.useState({visible:!1,content:"",x:0,y:0}),l={showTooltip:(o,c,d)=>{t({visible:!0,content:o,x:c,y:d})},hideTooltip:()=>{t(o=>({...o,visible:!1}))},moveTooltip:(o,c)=>{r.visible&&t(d=>({...d,x:o,y:c}))},visible:r.visible};return e.jsxs(Je.Provider,{value:l,children:[s,e.jsx(Kt,{state:r})]})}function qe(){const s=f.useContext(Je);if(!s)throw new Error("useTooltip must be used within a TooltipProvider");return s}function Qe(s,r=0){return Array.from(s).reduce((t,n)=>t+n,r)}function Se(s,r){let t=null;for(let n=0;n<s.length;n++){const i=s[n],a=r?r(i):i;a!=null&&(t===null||a>t)&&(t=a)}return t}function ye(s,r,t){let n=0,i=s.length;for(;n<i;){const a=n+i>>>1;(t?t(s[a])<=r:s[a]<=r)?n=a+1:i=a}return n}let ne=null;function Ht(){return ne||(ne=document.createElement("div"),ne.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(ne)),ne}function je(s,r=""){const t=Ht();t.className=r,t.textContent=s;const n=t.getBoundingClientRect();return{width:n.width,height:n.height}}class Ze{constructor(r,t,n,i){w(this,"createdAt");this.name=r,this.predicate=t,this.component=n,this.extraData=i,this.createdAt=Date.now()}}const et=f.createContext(void 0);function Xt({children:s}){const[r,t]=f.useState(new Map([["covering",new Map],["rolling",new Map]])),[n,i]=f.useState("covering"),a=r.get(n)||new Map,l=d=>{t(p=>{const g=new Map(p);return g.set(n,d),g})},c={filters:a,setFilters:l,removeFilter:(d,p)=>{const g=new Map(a),u=(g.get(d)||[]).filter(x=>x.name!==p);u.length===0?g.delete(d):g.set(d,u),l(g)},observationCategory:n,setObservationCategory:i};return e.jsx(et.Provider,{value:c,children:s})}function _e(){const s=f.useContext(et);if(s===void 0)throw new Error("useFilters must be used within a FilterProvider");return s}const W={select:We,scaleLinear:Ge,scaleOrdinal:Ye,scaleBand:Tt,axisBottom:Xe,axisLeft:He},Me=5,K=2.5;function Yt({feature:s,observations:r}){const t=f.useRef(null),n=f.useRef(null),{filters:i,setFilters:a}=_e(),{showTooltip:l,hideTooltip:o,moveTooltip:c}=qe(),d=i.get(s)||[],p=f.useMemo(()=>{if(d.length===0)return O();console.assert(d.length===1);const _=d[0];return O(_.extraData.selectedValues)},[d]);r={raw:r.raw.filter(_=>_.status!=="gave_up"),filtered:r.filtered.filter(_=>_.status!=="gave_up")};const g=_=>{let u=O();p.equals(O([_]))?u=O():u=O([_]);let x;u.size===1?x=u.first():x=u.map(h=>`${h}`).join(" or ");const S=[];u.size>0&&S.push(new Ze(x,h=>u.some(C=>h.features.get(s)===C),s,{selectedValues:u}));const y=new Map(i);y.set(s,S),a(y)};return f.useEffect(()=>{const _=O(r.raw.map(v=>v.features.get(s)));let u=new Map;for(const v of r.filtered){const E=v.features.get(s);u.set(E,(u.get(E)||0)+1)}const x=Qe(Array.from(u.values()));u=new Map([...u.entries()].sortKey(([v,E])=>v===pe?0:v===me?1:v)),W.select(n.current).selectAll("*").remove();const S=t.current.clientWidth,y=_.size<Me?85:170,h=W.select(n.current).attr("width",S).attr("height",y).append("g"),C=function(v,E){const[k,$]=E;l(`${s}<br>${k}: ${$}`,v.clientX,v.clientY)};if(_.size<Me){const v={top:0,right:15,bottom:20,left:15},E=S-v.left-v.right,k=y-v.top-v.bottom,$=W.scaleLinear().domain([0,1]).range([0,E]);let F;u.has(pe)||u.has(me)?F=P=>P===pe?D.SUCCESS:P===me?D.ERROR:D.PRIMARY:F=W.scaleOrdinal().domain(Array.from(u.keys())).range([D.PRIMARY,D.ACCENT,D.ACCENT2,D.ACCENT3,D.ACCENT4]);const I=h.append("g").attr("transform",`translate(${v.left},${v.top})`);let A=0;const R=k-v.bottom;u.forEach((P,H)=>{const m=P/x*E,b=p.has(H);I.append("rect").attr("x",A).attr("y",0).attr("width",m).attr("height",R).attr("fill",F(H)).style("cursor","pointer").on("click",()=>g(H)).on("mouseover",N=>{C(N,[H,P])}).on("mousemove",N=>c(N.clientX,N.clientY)).on("mouseleave",o),b&&I.append("rect").attr("x",A+K).attr("y",K).attr("width",m-2*K).attr("height",R-2*K).attr("fill",F(H)).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),I.append("text").attr("x",A+m/2).attr("y",R/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(H).style("font-size","12px"),A+=m}),I.append("g").attr("transform",`translate(0,${R})`).call(W.axisBottom($).tickFormat(P=>`${Math.round(Number(P)*100)}%`)),I.append("text").attr("x",E/2).attr("y",R+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const v={top:5,right:5,bottom:30,left:30},E=S-v.left-v.right,k=y-v.top-v.bottom,$=W.scaleBand().domain(Array.from(u.keys())).range([0,E]).padding(.2),F=W.scaleLinear().domain([0,Se(Array.from(u.values()))||0]).range([k,0]),I=h.append("g").attr("transform",`translate(${v.left},${v.top})`);I.selectAll(".bar").data(Array.from(u.entries())).enter().append("rect").attr("class","bar").attr("x",([A,R])=>$(A)||0).attr("y",([A,R])=>F(R)).attr("width",$.bandwidth()).attr("height",([A,R])=>k-F(R)).attr("fill",D.PRIMARY).style("cursor","pointer").on("click",function(A,[R,P]){g(R)}).on("mouseover",function(A,R){C(A,R)}).on("mousemove",A=>c(A.clientX,A.clientY)).on("mouseleave",o),I.selectAll(".inner-bar").data(Array.from(u.entries()).filter(([A,R])=>p.has(A))).enter().append("rect").attr("class","inner-bar").attr("x",([A,R])=>($(A)||0)+K).attr("y",([A,R])=>F(R)+K).attr("width",$.bandwidth()-2*K).attr("height",([A,R])=>k-F(R)-2*K).attr("fill",D.PRIMARY).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),I.append("g").attr("transform",`translate(0,${k})`).call(W.axisBottom($)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),I.append("g").call(W.axisLeft(F).ticks(7).tickFormat(A=>Math.round(Number(A)).toString())),I.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-k/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}return()=>{o()}},[r,p,s,g]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:s}),e.jsx("div",{ref:t,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:n,style:{width:"100%"}})})]})}function Gt({title:s,children:r,defaultState:t="open",onStateChange:n,headerClass:i="",contentClass:a=""}){const[l,o]=f.useState(t),c=()=>{const d=l==="open"?"closed":"open";o(d),n==null||n(d)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:c,children:[e.jsx("span",{className:"collapsible__toggle",children:l==="open"?e.jsx(T,{icon:yt}):e.jsx(T,{icon:jt})}),s]}),l==="open"&&e.jsx("div",{className:`${a}`,children:r})]})}function Te({title:s,children:r,defaultState:t="open",onStateChange:n}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Gt,{title:s,defaultState:t,onStateChange:n,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:r})})}function Jt({observations:s}){const r=new Set;return s.raw.forEach(t=>{for(const n of t.features.keys())n.startsWith("Retried draw from")||r.add(n)}),r.size===0?null:e.jsx(Te,{title:"Features",children:Array.from(r).sort().map(t=>e.jsx(Yt,{feature:t,observations:s}))})}function qt(){const{filters:s,removeFilter:r}=_e(),t=Array.from(s.values()).flat().sortKey(n=>n.createdAt);return t.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),t.map(n=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>r(n.component,n.name),children:e.jsx(T,{icon:Ue})}),n.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:n.name})]},`${n.component}-${n.name}`))]})}var Qt=wt();const ue=Ve(Qt);function tt(s){const r=s.regex,t=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),n=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],o={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:n,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},c={className:"meta",begin:/^(>>>|\.\.\.) /},d={className:"subst",begin:/\{/,end:/\}/,keywords:o,illegal:/#/},p={begin:/\{\{/,relevance:0},g={className:"string",contains:[s.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[s.BACKSLASH_ESCAPE,c],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[s.BACKSLASH_ESCAPE,c],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[s.BACKSLASH_ESCAPE,c,p,d]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[s.BACKSLASH_ESCAPE,c,p,d]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[s.BACKSLASH_ESCAPE,p,d]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[s.BACKSLASH_ESCAPE,p,d]},s.APOS_STRING_MODE,s.QUOTE_STRING_MODE]},_="[0-9](_?[0-9])*",u=`(\\b(${_}))?\\.(${_})|\\b(${_})\\.`,x=`\\b|${n.join("|")}`,S={className:"number",relevance:0,variants:[{begin:`(\\b(${_})|(${u}))[eE][+-]?(${_})[jJ]?(?=${x})`},{begin:`(${u})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${x})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${x})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${x})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${x})`},{begin:`\\b(${_})[jJ](?=${x})`}]},y={className:"comment",begin:r.lookahead(/# type:/),end:/$/,keywords:o,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},h={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:o,contains:["self",c,S,g,s.HASH_COMMENT_MODE]}]};return d.contains=[g,S,c],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:o,illegal:/(<\/|\?)|=>/,contains:[c,S,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},g,y,s.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,t],scope:{1:"keyword",3:"title.function"},contains:[h]},{variants:[{match:[/\bclass/,/\s+/,t,/\s*/,/\(\s*/,t,/\s*\)/]},{match:[/\bclass/,/\s+/,t]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[S,h,g]}]}}function Pe({currentPage:s,pageCount:r,onPageChange:t}){console.assert(r>1);function n(){return r<=7?Array.from({length:r},(c,d)=>d):s<=3?[0,1,2,3,4,"ellipsis",r-1]:s>=r-4?[0,"ellipsis",r-5,r-4,r-3,r-2,r-1]:[0,"ellipsis",s-1,s,s+1,"ellipsis",r-1]}const i=n();function a(c){typeof c=="number"&&s!==c&&t(c)}function l(){s>0&&t(s-1)}function o(){s<r-1&&t(s+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${s===0?"pagination__nav--disabled":""}`,onClick:l,children:e.jsx(T,{icon:Nt})}),i.map((c,d)=>{if(c==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${d}`);const p=c===s;return e.jsx("div",{className:`pagination__number ${p?"pagination__number--current":""}`,onClick:()=>a(c),children:c+1},c)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${s===r-1?"pagination__nav--disabled":""}`,onClick:o,children:e.jsx(T,{icon:St})})]})}ue.registerLanguage("python",tt);const we=30;function Zt({observations:s,observationCategory:r}){const t=f.useRef(null),[n,i]=f.useState(0);f.useEffect(()=>{i(0)},[r]);function a(){t.current&&t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(d=>{ue.highlightElement(d)})}f.useEffect(()=>{a()},[s,n]);const l=new Map;s.filtered.forEach(d=>{const p=d.representation;l.set(p,(l.get(p)||0)+1)});const o=Math.ceil(l.size/we),c=Array.from(l.entries()).sortKey(([d,p])=>-p).slice(n*we,(n+1)*we);return e.jsx(Te,{title:"Textual representation",defaultState:"closed",onStateChange:d=>{d==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:t,children:[o>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(Pe,{currentPage:n,pageCount:o,onPageChange:i})}),c.map(([d,p])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:d})}),p>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",p]})]},d)),o>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(Pe,{currentPage:n,pageCount:o,onPageChange:i})})]})})}const Fe=640;function es({name:s,observations:r,verticalAxis:t,horizontalAxis:n,cssStyle:i=(a,l)=>({})}){const{filters:a,setFilters:l}=_e(),{showTooltip:o,hideTooltip:c,moveTooltip:d}=qe(),p=a.get(s)||[],g=f.useMemo(()=>{if(p.length===0)return O();console.assert(p.length===1);const m=p[0];return O(m.extraData.selectedCells)},[p]),_=[],u=Array(t.length).fill(0),x=Array(n.length).fill(0);let S=0;for(let m=0;m<t.length;m++){_[m]=[];for(let b=0;b<n.length;b++)_[m][b]={count:0,widthPercent:0}}r.filtered.forEach(m=>{for(let b=0;b<t.length;b++){const[,N]=t[b];if(N(m)){for(let L=0;L<n.length;L++){const[,U]=n[L];if(U(m)){_[b][L].count++,u[b]++,x[L]++,S++;break}}break}}});const y=u.map((m,b)=>m>0?b:null).filter(m=>m!==null),h=x.map((m,b)=>m>0?b:null).filter(m=>m!==null),C=(m,b)=>{let N=O();if(m!==null&&b!==null){const j=Q([m,b]);g.equals(O([j]))?N=O():N=O([j])}else m!==null?(console.assert(b===null),h.forEach(j=>{_[m][j].count>0&&(N=N.add(Q([m,j])))})):b!==null&&(console.assert(m===null),y.forEach(j=>{_[j][b].count>0&&(N=N.add(Q([j,b])))}));function L(){if(N.size===0)return"";let j=N;const z=[],de=[...y.map(B=>({name:t[B][0],cells:h.filter(V=>_[B][V].count>0).map(V=>Q([B,V]))})),...h.map(B=>({name:n[B][0],cells:y.filter(V=>_[V][B].count>0).map(V=>Q([V,B]))}))];for(const B of de)B.cells.length>0&&B.cells.every(V=>j.has(V))&&(z.push(B.name),j=j.subtract(O(B.cells)));for(;j.size>0;){const B=j.first(),[V,ve]=B.toArray();z.push(`${t[V][0]}+${n[ve][0]}`),j=j.delete(B)}return console.assert(j.size==0),z.join(" or ")}const U=[];N.size>0&&U.push(new Ze(L(),j=>N.some(z=>{const[de,B]=z.toArray(),V=t[de][1],ve=n[B][1];return V(j)&&ve(j)}),s,{selectedCells:N}));const Y=new Map(a);Y.set(s,U),l(Y)};if(y.length===0||h.length===0)return e.jsx("div",{children:"No observations"});const v=30,E=30,k=45*y.length;for(let m=0;m<t.length;m++)for(let b=0;b<n.length;b++)_[m][b].widthPercent=u[m]>0?_[m][b].count/u[m]*100:0;const F=y.map(m=>u[m]/S*k).map(m=>Math.max(m,E)),I=h.map((m,b)=>b===0?0:b===h.length-1?100:b/(h.length-1)*100),{rowHeaderWidth:A,columnHeaderHeight:R,rowTotalWidth:P}=f.useMemo(()=>({rowHeaderWidth:Math.max(...y.map(m=>je(t[m][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(...h.map(m=>je(n[m][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...y.map(m=>je(u[m].toString(),"tyche__mosaic__row-total").width))}),[y,h,t,n,u]),H=Fe-A-P;return y.forEach(m=>{const b=h.map(L=>_[m][L]);if(b.reduce((L,U)=>L+U.widthPercent,0)>0){const U=b.map(j=>j.widthPercent/100*H).map((j,z)=>b[z].count>0&&j>0&&j<v?v:j),Y=U.reduce((j,z)=>j+z,0);h.forEach((j,z)=>{_[m][j].widthPercent=Y>0?U[z]/Y*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${Fe}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${A}px`,marginRight:`${P}px`,height:`${R}px`},children:h.map((m,b)=>{const N=b===0,L=b===h.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${I[b]}%`,transform:N?"translateX(0%)":L?"translateX(-100%)":"translateX(-50%)",textAlign:N?"left":L?"right":"center"},onClick:()=>C(null,m),children:n[m][0]},`header-${m}`)})}),y.map((m,b)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${F[b]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${A}px`,cursor:"pointer"},onClick:()=>C(m,null),children:t[m][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:h.map(N=>{const L=_[m][N];if(L.count===0)return null;const U=g.has(Q([m,N])),Y=`${t[m][0]} and ${n[N][0]}<br>Count: ${L.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${U?" tyche__mosaic__cell--selected":""}`,style:{width:`${L.widthPercent}%`,minWidth:`${v}px`,minHeight:`${E}px`,...i(t[m][0],n[N][0])},onClick:()=>C(m,N),onMouseEnter:j=>o(Y,j.clientX,j.clientY),onMouseMove:j=>d(j.clientX,j.clientY),onMouseLeave:c,children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:L.count})},`cell-${m}-${N}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${P}px`},children:u[m]})]},`row-${m}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${R}px`},children:[e.jsx("div",{style:{width:`${A}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${P}px`},children:h.map((m,b)=>{const N=b===0,L=b===h.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${I[b]}%`,transform:N?"translateX(0%)":L?"translateX(-100%)":"translateX(-50%)",textAlign:N?"left":L?"right":"center"},children:x[m]},`total-${m}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${P}px`},children:S})]})]})}function ts({observations:s}){function r(t,n){const i={};return t==="Passed"?i.backgroundColor=D.SUCCESS:t==="Invalid"?i.backgroundColor=D.WARNING:t==="Failed"&&(i.backgroundColor=D.ERROR),n==="Duplicate"&&(i.opacity=.7),i}return e.jsx(Te,{title:"Sample breakdown",children:e.jsx(es,{name:"samples",observations:s,verticalAxis:[["Passed",t=>t.status==="passed"],["Invalid",t=>t.status==="gave_up"]],horizontalAxis:[["Unique",t=>t.isUnique??!1],["Duplicate",t=>t.isDuplicate??!1]],cssStyle:r})})}const pe="Present",me="Not present";var D=(s=>(s.PRIMARY="#6b8ab5",s.SUCCESS="#8ba86b",s.WARNING="#d59a7e",s.ERROR="#c77a7e",s.ACCENT="#c1a2bb",s.ACCENT2="#9fc7c6",s.ACCENT3="#edd39a",s.ACCENT4="#99c7d6",s.ACCENT5="#8faac6",s))(D||{});function ss({test:s}){const{filters:r,observationCategory:t,setObservationCategory:n}=_e(),i=t==="rolling"?s.rolling_observations.sortKey(o=>-o.run_start):s.corpus_observations,a=f.useMemo(()=>{const o=Array.from(r.values()).flat();return o.length===0?i:i.filter(c=>o.every(d=>d.predicate(c)))},[i,r]),l={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(he,{value:t,onChange:n,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx(qt,{}),l.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ts,{observations:l}),e.jsx(Jt,{observations:l}),e.jsx(Zt,{observations:l,observationCategory:t})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function ns({test:s}){return e.jsx(Xt,{children:e.jsx(ss,{test:s})})}class ge{withProperties(r){return Object.assign(Object.create(this.constructor.prototype),this,r)}}class J extends ge{constructor(r=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=r}static fromJson(r){const t=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[n,i]of Object.entries(r))console.assert(typeof i=="number"),t.set(Number(n),i);return new J(t)}add(r){const t=new Map(this.counts);for(const[n,i]of r.counts.entries())t.set(n,t.get(n)+i);return new J(t)}subtract(r){const t=new Map(this.counts);for(const[n,i]of r.counts.entries())t.set(n,t.get(n)-i);return new J(t)}sum(){return Qe(this.counts.values())}}var st=(s=>(s[s.OVERRUN=0]="OVERRUN",s[s.INVALID=1]="INVALID",s[s.VALID=2]="VALID",s[s.INTERESTING=3]="INTERESTING",s))(st||{});class xe extends ge{constructor(t,n,i,a,l,o,c,d){super();w(this,"status_counts_diff");w(this,"elapsed_time_diff");w(this,"timestamp_monotonic");this.elapsed_time=t,this.timestamp=n,this.status_counts=i,this.behaviors=a,this.fingerprints=l,this.since_new_branch=o,this.phase=c,this.worker_uuid=d,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(t,n){return new xe(n.elapsed_time,n.timestamp,J.fromJson(n.status_counts),n.behaviors,n.fingerprints,n.since_new_branch,n.phase,t)}}function Be(s,r){const t=r?r.status_counts:new J,n=r?r.elapsed_time:0,i=s.status_counts.subtract(t),a=s.elapsed_time-n,l=r?Math.max(s.timestamp,r.timestamp_monotonic+a):s.timestamp;return console.assert(Array.from(i.counts.values()).every(o=>o>=0)),console.assert(a>=0),s.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:l})}class te extends ge{constructor(t,n,i,a,l,o,c,d,p,g,_){super();w(this,"isDuplicate",null);w(this,"isUnique",null);this.type=t,this.status=n,this.status_reason=i,this.representation=a,this.arguments_=l,this.how_generated=o,this.features=c,this.timing=d,this.metadata=p,this.property=g,this.run_start=_}static fromJson(t){return new te(t.type,t.status,t.status_reason,t.representation,new Map(Object.entries(t.arguments)),t.how_generated,new Map(Object.entries(t.features)),new Map(Object.entries(t.timing)),new Map(Object.entries(t.metadata)),t.property,Number(t.run_start))}}var fe=(s=>(s[s.FAILED=0]="FAILED",s[s.SHRINKING=1]="SHRINKING",s[s.RUNNING=2]="RUNNING",s[s.WAITING=3]="WAITING",s))(fe||{});const ie=class ie extends ge{constructor(t,n,i,a,l,o){super();w(this,"linear_reports");w(this,"_status_counts_cumsum");w(this,"_elapsed_time_cumsum");this.database_key=t,this.nodeid=n,this.rolling_observations=i,this.corpus_observations=a,this.failure=l,this.reports_by_worker=o,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map;const c=this.reports_by_worker;this.reports_by_worker=new Map;const d=Array.from(c.entries()).flatMap(([p,g])=>g.map(_=>[p,_])).sortKey(([p,g])=>g.timestamp);for(const[p,g]of d)this.add_report(p,g);this._check_invariants()}static fromJson(t){return new ie(t.database_key,t.nodeid,[],[],t.failure?te.fromJson(t.failure):null,new Map(Object.entries(t.reports_by_worker).map(([n,i])=>[n,i.map(xe.fromJson)])))}_assert_reports_ordered(t){for(let n=0;n<t.length-1;n++)console.assert(t[n].timestamp_monotonic<=t[n+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const t=this.linear_status_counts(null);for(let i=0;i<t.length-1;i++)console.assert(t[i].sum()<=t[i+1].sum());const n=this.linear_elapsed_time(null);for(let i=0;i<n.length-1;i++)console.assert(n[i]<=n[i+1]);console.assert(n.length===t.length&&t.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(t,n){let i=null,a=0;if(this.reports_by_worker.has(t)){const o=this.reports_by_worker.get(t);a=ye(o,n.elapsed_time,c=>c.elapsed_time),i=a!=0?o[a-1]:null}const l=Be(n,i);if(t in this.reports_by_worker||this.reports_by_worker.set(t,[]),this.reports_by_worker.get(t).splice(a,0,l),l.phase!=="replay"){const o=ye(this.linear_reports,l.timestamp_monotonic,c=>c.timestamp_monotonic);if(this.linear_reports.splice(o,0,l),o!=this.linear_reports.length-1){let c=null,d;for(d=0;d<this.linear_reports.length-(o+1);d++){const p=this.linear_reports[o+1+d];if(l.worker_uuid===p.worker_uuid){c=p;break}}c&&(console.assert(this.linear_reports[o+1+d]===c),this.linear_reports[o+1+d]=Be(c,l));for(const p of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[g,[_,u]]of p.entries())o>=_&&p.set(g,[_,u.slice(0,o-_)])}}}get status(){if(this.failure)return 0;if(this.linear_reports.length===0)return 3;const t=this.linear_reports[this.linear_reports.length-1],n=new Date().getTime()/1e3;return t.phase=="shrink"?1:t.ninputs===0||t.timestamp<n-ie.WAITING_STATUS_DURATION?3:2}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_branch(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_branch}elapsed_time(t){const n=this.linear_elapsed_time(t);return n.length===0?0:n[n.length-1]}ninputs(t){const n=this.linear_status_counts(t);return n.length===0?0:n[n.length-1].sum()}_cumsum(t,n,i,a,l){if(a===null&&(a=-1/0),t.has(a)){const[p,g]=t.get(a);if(g.length<this.linear_reports.slice(p).length){let _=g.length>0?g[g.length-1]:l;for(const u of this.linear_reports.slice(p+g.length))_=i(_,u[n]),g.push(_);t.set(a,[p,g])}return g}const o=[],c=ye(this.linear_reports,a,p=>p.timestamp_monotonic);let d=l;for(const p of this.linear_reports.slice(c))d=i(d,p[n]),o.push(d);return t.set(a,[c,o]),o}linear_status_counts(t){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(n,i)=>n.add(i),t,new J)}linear_elapsed_time(t){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(n,i)=>n+i,t,0)}};w(ie,"WAITING_STATUS_DURATION",120);let Ae=ie;function rs({message:s,onDismiss:r,isVisible:t}){const[n,i]=f.useState(t);return f.useEffect(()=>{if(t){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[t]),n?e.jsxs("div",{className:`notification ${t?"notification--visible":"notification--hidden"}`,onClick:r,children:[e.jsx("div",{className:"notification__content",children:s}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),r()},"aria-label":"Close notification",children:e.jsx(T,{icon:Ue})})]}):null}const nt=f.createContext(null);function is({children:s}){const[r,t]=f.useState([]),n=f.useRef(new Map),i=f.useRef(0),a=f.useCallback(c=>{clearTimeout(n.current.get(c)),n.current.delete(c),t(d=>d.filter(p=>p.id!==c))},[]),l=f.useCallback((c,d)=>{const p=++i.current,g={id:p,message:c,duration:d};if(t(_=>[..._,g]),d!==null){const _=setTimeout(()=>{a(p)},d);n.current.set(p,_)}return p},[a]),o=f.useCallback((c,d,p)=>{if(t(g=>g.map(_=>_.id===c?{..._,message:d,duration:p}:_)),p!==null){clearTimeout(n.current.get(c));const g=setTimeout(()=>{a(c)},p);n.current.set(c,g)}},[a]);return e.jsxs(nt.Provider,{value:{addNotification:l,updateNotification:o,dismissNotification:a},children:[s,e.jsx("div",{className:"notifications",children:r.map((c,d)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+d*80}px`},children:e.jsx(rs,{message:c.message,isVisible:!0,onDismiss:()=>a(c.id)})},c.id))})]})}function as(){const s=f.useContext(nt);if(!s)throw new Error("useNotification must be used within a NotificationProvider");return s}const rt=f.createContext(null);function Ie(s){const r=new Map;s.forEach(n=>{r.set(n.representation,(r.get(n.representation)||0)+1)}),s.forEach(n=>{const i=r.get(n.representation);n.isUnique=i==1,n.isDuplicate=i>1});const t=new Set;s.forEach(n=>{n.features.forEach((i,a)=>{t.add(a)})}),s.forEach(n=>{t.forEach(i=>{n.features.has(i)||n.features.set(i,me)});for(const[i,a]of n.features)a===""&&n.features.set(i,pe)})}function os(s,r){const t=new Map(s);function n(i){if(t.has(i))return t.get(i);{const a=new Ae(null,i,[],[],null,new Map);return t.set(a.nodeid,a),a}}switch(r.type){case 1:return s;case 2:{const{tests:i}=r;for(const{database_key:a,nodeid:l,failure:o}of i){const c=n(l);c.database_key=a,c.failure=o?te.fromJson(o):null}return t}case 3:{const{nodeid:i,worker_uuid:a,reports:l}=r,o=n(i);for(const c of l)o.add_report(a,c);return t}case 5:{const{nodeid:i,failure:a}=r,l=n(i);return l.failure=a,t}case 4:{const{nodeid:i,observation_type:a,observations:l}=r,o=n(i);return a==="rolling"?(o.rolling_observations.push(...l),o.rolling_observations=o.rolling_observations.sortKey(c=>-c.run_start).slice(0,300),Ie(o.rolling_observations)):(console.assert(a==="corpus"),o.corpus_observations.push(...l),Ie(o.corpus_observations)),t}default:throw new Error("non-exhaustive switch in testsReducer")}}function ls({children:s}){const[r,t]=f.useState(null),[n,i]=f.useReducer(os,new Map),[a,l]=f.useState(!1),[o,c]=f.useState(null),{addNotification:d,updateNotification:p,dismissNotification:g}=as();f.useRef(null);const _=f.useCallback(u=>{l(!0),c(u)},[]);return f.useEffect(()=>{if(a){n.clear();{fetch(new URL("dashboard_state/tests.json",import.meta.url)).then(x=>x.text()).then(x=>JSON.parse(x)).then(x=>{Object.entries(x).forEach(([S,y])=>{i({type:2,tests:[{database_key:y.database_key,nodeid:S,failure:y.failure}]});for(const[h,C]of Object.entries(y.reports_by_worker))i({type:3,nodeid:S,worker_uuid:h,reports:C.map(v=>xe.fromJson(h,v))})})});const u=new Worker(new URL("/preview-138/example-dashboard/assets/jsonWorker-KJVNTzbb.js",import.meta.url));return fetch(new URL("dashboard_state/observations.json",import.meta.url)).then(x=>x.text()).then(x=>new Promise(S=>{u.onmessage=y=>S(y.data),u.postMessage(x)})).then(x=>{for(const[S,y]of Object.entries(x))i({type:4,nodeid:S,observation_type:"rolling",observations:y.rolling.map(te.fromJson)}),i({type:4,nodeid:S,observation_type:"corpus",observations:y.corpus.map(te.fromJson)})}),()=>u.terminate()}}},[o,a]),e.jsx(rt.Provider,{value:{tests:n,socket:r,doLoadData:_},children:s})}function it(s=null){const r=f.useContext(rt);if(!r)throw new Error("useData must be used within a DataProvider");return f.useEffect(()=>{r.doLoadData(s)},[s,r.doLoadData]),r}function ke({headers:s,data:r,row:t,mobileRow:n,getKey:i,onFilterChange:a,filterStrings:l}){const[o,c]=f.useState(null),[d,p]=f.useState(0),[g,_]=f.useState(""),u=Ce(),x=f.useMemo(()=>{let h=r;if(g&&(h=r.filter(v=>l?l(v).some(E=>E.toLowerCase().includes(g.toLowerCase())):!0)),o===null)return h;const C=[...h].sortKey(v=>s[o].sortKey(v));return d===0?C:C.reverse()},[r,o,d,s,g,t,l,n,u]),S=h=>{s[h].sortKey&&(o===h?p(C=>C===0?1:0):(c(h),p(0)))};function y(h){_(h),a==null||a(h)}return e.jsxs("div",{className:"table",children:[l!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:g,onChange:h=>y(h.target.value),className:"table__filter__input"}),g&&e.jsx("span",{className:"table__filter__clear",onClick:()=>y(""),children:e.jsx(T,{icon:At})})]}),n!==void 0&&u?x.map(h=>e.jsx("div",{children:n(h)},i?i(h):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:s.map((h,C)=>e.jsx("th",{onClick:()=>S(C),className:h.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${h.align??"left"}`,children:[h.content,h.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(v=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${v===0?"asc":"desc"} ${o===C&&d===v?"table__sort__arrow--active":""}`,children:v===0?e.jsx(T,{icon:Rt}):e.jsx(T,{icon:Et})}))})]})},C))})}),e.jsx("tbody",{children:x.map(h=>{const C=t(h);return console.assert(C.length===s.length),e.jsx("tr",{children:C.map((v,E)=>e.jsx("td",{children:v},E))},i?i(h):void 0)})})]}),g&&x.length<r.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",x.length," of ",r.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{_(""),a==null||a("")},children:"[clear]"})]})]})}async function at(s){return(await(await fetch(new URL("dashboard_state/api.json",import.meta.url))).json())[s.replace(/\/$/,"")]}const De={not_collected:0,collected:1};function cs(){const[s,r]=f.useState(null);if(f.useEffect(()=>{at("collected_tests/").then(a=>{r(a)})},[]),s===null)return null;if(!s.collection_status.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const t=[...s.collection_status].sortKey(a=>[De[a.status],a.status_reason,a.nodeid]),n=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[De[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(X,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(ke,{headers:n,data:t,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function us(){return e.jsx("h1",{children:"Page not found!"})}function ds(s){const r=s.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:r.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:r.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}ue.registerLanguage("diff",ds);function hs(){const[s,r]=f.useState({}),[t,n]=f.useState(!0);return f.useEffect(()=>{at("patches").then(i=>{i&&r(i),n(!1)})},[]),f.useEffect(()=>{ue.highlightAll()},[s]),t?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"Loading patches..."})]}):Object.values(s).length==0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No patches yet"})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("div",{className:"patches-list",children:Object.entries(s).map(([i,a])=>e.jsxs("div",{className:"patch",children:[e.jsx("h3",{children:i}),e.jsx("pre",{children:e.jsx("code",{className:"language-diff",children:a})})]},i))})]})}function Ne(s,r){const[t,n]=f.useState(()=>{const i=sessionStorage.getItem(s);return i===null?r:JSON.parse(i)});return f.useEffect(()=>{sessionStorage.setItem(s,JSON.stringify(t))},[t,s]),[t,n]}const M={scaleSymlog:It,scaleLinear:Ge,select:We,zoom:Bt,zoomIdentity:Ft,pointer:Pt,line:Mt,axisBottom:Xe,axisLeft:He,brush:Lt,scaleOrdinal:Ye,schemeCategory10:$t,quadtree:kt},ee={x:0,y:0};typeof window<"u"&&window.addEventListener("mousemove",s=>{ee.x=s.clientX,ee.y=s.clientY});const ps=10;function Oe(s,r,t="horizontal",n=12,i=6){const a=s.node().getBBox(),l=M.select(s.node().parentNode);let o,c;o=a.x-n-i,c=a.y+(a.height-n)/2,l.append("svg").attr("x",o).attr("y",c).attr("width",n).attr("height",n).attr("viewBox",`0 0 ${r.icon[0]} ${r.icon[1]}`).append("path").attr("d",r.icon[4])}class ms{constructor(r,t,n,i,a,l,o,c){w(this,"reports");w(this,"scaleSetting");w(this,"axisSettingX");w(this,"axisSettingY");w(this,"xValue");w(this,"yValue");w(this,"width");w(this,"height");w(this,"margin");w(this,"x");w(this,"y");w(this,"g");w(this,"zoom");w(this,"chartArea");w(this,"navigate");w(this,"tooltip");w(this,"brush",null);w(this,"eventListeners",new Map);w(this,"xAxis");w(this,"yAxis");w(this,"reportsColor");w(this,"viewportX");w(this,"viewportY");w(this,"quadtree");this.reports=t,this.scaleSetting=i,this.axisSettingX=a,this.axisSettingY=l,this.navigate=o,this.xValue=h=>a=="time"?h.linear_elapsed_time:h.linear_status_counts.sum(),this.yValue=h=>l=="behaviors"?h.behaviors:h.fingerprints,this.margin={top:20,right:20,bottom:c?40:45,left:c?50:60},this.width=r.clientWidth-this.margin.left-this.margin.right,this.height=300-this.margin.top-this.margin.bottom,this.reportsColor=n;const d=Array.from(t.values()).flat();this.x=(i==="log"?M.scaleSymlog():M.scaleLinear()).domain([0,Se(d,h=>this.xValue(h))||1]).range([0,this.width]),this.y=M.scaleLinear().domain([0,Se(d,h=>this.yValue(h))||0]).range([this.height,0]),this.viewportX=this.x,this.viewportY=this.y,this.g=M.select(r).append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`),this.g.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.width).attr("height",this.height+5).attr("x",0).attr("y",-5),this.chartArea=this.g.append("g").attr("class","chart-area").attr("clip-path","url(#clip)"),this.chartArea.append("rect").attr("width",this.width).attr("height",this.height).attr("fill","none").attr("pointer-events","all"),this.zoom=M.zoom().scaleExtent([1,1/0]).on("zoom",h=>this.zoomTo(h.transform,!1)),this.chartArea.call(this.zoom),this.chartArea.on("dblclick.zoom",()=>{this.chartArea.transition().duration(500).call(this.zoom.transform,M.zoomIdentity)}),this.tooltip=M.select(".coverage-graph__tooltip"),this.xAxis=this.g.append("g").attr("transform",`translate(0,${this.height})`).call(this.createXAxis(this.x)),this.yAxis=this.g.append("g").call(this.createYAxis(this.y));const p=this.g.append("g").attr("transform",`translate(${-this.margin.left}, ${this.height/2}) rotate(-90)`),g=this.axisSettingY=="behaviors"?ae:oe,_=this.axisSettingY=="behaviors"?"Behaviors":"Fingerprints",u=p.append("text").attr("x",0).attr("y",0).attr("dy","1em").style("text-anchor","middle").text(_);Oe(u,g,"vertical");const x=this.axisSettingX=="time"?ce:le,S=this.axisSettingX=="time"?"Time (s)":"Inputs",y=this.g.append("text").attr("x",this.width/2).attr("y",this.height+this.margin.bottom-5).style("text-anchor","middle").text(S);Oe(y,x,"horizontal"),this.chartArea.on("mousemove",h=>{const[C,v]=M.pointer(h),E=this.quadtree.find(C,v,ps);E?this.tooltip.style("display","block").style("left",`${h.pageX+10}px`).style("top",`${h.pageY-10}px`).html(`
              <strong>${E.nodeid.split("::").pop()||E.nodeid}</strong><br/>
              ${E.behaviors.toLocaleString()} behaviors / ${E.fingerprints.toLocaleString()} fingerprints<br/>
              ${E.ninputs.toLocaleString()} inputs / ${E.elapsed_time.toFixed(1)} seconds
            `):this.tooltip.style("display","none")}).on("mouseout",()=>{this.tooltip.style("display","none")}),this.drawLines(),this.updateQuadtree()}createXAxis(r){if(this.scaleSetting==="log"){const t=r.domain()[1],n=[0];let i=1;for(;i<=t;)n.push(i),i*=10;return M.axisBottom(r).tickValues(n).tickFormat(a=>{const l=a.valueOf();return console.assert(l>=0),l>=1e6?`${Math.floor(l/1e6)}M`:l>=1e3?`${Math.floor(l/1e3)}k`:l>0?l.toLocaleString():"0"})}else return M.axisBottom(r).ticks(5).tickFormat(t=>t.toLocaleString())}createYAxis(r){return M.axisLeft(r).ticks(5)}updateQuadtree(){const r=Array.from(this.reports.values()).flat();this.quadtree=M.quadtree().x(t=>this.viewportX(this.xValue(t))).y(t=>this.viewportY(this.yValue(t))).addAll(r)}zoomTo(r,t){const n=r.rescaleX(this.x),i=t?r.rescaleY(this.y):this.y;this.viewportX=n,this.viewportY=i,this.xAxis.call(this.createXAxis(n)),t&&this.yAxis.call(this.createYAxis(i)),this.g.selectAll(".chart-area path").attr("d",M.line().x(a=>n(this.xValue(a))).y(a=>i(this.yValue(a)))),this.updateQuadtree()}drawLines(){const r=M.line().x(t=>this.x(this.xValue(t))).y(t=>this.y(this.yValue(t)));Array.from(this.reports.entries()).forEach(([t,n])=>{this.chartArea.append("path").datum(n).attr("fill","none").attr("stroke",this.reportsColor(t)).attr("d",r).attr("class","coverage-line").style("cursor","pointer").on("mouseover",function(){M.select(this).classed("coverage-line__selected",!0)}).on("mouseout",function(){M.select(this).classed("coverage-line__selected",!1)}).on("click",i=>{i.metaKey||i.ctrlKey?window.open(`/tests/${encodeURIComponent(t)}`,"_blank"):this.navigate(`/tests/${encodeURIComponent(t)}`)})})}enableBoxBrush(){for(const r of["wheel","mousedown","mousemove","mouseup"])this.chartArea.on(`${r}.zoom`,null);this.brush=M.brush().extent([[0,0],[this.width,this.height]]).on("end",r=>{if(!r.selection)return;const[[t,n],[i,a]]=r.selection;if(this.chartArea.call(this.brush.clear),this.chartArea.call(this.zoom),Math.abs(i-t)<5||Math.abs(a-n)<5){this.emit("boxSelectEnd");return}const l=this.width/(i-t),o=this.height/(a-n),c=Math.max(l,o),d=M.zoomIdentity.translate(this.width/2,this.height/2).scale(c).translate(-(t+i)/2,-(n+a)/2);this.chartArea.transition().duration(250).call(this.zoom.transform,d).on("end",()=>{this.emit("boxSelectEnd")})}),this.chartArea.style("cursor","crosshair").call(this.brush)}cleanup(){this.tooltip.style("display","none"),this.g.selectAll("path").classed("coverage-line__selected",!1)}on(r,t){this.eventListeners.has(r)||this.eventListeners.set(r,[]),this.eventListeners.get(r).push(t)}off(r,t){this.eventListeners.has(r)&&this.eventListeners.set(r,this.eventListeners.get(r).filter(n=>n!==t))}emit(r){this.eventListeners.has(r)&&this.eventListeners.get(r).forEach(t=>t())}}function ot({tests:s,filterString:r=""}){const t=f.useRef(null),[n,i]=Ne("graph_scale","log"),[a,l]=Ne("graph_axis_x","time"),[o,c]=Ne("graph_axis_y","behaviors"),[d,p]=f.useState(!0),[g,_]=f.useState({transform:null,zoomY:!1}),[u,x]=f.useState(!1),S=ft(),y=Ce(),h=f.useMemo(()=>new Map(Array.from(s.entries()).sortKey(([k,$])=>k).map(([k,$])=>{const F=$.linear_status_counts(null),I=$.linear_elapsed_time(null),A=[];for(let R=0;R<F.length;R++){const P=$.linear_reports[R];A.push({nodeid:k,linear_status_counts:F[R],linear_elapsed_time:I[R],behaviors:P.behaviors,fingerprints:P.fingerprints,ninputs:P.ninputs,elapsed_time:P.elapsed_time})}return[k,A]})),[s]),C=f.useMemo(()=>r?new Map(Array.from(h.entries()).filter(([k])=>k.toLowerCase().includes(r.toLowerCase()))):h,[h,r]),v=M.scaleOrdinal(M.schemeCategory10).domain(h.keys());f.useEffect(()=>{if(!t.current)return;const k=t.current.getBoundingClientRect();if(!d&&ee.x>=k.left&&ee.x<=k.right&&ee.y>=k.top&&ee.y<=k.bottom)return;d&&p(!1),M.select(t.current).selectAll("*").remove();const $=new ms(t.current,C,v,n,a,o,S,y);return g.transform&&$.zoom.transform($.chartArea,g.transform),$.zoomTo(g.transform??M.zoomIdentity,g.zoomY),$.zoom.on("zoom.saveTransform",F=>{_({transform:F.transform,zoomY:!1})}),u&&$.enableBoxBrush(),$.on("boxSelectEnd",E),()=>{$.cleanup()}},[C,n,a,o,d,u,S]);const E=()=>{x(!u),p(!0)};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Coverage"}),e.jsxs("div",{className:"coverage-graph__controls",children:[e.jsx(he,{value:o,onChange:c,options:[{value:"behaviors",content:e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:ae})," Behaviors"]}),mobileContent:e.jsx(T,{icon:ae})},{value:"fingerprints",content:e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:oe})," Fingerprints"]}),mobileContent:e.jsx(T,{icon:oe})}]}),e.jsx(he,{value:a,onChange:l,options:[{value:"inputs",content:e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:le})," Inputs"]}),mobileContent:e.jsx(T,{icon:le})},{value:"time",content:e.jsxs(e.Fragment,{children:[e.jsx(T,{icon:ce})," Time"]}),mobileContent:e.jsx(T,{icon:ce})}]}),e.jsx(he,{value:n,onChange:i,options:[{value:"linear",content:"Linear"},{value:"log",content:"Log"}]})]}),e.jsx("div",{className:"coverage-graph__tooltip"}),e.jsx("svg",{className:"coverage-graph__svg",ref:t,style:{width:"100%",height:"300px"}})]})}function Re({status:s}){return e.jsx("span",{style:{textAlign:"center"},children:s===fe.FAILED?e.jsx("span",{className:"pill pill__failure",children:"Failed"}):s===fe.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:"Shrinking"}):s===fe.RUNNING?e.jsx("span",{className:"pill pill__success",children:"Running"}):e.jsx("span",{className:"pill pill__neutral",children:"Waiting"})})}function G({content:s,tooltip:r}){return e.jsxs("div",{className:"tooltip",children:[s,e.jsx("div",{className:"tooltip__text",children:r})]})}function fs(s){const r=Math.floor(s/3600),t=Math.floor(s%3600/60),n=Math.floor(s%60);return`${r>0?`${r}:${t.toString().padStart(2,"0")}`:t}:${n.toString().padStart(2,"0")}`}function lt(s){const r=s.ninputs(null),t=s.elapsed_time(null);return t===0?null:r/t}function Ee(s){var t;if(s.linear_reports.length===0)return{inputs:"—",behaviors:"—",fingerprints:"—",executions:"—",inputsSinceBranch:"—",timeSpent:"—"};const r=lt(s);return{inputs:s.ninputs(null).toLocaleString(),behaviors:s.behaviors.toLocaleString(),fingerprints:s.fingerprints.toLocaleString(),executions:r===null?"—":`${r.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((t=s.since_new_branch)==null?void 0:t.toLocaleString())??"—",timeSpent:fs(s.elapsed_time(null))}}ue.registerLanguage("python",tt);function _s(){const{nodeid:s}=_t(),{tests:r}=it(s);if(!s||!r.has(s))return e.jsx("div",{children:"Test not found"});const t=r.get(s),n=Ee(t),i=[{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:le})}),tooltip:"Number of inputs"})},{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:ae})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:oe})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:ze})}),tooltip:"Inputs per second"})},{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:Ke})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:ce})}),tooltip:"Total time spent running"})}];return e.jsxs(e.Fragment,{children:[e.jsxs(X,{to:"/",className:"back-link",children:[e.jsx(T,{icon:Ct})," Back to all tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:s}),e.jsx(Re,{status:t.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(ke,{headers:i,data:[n],row:a=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:a.timeSpent})]})})]}),e.jsx(ot,{tests:new Map([[s,t]])}),e.jsx(ns,{test:t}),t.failure&&e.jsxs("div",{className:"test-failure",children:[e.jsx("h2",{children:"Failure"}),e.jsxs("div",{className:"test-failure__item",children:[e.jsx("h3",{children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.failure.metadata.get("reproduction_decorator")+`
`+t.failure.representation})}),e.jsx("h3",{children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.failure.metadata.get("traceback")})})]})]})]})}function Z({icon:s,tooltip:r}){return e.jsx(G,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(T,{icon:s})}),tooltip:r})}function re({icon:s,value:r}){return e.jsxs("div",{className:"table__inline-statistic",children:[s,e.jsx("span",{className:"table__inline-statistic__value",children:r})]})}function gs({tests:s,onFilterChange:r}){const t=Array.from(s).sortKey(([u,x])=>[x.status,u]).map(([u,x])=>x),n=e.jsx(Z,{icon:le,tooltip:"Number of inputs"}),i=e.jsx(Z,{icon:ae,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(Z,{icon:oe,tooltip:"Number of fingerprints (sets of behaviors) found"}),l=e.jsx(Z,{icon:ze,tooltip:"Inputs per second"}),o=e.jsx(Z,{icon:Ke,tooltip:"Number of inputs since a new behavior"}),c=e.jsx(Z,{icon:ce,tooltip:"Total time spent running"}),d=[{content:"Test",sortKey:u=>u.nodeid},{content:"Status",sortKey:u=>u.status,align:"center"},{content:n,align:"right",sortKey:u=>u.ninputs(null)},{content:i,align:"right",sortKey:u=>u.behaviors},{content:a,align:"right",sortKey:u=>u.fingerprints},{content:l,align:"right",sortKey:u=>lt(u)??-1},{content:o,align:"right",sortKey:u=>u.since_new_branch??0},{content:c,align:"right",sortKey:u=>u.elapsed_time(null)}],p=u=>{const x=Ee(u);return[e.jsx(X,{to:`/tests/${encodeURIComponent(u.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:u.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Re,{status:u.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:x.timeSpent})]};function g(u){const x=Ee(u);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(X,{to:`/tests/${encodeURIComponent(u.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:u.nodeid}),e.jsx(Re,{status:u.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(re,{icon:n,value:x.inputs}),e.jsx(re,{icon:i,value:x.behaviors}),e.jsx(re,{icon:l,value:x.executions}),e.jsx(re,{icon:o,value:x.inputsSinceBranch}),e.jsx(re,{icon:c,value:x.timeSpent})]})]})}function _(u){return[u.nodeid,st[u.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(ke,{headers:d,data:t,row:p,mobileRow:g,filterStrings:_,onFilterChange:r})]})}function xs(){const{tests:s}=it(),[r,t]=f.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx(ot,{tests:s,filterString:r}),e.jsx(gs,{tests:s,onFilterChange:t})]})}function vs(){const s=gt;return e.jsx(s,{children:e.jsx(is,{children:e.jsx(ls,{children:e.jsx(Wt,{children:e.jsx(xt,{children:e.jsxs(q,{element:e.jsx(zt,{}),children:[e.jsx(q,{path:"/",element:e.jsx(xs,{})}),e.jsx(q,{path:"/patches",element:e.jsx(hs,{})}),e.jsx(q,{path:"/collected",element:e.jsx(cs,{})}),e.jsx(q,{path:"/tests/:nodeid",element:e.jsx(_s,{})}),e.jsx(q,{path:"*",element:e.jsx(us,{})})]})})})})})})}Ut.createRoot(document.getElementById("app")).render(e.jsx(vt.StrictMode,{children:e.jsx(vs,{})}));
