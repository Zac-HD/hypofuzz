var Dt=Object.defineProperty;var Ft=(t,r,s)=>r in t?Dt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var V=(t,r,s)=>Ft(t,typeof r!="symbol"?r+"":r,s);import{r as It,g as ht,a as m,u as Xe,b as Pt,L as Z,O as Bt,c as mt,d as Ot,R as Ue,H as Xt,e as Ut,f as G}from"./react-DOgvK_Td.js";import{F as A,f as ft,S as X,r as Wt,a as Vt,b as Kt,c as Ht,d as zt,L as Q,e as Yt,g as Gt,h as Jt,i as qt,j as $e,k as Zt,l as Qt,m as es,n as ts,o as ss,p as ns,q as rs,s as is,t as Je,u as qe,v as ge,w as xe,x as ve,y as be,z as as,A as pt,B as _t,O as os}from"./vendor-CnT9-Eog.js";import{d as gt,a as ls,b as cs,c as us,o as xt,l as le,s as De,e as ds,i as Re,f as hs,g as ms,h as fs,j as ps,q as _s}from"./d3-C73lxztM.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Ee={exports:{}},ne={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze;function gs(){if(Ze)return ne;Ze=1;var t=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function s(n,i,a){var u=null;if(a!==void 0&&(u=""+a),i.key!==void 0&&(u=""+i.key),"key"in i){a={};for(var d in i)d!=="key"&&(a[d]=i[d])}else a=i;return i=a.ref,{$$typeof:t,type:n,key:u,ref:i!==void 0?i:null,props:a}}return ne.Fragment=r,ne.jsx=s,ne.jsxs=s,ne}var Qe;function xs(){return Qe||(Qe=1,Ee.exports=gs()),Ee.exports}var e=xs();Array.prototype.sortKey||(Array.prototype.sortKey=function(t){return this.sort((r,s)=>{const n=t(r),i=t(s);if(Array.isArray(n)&&Array.isArray(i)){for(let a=0;a<Math.min(n.length,i.length);a++){if(n[a]<i[a])return-1;if(n[a]>i[a])return 1}return 0}return n<i?-1:n>i?1:0})});var vs=It();const bs=ht(vs);function ys({message:t,onDismiss:r,isVisible:s}){const[n,i]=m.useState(s);return m.useEffect(()=>{if(s){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[s]),n?e.jsxs("div",{className:`notification ${s?"notification--visible":"notification--hidden"}`,onClick:r,children:[e.jsx("div",{className:"notification__content",children:t}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),r()},"aria-label":"Close notification",children:e.jsx(A,{icon:ft})})]}):null}const vt=m.createContext(null);function js({children:t}){const[r,s]=m.useState([]),n=m.useRef(new Map),i=m.useRef(0),a=m.useCallback(l=>{clearTimeout(n.current.get(l)),n.current.delete(l),s(o=>o.filter(c=>c.id!==l))},[]),u=m.useCallback((l,o)=>{const c=++i.current,h={id:c,message:l,duration:o};if(s(g=>[...g,h]),o!==null){const g=setTimeout(()=>{a(c)},o);n.current.set(c,g)}return c},[a]),d=m.useCallback((l,o,c)=>{if(s(h=>h.map(g=>g.id===l?{...g,message:o,duration:c}:g)),c!==null){clearTimeout(n.current.get(l));const h=setTimeout(()=>{a(l)},c);n.current.set(l,h)}},[a]);return e.jsxs(vt.Provider,{value:{addNotification:u,updateNotification:d,dismissNotification:a},children:[t,e.jsx("div",{className:"notifications",children:r.map((l,o)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+o*80}px`},children:e.jsx(ys,{message:l.message,isVisible:!0,onDismiss:()=>a(l.id)})},l.id))})]})}function ws(){const t=m.useContext(vt);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t}function We(){const[t,r]=m.useState(!1);return m.useEffect(()=>{function s(){r(window.matchMedia("(max-width: 768px)").matches)}return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function se({value:t,onChange:r,options:s,disabled:n=!1}){const i=We();return console.assert(X(s.map(a=>a.value)).size===s.length),e.jsx("div",{className:`toggle ${n?"toggle--disabled":""}`,children:s.map(a=>e.jsx("button",{className:`toggle__button${t===a.value?" toggle__button--active":""} ${n?"toggle__button--disabled":""}`,onClick:()=>{if(!n)if(s.length==2&&t===a.value){const u=s.find(d=>d.value!==a.value).value;r(u)}else r(a.value)},children:i?a.mobileContent??a.content:a.content},String(a.value)))})}class bt{constructor(r,s,n,i){V(this,"createdAt");this.name=r,this.predicate=s,this.component=n,this.extraData=i,this.createdAt=Date.now()}}const yt=m.createContext(void 0);function Ns({children:t}){const[r,s]=m.useState(new Map([["covering",new Map],["rolling",new Map]])),[n,i]=m.useState("covering"),a=r.get(n)||new Map,u=o=>{s(c=>{const h=new Map(c);return h.set(n,o),h})},l={filters:a,setFilters:u,removeFilter:(o,c)=>{const h=new Map(a),p=(h.get(o)||[]).filter(b=>b.name!==c);p.length===0?h.delete(o):h.set(o,p),u(h)},observationCategory:n,setObservationCategory:i};return e.jsx(yt.Provider,{value:l,children:t})}function Ne(){const t=m.useContext(yt);if(t===void 0)throw new Error("useFilters must be used within a FilterProvider");return t}const jt=m.createContext(null);function Ss({state:t}){return t.visible?Pt.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${t.x+10}px`,top:`${t.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:t.content}}),document.body):null}function ks({children:t}){const r=Xe(),[s,n]=m.useState({visible:!1,content:"",x:0,y:0,owner:null});m.useEffect(()=>{n(l=>({...l,visible:!1,owner:null}))},[r.pathname]);const i=m.useCallback((l,o,c,h)=>{n({visible:!0,content:l,x:o,y:c,owner:h})},[]),a=m.useCallback(l=>{n(o=>o.owner===l?{...o,visible:!1,owner:null}:o)},[]),u=m.useCallback((l,o,c)=>{n(h=>h.visible&&h.owner===c&&(h.x!==l||h.y!==o)?{...h,x:l,y:o}:h)},[]),d=m.useMemo(()=>({showTooltip:i,hideTooltip:a,moveTooltip:u,visible:s.visible}),[i,a,u,s.visible]);return e.jsxs(jt.Provider,{value:d,children:[t,e.jsx(Ss,{state:s})]})}function Se(){const t=m.useContext(jt);if(!t)throw new Error("useTooltip must be used within a TooltipProvider");return t}var Cs=Wt();const de=ht(Cs);function wt(t,r=0){return Array.from(t).reduce((s,n)=>s+n,r)}function Nt(t,r=!1){t.current&&(r&&t.current.querySelectorAll("code").forEach(s=>{s.removeAttribute("data-highlighted")}),t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(s=>{de.highlightElement(s)}))}function ce(t,r){if(r){let s=null,n=null;for(let i=0;i<t.length;i++){const a=t[i],u=r(a);u!=null&&(n===null||u>n)&&(n=u,s=a)}return s}else{let s=null;for(let n=0;n<t.length;n++){const i=t[n];i!=null&&(s===null||i>s)&&(s=i)}return s}}function Rs(t,r){{let s=null;for(let n=0;n<t.length;n++){const i=t[n];i!=null&&(s===null||i<s)&&(s=i)}return s}}function Me(t,r,s){let n=0,i=t.length;for(;n<i;){const a=n+i>>>1;(s?s(t[a])<=r:t[a]<=r)?n=a+1:i=a}return n}let re=null;function Es(){return re||(re=document.createElement("div"),re.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(re)),re}function Ae(t,r=""){const s=Es();s.className=r,s.textContent=t;const n=s.getBoundingClientRect();return{width:n.width,height:n.height}}function St(t,r,s){if(t.metaKey||t.ctrlKey){const n=window.location,i=`${n.origin}${n.pathname}#${r}`;console.log(n.origin,n.pathname,r,i),window.open(i,"_blank")}else s(r)}function kt(t){return t.split("::").pop()||t}const H={select:gt,scaleLinear:le,scaleOrdinal:xt,scaleBand:us,axisBottom:cs,axisLeft:ls},et=5,K=2.5;function Ms({feature:t,observations:r}){const s=m.useRef(null),n=m.useRef(null),{filters:i,setFilters:a}=Ne(),{showTooltip:u,hideTooltip:d,moveTooltip:l}=Se(),o=m.useMemo(()=>{const g=i.get(t)||[];if(g.length===0)return X();console.assert(g.length===1);const p=g[0];return X(p.extraData.selectedValues)},[i,t]),c=m.useMemo(()=>({raw:r.raw.filter(g=>g.status!=="gave_up"),filtered:r.filtered.filter(g=>g.status!=="gave_up")}),[r]),h=m.useCallback(g=>{let p=X();o.equals(X([g]))?p=X():p=X([g]);let b;p.size===1?b=p.first():b=p.map(_=>`${_}`).join(" or ");const v=[];p.size>0&&v.push(new bt(b,_=>p.some(N=>_.features.get(t)===N),t,{selectedValues:p}));const w=new Map(i);w.set(t,v),a(w)},[i,t,o,a]);return m.useEffect(()=>{const g=X(c.raw.map(x=>x.features.get(t)));let p=new Map;for(const x of c.filtered){const S=x.features.get(t);p.set(S,(p.get(S)||0)+1)}const b=wt(Array.from(p.values()));p=new Map([...p.entries()].sortKey(([x,S])=>x===pe?0:x===_e?1:x)),H.select(n.current).selectAll("*").remove();const v=s.current.clientWidth,w=g.size<et?85:170,_=H.select(n.current).attr("width",v).attr("height",w).append("g"),N=function(x,S){const[j,E]=S;u(`${t}<br>${j}: ${E}`,x.clientX,x.clientY,"tyche-nominal")};if(g.size<et){const x={top:0,right:15,bottom:20,left:15},S=v-x.left-x.right,j=w-x.top-x.bottom,E=H.scaleLinear().domain([0,1]).range([0,S]);let C;p.has(pe)||p.has(_e)?C=B=>B===pe?U.SUCCESS:B===_e?U.ERROR:U.PRIMARY:C=H.scaleOrdinal().domain(Array.from(p.keys())).range([U.PRIMARY,U.ACCENT,U.ACCENT2,U.ACCENT3,U.ACCENT4]);const M=_.append("g").attr("transform",`translate(${x.left},${x.top})`);let L=0;const $=j-x.bottom;p.forEach((B,f)=>{const y=B/b*S,k=o.has(f);M.append("rect").attr("x",L).attr("y",0).attr("width",y).attr("height",$).attr("fill",C(f)).style("cursor","pointer").on("click",()=>h(f)).on("mouseover",T=>{N(T,[f,B])}).on("mousemove",T=>l(T.clientX,T.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),k&&M.append("rect").attr("x",L+K).attr("y",K).attr("width",y-2*K).attr("height",$-2*K).attr("fill",C(f)).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),M.append("text").attr("x",L+y/2).attr("y",$/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(f).style("font-size","12px"),L+=y}),M.append("g").attr("transform",`translate(0,${$})`).call(H.axisBottom(E).tickFormat(B=>`${Math.round(Number(B)*100)}%`)),M.append("text").attr("x",S/2).attr("y",$+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const x={top:5,right:5,bottom:30,left:30},S=v-x.left-x.right,j=w-x.top-x.bottom,E=H.scaleBand().domain(Array.from(p.keys())).range([0,S]).padding(.2),C=H.scaleLinear().domain([0,ce(Array.from(p.values()))||0]).range([j,0]),M=_.append("g").attr("transform",`translate(${x.left},${x.top})`);M.selectAll(".bar").data(Array.from(p.entries())).enter().append("rect").attr("class","bar").attr("x",([L,$])=>E(L)||0).attr("y",([L,$])=>C($)).attr("width",E.bandwidth()).attr("height",([L,$])=>j-C($)).attr("fill",U.PRIMARY).style("cursor","pointer").on("click",function(L,[$,B]){h($)}).on("mouseover",function(L,$){N(L,$)}).on("mousemove",L=>l(L.clientX,L.clientY,"tyche-nominal")).on("mouseleave",()=>d("tyche-nominal")),M.selectAll(".inner-bar").data(Array.from(p.entries()).filter(([L,$])=>o.has(L))).enter().append("rect").attr("class","inner-bar").attr("x",([L,$])=>(E(L)||0)+K).attr("y",([L,$])=>C($)+K).attr("width",E.bandwidth()-2*K).attr("height",([L,$])=>j-C($)-2*K).attr("fill",U.PRIMARY).attr("stroke","white").attr("stroke-width",K).style("pointer-events","none"),M.append("g").attr("transform",`translate(0,${j})`).call(H.axisBottom(E)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),M.append("g").call(H.axisLeft(C).ticks(7).tickFormat(L=>Math.round(Number(L)).toString())),M.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-j/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}},[c,t,d,l,h,o,u]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:t}),e.jsx("div",{ref:s,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:n,style:{width:"100%"}})})]})}function Ve({title:t,children:r,defaultState:s="open",onStateChange:n,headerClass:i="",contentClass:a=""}){const[u,d]=m.useState(s),l=()=>{const o=u==="open"?"closed":"open";d(o),n==null||n(o)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:l,children:[e.jsx("span",{className:"collapsible__toggle",children:u==="open"?e.jsx(A,{icon:Vt}):e.jsx(A,{icon:Kt})}),t]}),u==="open"&&e.jsx("div",{className:`${a}`,children:r})]})}function Ke({title:t,children:r,defaultState:s="open",onStateChange:n}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Ve,{title:t,defaultState:s,onStateChange:n,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:r})})}function As({observations:t}){const r=new Set;return t.raw.forEach(s=>{for(const n of s.features.keys())n.startsWith("Retried draw from")||r.add(n)}),r.size===0?null:e.jsx(Ke,{title:"Features",children:Array.from(r).sort().map(s=>e.jsx(Ms,{feature:s,observations:t}))})}function Ts(){const{filters:t,removeFilter:r}=Ne(),s=Array.from(t.values()).flat().sortKey(n=>n.createdAt);return s.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),s.map(n=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>r(n.component,n.name),children:e.jsx(A,{icon:ft})}),n.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:n.name})]},`${n.component}-${n.name}`))]})}function Ct(t){const r=t.regex,s=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),n=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],d={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:n,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},l={className:"meta",begin:/^(>>>|\.\.\.) /},o={className:"subst",begin:/\{/,end:/\}/,keywords:d,illegal:/#/},c={begin:/\{\{/,relevance:0},h={className:"string",contains:[t.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,l],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,l,c,o]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,l,c,o]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[t.BACKSLASH_ESCAPE,c,o]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[t.BACKSLASH_ESCAPE,c,o]},t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},g="[0-9](_?[0-9])*",p=`(\\b(${g}))?\\.(${g})|\\b(${g})\\.`,b=`\\b|${n.join("|")}`,v={className:"number",relevance:0,variants:[{begin:`(\\b(${g})|(${p}))[eE][+-]?(${g})[jJ]?(?=${b})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${b})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${b})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${b})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${b})`},{begin:`\\b(${g})[jJ](?=${b})`}]},w={className:"comment",begin:r.lookahead(/# type:/),end:/$/,keywords:d,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},_={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:d,contains:["self",l,v,h,t.HASH_COMMENT_MODE]}]};return o.contains=[h,v,l],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:d,illegal:/(<\/|\?)|=>/,contains:[l,v,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},h,w,t.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,s],scope:{1:"keyword",3:"title.function"},contains:[_]},{variants:[{match:[/\bclass/,/\s+/,s,/\s*/,/\(\s*/,s,/\s*\)/]},{match:[/\bclass/,/\s+/,s]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[v,_,h]}]}}function tt({currentPage:t,pageCount:r,onPageChange:s}){console.assert(r>1);function n(){return r<=7?Array.from({length:r},(l,o)=>o):t<=3?[0,1,2,3,4,"ellipsis",r-1]:t>=r-4?[0,"ellipsis",r-5,r-4,r-3,r-2,r-1]:[0,"ellipsis",t-1,t,t+1,"ellipsis",r-1]}const i=n();function a(l){typeof l=="number"&&t!==l&&s(l)}function u(){t>0&&s(t-1)}function d(){t<r-1&&s(t+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${t===0?"pagination__nav--disabled":""}`,onClick:u,children:e.jsx(A,{icon:Ht})}),i.map((l,o)=>{if(l==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${o}`);const c=l===t;return e.jsx("div",{className:`pagination__number ${c?"pagination__number--current":""}`,onClick:()=>a(l),children:l+1},l)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${t===r-1?"pagination__nav--disabled":""}`,onClick:d,children:e.jsx(A,{icon:zt})})]})}de.registerLanguage("python",Ct);const Te=30;function Ls({observations:t,observationCategory:r}){const s=m.useRef(null),[n,i]=m.useState(0);m.useEffect(()=>{i(0)},[r]);function a(){s.current&&s.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(o=>{de.highlightElement(o)})}m.useEffect(()=>{a()},[t,n]);const u=new Map;t.filtered.forEach(o=>{const c=o.representation;u.set(c,(u.get(c)||0)+1)});const d=Math.ceil(u.size/Te),l=Array.from(u.entries()).sortKey(([o,c])=>-c).slice(n*Te,(n+1)*Te);return e.jsx(Ke,{title:"String representations",defaultState:"closed",onStateChange:o=>{o==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:s,children:[d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(tt,{currentPage:n,pageCount:d,onPageChange:i})}),l.map(([o,c])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:o})}),c>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",c]})]},o)),d>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(tt,{currentPage:n,pageCount:d,onPageChange:i})})]})})}const st=640;function $s({name:t,observations:r,verticalAxis:s,horizontalAxis:n,cssStyle:i=(a,u)=>({})}){const{filters:a,setFilters:u}=Ne(),{showTooltip:d,hideTooltip:l,moveTooltip:o}=Se(),c=m.useMemo(()=>{const f=a.get(t)||[];if(f.length===0)return X();console.assert(f.length===1);const y=f[0];return X(y.extraData.selectedCells)},[a,t]),h=[],g=Array(s.length).fill(0),p=Array(n.length).fill(0);let b=0;for(let f=0;f<s.length;f++){h[f]=[];for(let y=0;y<n.length;y++)h[f][y]={count:0,widthPercent:0}}r.filtered.forEach(f=>{for(let y=0;y<s.length;y++){const[,k]=s[y];if(k(f)){for(let T=0;T<n.length;T++){const[,D]=n[T];if(D(f)){h[y][T].count++,g[y]++,p[T]++,b++;break}}break}}});const v=g.map((f,y)=>f>0?y:null).filter(f=>f!==null),w=p.map((f,y)=>f>0?y:null).filter(f=>f!==null),_=(f,y)=>{let k=X();if(f!==null&&y!==null){const R=Q([f,y]);c.equals(X([R]))?k=X():k=X([R])}else f!==null?(console.assert(y===null),w.forEach(R=>{h[f][R].count>0&&(k=k.add(Q([f,R])))})):y!==null&&(console.assert(f===null),v.forEach(R=>{h[R][y].count>0&&(k=k.add(Q([R,y])))}));function T(){if(k.size===0)return"";let R=k;const P=[],Y=[...v.map(F=>({name:s[F][0],cells:w.filter(W=>h[F][W].count>0).map(W=>Q([F,W]))})),...w.map(F=>({name:n[F][0],cells:v.filter(W=>h[W][F].count>0).map(W=>Q([W,F]))}))];for(const F of Y)F.cells.length>0&&F.cells.every(W=>R.has(W))&&(P.push(F.name),R=R.subtract(X(F.cells)));for(;R.size>0;){const F=R.first(),[W,Ce]=F.toArray();P.push(`${s[W][0]}+${n[Ce][0]}`),R=R.delete(F)}return console.assert(R.size==0),P.join(" or ")}const D=[];k.size>0&&D.push(new bt(T(),R=>k.some(P=>{const[Y,F]=P.toArray(),W=s[Y][1],Ce=n[F][1];return W(R)&&Ce(R)}),t,{selectedCells:k}));const O=new Map(a);O.set(t,D),u(O)},{rowHeaderWidth:N,columnHeaderHeight:x,rowTotalWidth:S}=m.useMemo(()=>({rowHeaderWidth:Math.max(...v.map(f=>Ae(s[f][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(...w.map(f=>Ae(n[f][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...v.map(f=>Ae(g[f].toString(),"tyche__mosaic__row-total").width))}),[v,w,s,n,g]);if(v.length===0||w.length===0)return e.jsx("div",{children:"No observations"});const j=30,E=30,C=45*v.length;for(let f=0;f<s.length;f++)for(let y=0;y<n.length;y++)h[f][y].widthPercent=g[f]>0?h[f][y].count/g[f]*100:0;const L=v.map(f=>g[f]/b*C).map(f=>Math.max(f,E)),$=w.map((f,y)=>y===0?0:y===w.length-1?100:y/(w.length-1)*100),B=st-N-S;return v.forEach(f=>{const y=w.map(T=>h[f][T]);if(y.reduce((T,D)=>T+D.widthPercent,0)>0){const D=y.map(R=>R.widthPercent/100*B).map((R,P)=>y[P].count>0&&R>0&&R<j?j:R),O=D.reduce((R,P)=>R+P,0);w.forEach((R,P)=>{h[f][R].widthPercent=O>0?D[P]/O*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${st}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${N}px`,marginRight:`${S}px`,height:`${x}px`},children:w.map((f,y)=>{const k=y===0,T=y===w.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${$[y]}%`,transform:k?"translateX(0%)":T?"translateX(-100%)":"translateX(-50%)",textAlign:k?"left":T?"right":"center"},onClick:()=>_(null,f),children:n[f][0]},`header-${f}`)})}),v.map((f,y)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${L[y]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${N}px`,cursor:"pointer"},onClick:()=>_(f,null),children:s[f][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:w.map(k=>{const T=h[f][k];if(T.count===0)return null;const D=c.has(Q([f,k])),O=`${s[f][0]} and ${n[k][0]}<br>Count: ${T.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${D?" tyche__mosaic__cell--selected":""}`,style:{width:`${T.widthPercent}%`,minWidth:`${j}px`,minHeight:`${E}px`,...i(s[f][0],n[k][0])},onClick:()=>_(f,k),onMouseEnter:R=>d(O,R.clientX,R.clientY,"tyche-mosaic"),onMouseMove:R=>o(R.clientX,R.clientY,"tyche-mosaic"),onMouseLeave:()=>l("tyche-mosaic"),children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:T.count})},`cell-${f}-${k}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${S}px`},children:g[f]})]},`row-${f}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${x}px`},children:[e.jsx("div",{style:{width:`${N}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${S}px`},children:w.map((f,y)=>{const k=y===0,T=y===w.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${$[y]}%`,transform:k?"translateX(0%)":T?"translateX(-100%)":"translateX(-50%)",textAlign:k?"left":T?"right":"center"},children:p[f]},`total-${f}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${S}px`},children:b})]})]})}function Ds({observations:t}){function r(s,n){const i={};return s==="Passed"?i.backgroundColor=U.SUCCESS:s==="Invalid"?i.backgroundColor=U.WARNING:s==="Failed"&&(i.backgroundColor=U.ERROR),n==="Duplicate"&&(i.opacity=.7),i}return e.jsx(Ke,{title:"Samples",children:e.jsx($s,{name:"samples",observations:t,verticalAxis:[["Passed",s=>s.status==="passed"],["Invalid",s=>s.status==="gave_up"]],horizontalAxis:[["Unique",s=>s.isUnique??!1],["Duplicate",s=>s.isDuplicate??!1]],cssStyle:r})})}const pe="Present",_e="Not present";var U=(t=>(t.PRIMARY="#6b8ab5",t.SUCCESS="#8ba86b",t.WARNING="#d59a7e",t.ERROR="#c77a7e",t.ACCENT="#c1a2bb",t.ACCENT2="#9fc7c6",t.ACCENT3="#edd39a",t.ACCENT4="#99c7d6",t.ACCENT5="#8faac6",t))(U||{});function Fs({test:t}){const{filters:r,observationCategory:s,setObservationCategory:n}=Ne(),i=s==="rolling"?t.rolling_observations.sortKey(d=>-d.run_start):t.corpus_observations,a=m.useMemo(()=>{const d=Array.from(r.values()).flat();return d.length===0?i:i.filter(l=>d.every(o=>o.predicate(l)))},[i,r]),u={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(se,{value:s,onChange:n,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx(Ts,{}),u.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Ds,{observations:u}),e.jsx(As,{observations:u}),e.jsx(Ls,{observations:u,observationCategory:s})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function Is({test:t}){return e.jsx(Ns,{children:e.jsx(Fs,{test:t})})}const nt=["Skipped","SkipTest"];class he{withProperties(r){return Object.assign(Object.create(this.constructor.prototype),this,r)}}class He extends he{constructor(r,s){super(),this.state=r,this.observation=s}static fromJson(r){return new He(r.state,ue.fromJson(r.observation))}}class q extends he{constructor(r=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=r}static fromJson(r){const s=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[n,i]of Object.entries(r))console.assert(typeof i=="number"),s.set(Number(n),i);return new q(s)}add(r){const s=new Map(this.counts);for(const[n,i]of r.counts.entries())s.set(n,s.get(n)+i);return new q(s)}subtract(r){const s=new Map(this.counts);for(const[n,i]of r.counts.entries())s.set(n,s.get(n)-i);return new q(s)}sum(){return wt(this.counts.values())}}var Fe=(t=>(t.GENERATE="generate",t.REPLAY="replay",t.DISTILL="distill",t.SHRINK="shrink",t.FAILED="failed",t))(Fe||{});class ke extends he{constructor(s,n,i,a,u,d,l,o){super();V(this,"status_counts_diff");V(this,"elapsed_time_diff");V(this,"timestamp_monotonic");this.elapsed_time=s,this.timestamp=n,this.status_counts=i,this.behaviors=a,this.fingerprints=u,this.since_new_behavior=d,this.phase=l,this.worker_uuid=o,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(s,n){return new ke(n.elapsed_time,n.timestamp,q.fromJson(n.status_counts),n.behaviors,n.fingerprints,n.since_new_behavior,n.phase,s)}}class ue extends he{constructor(s,n,i,a,u,d,l,o,c,h,g){super();V(this,"isDuplicate",null);V(this,"isUnique",null);this.type=s,this.status=n,this.status_reason=i,this.representation=a,this.arguments_=u,this.how_generated=d,this.features=l,this.timing=o,this.metadata=c,this.property=h,this.run_start=g}static fromJson(s){return new ue(s.type,s.status,s.status_reason,s.representation,new Map(Object.entries(s.arguments)),s.how_generated,new Map(Object.entries(s.features)),new Map(Object.entries(s.timing)),new Map(Object.entries(s.metadata)),s.property,Number(s.run_start))}}var I=(t=>(t[t.FAILED_FATALLY=0]="FAILED_FATALLY",t[t.FAILED=1]="FAILED",t[t.SHRINKING=2]="SHRINKING",t[t.RUNNING=3]="RUNNING",t[t.SKIPPED_DYNAMICALLY=4]="SKIPPED_DYNAMICALLY",t[t.WAITING=5]="WAITING",t))(I||{});function rt(t,r){const s=r?r.status_counts:new q,n=r?r.elapsed_time:0,i=t.status_counts.subtract(s),a=t.elapsed_time-n,u=r?Math.max(t.timestamp,r.timestamp_monotonic+a):t.timestamp;return console.assert(Array.from(i.counts.values()).every(d=>d>=0)),console.assert(a>=0),t.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:u})}const oe=class oe extends he{constructor(s,n,i,a,u,d,l){super();V(this,"linear_reports");V(this,"_status_counts_cumsum");V(this,"_elapsed_time_cumsum");V(this,"load_finished_at",null);this.database_key=s,this.nodeid=n,this.rolling_observations=i,this.corpus_observations=a,this.failures=u,this.fatal_failure=d,this.reports_by_worker=l,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map,this.load_finished_at=null;const o=this.reports_by_worker;this.reports_by_worker=new Map;const c=Array.from(o.entries()).flatMap(([h,g])=>g.map(p=>[h,p])).sortKey(([h,g])=>g.timestamp);for(const[h,g]of c)this.add_report(h,g);this._check_invariants()}static fromJson(s){return new oe(s.database_key,s.nodeid,[],[],new Map(Object.entries(s.failures).map(([n,i])=>[n,He.fromJson(i)])),s.fatal_failure,new Map(Object.entries(s.reports_by_worker).map(([n,i])=>[n,i.map(ke.fromJson)])))}_assert_reports_ordered(s){for(let n=0;n<s.length-1;n++)console.assert(s[n].timestamp_monotonic<=s[n+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const s=this.linear_status_counts(null);for(let i=0;i<s.length-1;i++)console.assert(s[i].sum()<=s[i+1].sum());const n=this.linear_elapsed_time(null);for(let i=0;i<n.length-1;i++)console.assert(n[i]<=n[i+1]);console.assert(n.length===s.length&&s.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(s,n){let i=null,a=0;if(this.reports_by_worker.has(s)){const d=this.reports_by_worker.get(s);a=Me(d,n.elapsed_time,l=>l.elapsed_time),i=a!=0?d[a-1]:null}const u=rt(n,i);if(this.reports_by_worker.has(s)||this.reports_by_worker.set(s,[]),this.reports_by_worker.get(s).splice(a,0,u),u.phase!==Fe.REPLAY||u.behaviors>=this.behaviors&&u.fingerprints>=this.fingerprints){const d=Me(this.linear_reports,u.timestamp_monotonic,l=>l.timestamp_monotonic);if(this.linear_reports.splice(d,0,u),d!=this.linear_reports.length-1){let l=null,o;for(o=0;o<this.linear_reports.length-(d+1);o++){const c=this.linear_reports[d+1+o];if(u.worker_uuid===c.worker_uuid){l=c;break}}l&&(console.assert(this.linear_reports[d+1+o]===l),this.linear_reports[d+1+o]=rt(l,u));for(const c of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[h,[g,p]]of c.entries())d>=g&&c.set(h,[g,p.slice(0,d-g)])}}}get normalFailures(){return Array.from(this.failures.entries()).filter(([s,n])=>!nt.some(i=>s.includes(`${i} at`))).map(([s,n])=>n)}get skipFailures(){return Array.from(this.failures.entries()).filter(([s,n])=>nt.some(i=>s.includes(`${i} at`))).map(([s,n])=>n)}get status(){if(this.skipFailures.length>0)return I.SKIPPED_DYNAMICALLY;if(this.fatal_failure)return I.FAILED_FATALLY;if(this.failures.size>0)return I.FAILED;if(this.linear_reports.length===0)return I.WAITING;const s=this.linear_reports[this.linear_reports.length-1],n=new Date().getTime()/1e3;return s.phase==Fe.SHRINK?I.SHRINKING:s.ninputs===0||s.timestamp<n-oe.WAITING_STATUS_DURATION?I.WAITING:I.RUNNING}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_behavior(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_behavior}elapsed_time(s){const n=this.linear_elapsed_time(s);return n.length===0?0:n[n.length-1]}ninputs(s){const n=this.linear_status_counts(s);return n.length===0?0:n[n.length-1].sum()}_cumsum(s,n,i,a,u){if(a===null&&(a=-1/0),s.has(a)){const[c,h]=s.get(a);if(h.length<this.linear_reports.slice(c).length){let g=h.length>0?h[h.length-1]:u;for(const p of this.linear_reports.slice(c+h.length))g=i(g,p[n]),h.push(g);s.set(a,[c,h])}return h}const d=[],l=Me(this.linear_reports,a,c=>c.timestamp_monotonic);let o=u;for(const c of this.linear_reports.slice(l))o=i(o,c[n]),d.push(o);return s.set(a,[l,d]),d}linear_status_counts(s){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(n,i)=>n.add(i),s,new q)}linear_elapsed_time(s){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(n,i)=>n+i,s,0)}};V(oe,"WAITING_STATUS_DURATION",120);let Ie=oe;const Rt=m.createContext(null);function it(t){const r=new Map;t.forEach(n=>{r.set(n.representation,(r.get(n.representation)||0)+1)}),t.forEach(n=>{const i=r.get(n.representation);n.isUnique=i==1,n.isDuplicate=i>1});const s=new Set;t.forEach(n=>{n.features.forEach((i,a)=>{s.add(a)})}),t.forEach(n=>{s.forEach(i=>{n.features.has(i)||n.features.set(i,_e)});for(const[i,a]of n.features)a===""&&n.features.set(i,pe)})}function Ps(t,r){const s=new Map(t);function n(i){if(s.has(i))return s.get(i);{const a=new Ie(null,i,[],[],new Map,null,new Map);return s.set(a.nodeid,a),a}}switch(r.type){case 1:return t;case 2:{const{tests:i}=r;for(const{database_key:a,nodeid:u,failures:d,fatal_failure:l}of i){const o=n(u);o.database_key=a,d.forEach((c,h)=>{o.failures.set(h,c)}),o.fatal_failure=l}return s}case 3:{const{nodeid:i,worker_uuid:a,reports:u}=r,d=n(i);for(const l of u)d.add_report(a,l);return s}case 5:{const{nodeid:i,failures:a}=r,u=n(i);return a.forEach((d,l)=>{u.failures.set(l,d)}),s}case 4:{const{nodeid:i,observation_type:a,observations:u}=r,d=n(i);return a==="rolling"?(d.rolling_observations.push(...u),d.rolling_observations=d.rolling_observations.sortKey(l=>-l.run_start).slice(0,300),it(d.rolling_observations)):(console.assert(a==="corpus"),d.corpus_observations.push(...u),it(d.corpus_observations)),s}case 7:{const{nodeid:i}=r,a=n(i);return a.load_finished_at=Date.now(),s}default:throw new Error("non-exhaustive switch in testsReducer")}}function Bs({children:t}){const[r,s]=m.useState(null),[n,i]=m.useReducer(Ps,new Map),[a,u]=m.useState(!1),[d,l]=m.useState(null),[o,c]=m.useState({count_tests:null,count_tests_loaded:null}),{addNotification:h,updateNotification:g,dismissNotification:p}=ws();m.useRef(null);const b=m.useCallback(w=>{u(!0),l(w)},[]),v=m.useCallback(()=>{const w=Date.now();return o.count_tests_loaded!==null&&o.count_tests!==null&&o.count_tests_loaded===o.count_tests&&Array.from(n.values()).every(_=>_.load_finished_at===null?!1:w-_.load_finished_at>200)},[o,n]);return m.useEffect(()=>{if(a){n.clear(),c({count_tests:null,count_tests_loaded:null});{fetch(new URL("dashboard_state/tests.json",import.meta.url)).then(_=>_.text()).then(_=>JSON.parse(_)).then(_=>{Object.entries(_).forEach(([N,x])=>{i({type:2,tests:[{database_key:x.database_key,nodeid:N,failures:x.failures,fatal_failure:x.fatal_failure}]});for(const[S,j]of Object.entries(x.reports_by_worker))i({type:3,nodeid:N,worker_uuid:S,reports:j.map(E=>ke.fromJson(S,E))});i({type:7,nodeid:N})})});const w=new Worker(new URL("/example-dashboard/assets/jsonWorker-KJVNTzbb.js",import.meta.url));return fetch(new URL("dashboard_state/observations.json",import.meta.url)).then(_=>_.text()).then(_=>new Promise(N=>{w.onmessage=x=>N(x.data),w.postMessage(_)})).then(_=>{for(const[N,x]of Object.entries(_))i({type:4,nodeid:N,observation_type:"rolling",observations:x.rolling.map(ue.fromJson)}),i({type:4,nodeid:N,observation_type:"corpus",observations:x.corpus.map(ue.fromJson)})}),()=>w.terminate()}}},[d,a,h,p,g]),e.jsx(Rt.Provider,{value:{tests:n,socket:r,doLoadData:b,testsLoaded:v},children:t})}function ze(t=null){const r=m.useContext(Rt);if(!r)throw new Error("useData must be used within a DataProvider");return m.useEffect(()=>{r.doLoadData(t)},[t,r]),r}function me({to:t,icon:r,children:s,isActive:n}){const i=Xe();return e.jsx(Z,{to:t,className:"sidebar__link__text",children:e.jsxs("div",{className:`sidebar__link ${n(i.pathname)?"sidebar__link--active":""}`,children:[e.jsx("span",{className:"sidebar__link__icon",children:r}),s]})})}function Os(){const t=Xe(),[r,s]=m.useState(!1),n=m.useRef(null);return m.useEffect(()=>{function i(a){var u;r&&((u=n.current)==null?void 0:u.contains(a.target))===!1&&s(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[r]),m.useEffect(()=>{s(!1)},[t]),e.jsxs("div",{className:"layout",children:[!r&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>s(!0),children:e.jsx(A,{icon:Yt,size:"lg"})}),r&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:n,className:`sidebar ${r?"sidebar--open":""}`,children:[e.jsx(Z,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(me,{to:"/",isActive:i=>i==="/"||i.startsWith("/tests/"),icon:e.jsx(A,{icon:Gt}),children:"Tests"}),e.jsx(me,{icon:e.jsx(A,{icon:Jt}),to:"/patches",isActive:i=>i==="/patches",children:"Patches"}),e.jsx(me,{icon:e.jsx(A,{icon:qt}),to:"/collected",isActive:i=>i==="/collected",children:"Collection"}),e.jsx(me,{icon:e.jsx(A,{icon:$e}),to:"/workers",isActive:i=>i==="/workers",children:"Workers"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/example-dashboard".replace(/\/$/,"")}/docs/`,className:"sidebar__link__text",children:e.jsxs("div",{className:"sidebar__link",children:[e.jsx("span",{className:"sidebar__link__icon",children:e.jsx(A,{icon:Zt})}),"Docs"]})})]})]}),e.jsx("div",{className:"content",children:e.jsx(Bt,{})})]})}function Ye({headers:t,data:r,row:s,mobileRow:n,getKey:i,onFilterChange:a,filterStrings:u}){const[d,l]=m.useState(null),[o,c]=m.useState(0),[h,g]=m.useState(""),p=We(),b=m.useMemo(()=>{let _=r;if(h&&(_=r.filter(x=>u?u(x).some(S=>S.toLowerCase().includes(h.toLowerCase())):!0)),d===null)return _;const N=[..._].sortKey(x=>t[d].sortKey(x));return o===0?N:N.reverse()},[r,d,o,t,h,u]),v=_=>{t[_].sortKey&&(d===_?c(N=>N===0?1:0):(l(_),c(0)))};function w(_){g(_),a==null||a(_)}return e.jsxs("div",{className:"table",children:[u!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:h,onChange:_=>w(_.target.value),className:"table__filter__input"}),h&&e.jsx("span",{className:"table__filter__clear",onClick:()=>w(""),children:e.jsx(A,{icon:Qt})})]}),n!==void 0&&p?b.map(_=>e.jsx("div",{children:n(_)},i?i(_):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.map((_,N)=>e.jsx("th",{onClick:()=>v(N),className:_.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${_.align??"left"}`,children:[_.content,_.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(x=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${x===0?"asc":"desc"} ${d===N&&o===x?"table__sort__arrow--active":""}`,children:x===0?e.jsx(A,{icon:es}):e.jsx(A,{icon:ts})}))})]})},N))})}),e.jsx("tbody",{children:b.map(_=>{const N=s(_);return console.assert(N.length===t.length),e.jsx("tr",{children:N.map((x,S)=>e.jsx("td",{children:x},S))},i?i(_):void 0)})})]}),h&&b.length<r.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",b.length," of ",r.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{g(""),a==null||a("")},children:"[clear]"})]})]})}async function Ge(t){return await(await fetch(new URL("dashboard_state/api.json",import.meta.url))).json()}async function Xs(t){var s;const r=await Ge();return(s=r==null?void 0:r.patches)==null?void 0:s[t]}async function Et(){const t=await Ge();return t==null?void 0:t.available_patches}async function Us(){const t=await Ge();return t==null?void 0:t.collection_status}const at={not_collected:0,collected:1};function Ws(){const[t,r]=m.useState(null);if(m.useEffect(()=>{Us().then(a=>{r(a)})},[]),t===null)return null;if(!t.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const s=[...t].sortKey(a=>[at[a.status],a.status_reason,a.nodeid]),n=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[at[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(Z,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(Ye,{headers:n,data:s,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function Vs(){return e.jsx("h1",{children:"Page not found!"})}function Ks(t){const r=t.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:r.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:r.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}de.registerLanguage("diff",Ks);function Mt({nodeid:t}){const[r,s]=m.useState({}),[n,i]=m.useState(!0),[a,u]=m.useState(null),[d,l]=m.useState(!1),o=m.useRef(null);if(m.useEffect(()=>{Xs(t).then(v=>{v&&s(v),i(!1)})},[t]),m.useEffect(()=>{Nt(o,!0)},[r,a]),n)return e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading patches..."})});if(Object.values(r).every(v=>v===null))return e.jsx("div",{className:"card",children:e.jsx("p",{children:"No patches for this test"})});const c=new Map([["failing","Failing"],["covering","Covering"]]),h=a??Array.from(c.keys()).find(v=>r[v]),g=r[h],p=async()=>{await navigator.clipboard.writeText(g),l(!0),setTimeout(()=>{l(!1)},2e3)},b=()=>{const v=new Blob([g],{type:"text/plain"}),w=URL.createObjectURL(v),_=document.createElement("a");_.href=w,_.download=`${h}-${t.split("::").pop()}.patch`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(w)};return e.jsxs("div",{ref:o,children:[e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(se,{value:h,onChange:u,options:Array.from(c.entries()).filter(([v])=>r[v]).map(([v,w])=>({value:v,content:w}))})}),e.jsxs("pre",{className:"patch__pre",children:[e.jsxs("div",{className:"patch__controls",children:[e.jsx("div",{className:`patch__controls__control ${d?"patch__controls__control--success":""}`,onClick:p,title:"Copy patch",children:e.jsx(A,{icon:d?ss:ns})}),e.jsx("div",{className:"patch__controls__control",onClick:b,title:"Download patch",children:e.jsx(A,{icon:rs})})]}),e.jsx("code",{className:"language-diff",children:g})]})]})}function Hs(){const[t,r]=m.useState(null);return m.useEffect(()=>{Et().then(s=>{r(s)})},[]),t===null||t.length===0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No tests with patches present."})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Patches"}),t.map(s=>e.jsx(Ve,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:s}),e.jsxs(Z,{to:`/tests/${encodeURIComponent(s)}`,className:"patches__test__link",style:{marginLeft:"8px"},children:["View test ",e.jsx(A,{icon:is})]})]}),headerClass:"patches__test",defaultState:"closed",children:e.jsx(Mt,{nodeid:s})}))]})}function zs(t){return t>=1e6?`${Math.floor(t/1e6)}M`:t>=1e3?`${Math.floor(t/1e3)}k`:t>0?t.toLocaleString():"0"}function Ys(t){const r=[0];let s=1;for(;s<=t;)r.push(s),s*=10;return r}function ot({baseScale:t,orientation:r,tickCount:s=5,transform:n,isLogScale:i=!1,zoomTransform:a}){const u=m.useMemo(()=>{const g=t.domain(),p=t.range();let b;if(a){const _=r==="bottom",N=_?a.scaleX:1,x=_?a.x:a.y,S=p[0],j=p[p.length-1],E=t.invert((S-x)/N),C=t.invert((j-x)/N);b=[Math.min(E,C),Math.max(E,C)]}else b=[g[0],g[1]];let v;if(i)v=Ys(b[1]).filter(_=>_>=b[0]&&_<=b[1]);else{const _=i?De():le();_.domain(b).range(p),v=_.ticks(s)}return v.map(_=>{const N=t(_);let x=N;return a&&r==="bottom"&&(x=N*a.scaleX+a.x),{value:_,offset:x,formatted:i?zs(_):_.toLocaleString()}})},[t,s,i,a,r]),d=r==="bottom",[l,o,c,h]=d?[0,0,t.range()[1],0]:[0,0,0,t.range()[0]];return e.jsxs("g",{className:`axis axis--${r}`,transform:n,children:[e.jsx("line",{className:"domain",x1:l,y1:o,x2:c,y2:h,stroke:"currentColor",strokeWidth:1}),e.jsx("line",{className:"domain",x1:l,y1:o,x2:d?l:l-6,y2:d?o+6:o,stroke:"currentColor",strokeWidth:1}),e.jsx("line",{className:"domain",x1:c,y1:h,x2:d?c:c-6,y2:d?h+6:h,stroke:"currentColor",strokeWidth:1}),u.map((g,p)=>{const b=d?g.offset:0,v=d?0:g.offset,w=d?g.offset:-10,_=d?15:g.offset+4;return e.jsxs("g",{className:"tick",children:[e.jsx("line",{x1:b,y1:v,x2:b+(d?0:-6),y2:v+(d?6:0),stroke:"currentColor",strokeWidth:1}),e.jsx("text",{x:w,y:_,textAnchor:d?"middle":"end",fontSize:"12",fill:"currentColor",children:g.formatted})]},p)})]})}function Gs({lines:t,viewportXScale:r,viewportYScale:s,xValue:n,yValue:i,navigate:a}){const[u,d]=m.useState(null),l=m.useMemo(()=>{const o=ds().x(c=>r(n(c))).y(c=>s(i(c)));return t.map((c,h)=>({pathData:o(c.reports)||"",color:c.color,url:c.url,key:`line-${h}-${c.url||"no-url"}`}))},[t,r,s,n,i]);return e.jsx("g",{style:{pointerEvents:"auto"},children:l.map(o=>e.jsx("path",{d:o.pathData,fill:"none",stroke:o.color,className:`coverage-line ${u===o.key?"coverage-line__selected":""}`,style:{cursor:o.url?"pointer":"default"},onMouseEnter:()=>d(o.key),onMouseLeave:()=>d(null),onClick:c=>{o.url&&St(c,o.url,a)}},o.key))})}class ye{constructor(r,s,n,i,a){this.nodeid=r,this.linear_status_counts=s,this.linear_elapsed_time=n,this.behaviors=i,this.fingerprints=a}static fromReport(r,s){return new ye(r,s.status_counts,s.elapsed_time,s.behaviors,s.fingerprints)}}const ie=new Map;function z(t,r){const[s,n]=m.useState(()=>{const a=sessionStorage.getItem(t);return a===null?r:JSON.parse(a)});m.useEffect(()=>(ie.has(t)||ie.set(t,new Set),ie.get(t).add(n),()=>{ie.get(t).delete(n)}),[t]);function i(a){sessionStorage.setItem(t,JSON.stringify(a)),ie.get(t).forEach(u=>u(a))}return[s,i]}const Js={x:0,y:0,scaleX:1};function qs(t,r,s,n,i,a,u,d=Js,l){const o=m.useMemo(()=>({xValue:v=>n==="time"?v.linear_elapsed_time:v.linear_status_counts.sum(),yValue:v=>i==="behaviors"?v.behaviors:v.fingerprints}),[n,i]),c=m.useMemo(()=>{const p=(r==="log"?De():le()).domain([0,ce(t.map(v=>o.xValue(v)))||1]).range([0,a]),b=(s==="log"?De():le()).domain([0,ce(t.map(v=>o.yValue(v)))||0]).range([u,0]);return{xScale:p,yScale:b}},[t,r,s,a,u,o]),h=m.useMemo(()=>{if(!l)return d;let p={...d};if(l.xMin!==void 0||l.xMax!==void 0){const b=c.xScale.range(),v=b[0],w=b[1],_=c.xScale.invert((v-p.x)/p.scaleX),N=c.xScale.invert((w-p.x)/p.scaleX);l.xMin!==void 0&&_<l.xMin&&(p.x=v-c.xScale(l.xMin)*p.scaleX),l.xMax!==void 0&&N>l.xMax&&(p.x=w-c.xScale(l.xMax)*p.scaleX)}if(l.yMin!==void 0||l.yMax!==void 0){const b=c.yScale.range(),v=b[1],w=b[0];l.yMin!==void 0&&c.yScale.invert(w-p.y)<l.yMin&&(p.y=w-c.yScale(l.yMin)),l.yMax!==void 0&&c.yScale.invert(v-p.y)>l.yMax&&(p.y=v-c.yScale(l.yMax))}return p},[d,l,c]),g=m.useMemo(()=>{const p=c.xScale.range(),b=c.xScale.copy().range([p[0]*h.scaleX+h.x,p[1]*h.scaleX+h.x]),v=c.yScale.copy().range([c.yScale.range()[0]+h.y,c.yScale.range()[1]+h.y]);return{xScale:b,yScale:v}},[c,h]);return{...o,baseScales:c,viewportScales:g,constrainedTransform:h}}const lt={x:0,y:0,scaleX:1};function Zs({minScale:t=1,maxScale:r=50,wheelSensitivity:s=.0013}={}){const[n,i]=m.useState(lt),a=m.useRef(!1),u=m.useRef({x:0,y:0}),d=m.useRef(null),l=m.useRef(null),o=m.useRef(!1),c=m.useRef(0),h=m.useRef(null),g=m.useCallback(()=>{d.current&&(cancelAnimationFrame(d.current),d.current=null)},[]),p=m.useCallback(_=>{g(),i(_)},[g]),b=m.useCallback(()=>{g();const _=n,N=lt,x=500,S=performance.now(),j=Re(_.x,N.x),E=Re(_.y,N.y),C=Re(_.scaleX,N.scaleX),M=L=>{const $=L-S,B=Math.min($/x,1),f=1-Math.pow(1-B,3),y={x:j(f),y:E(f),scaleX:C(f)};i(y),B<1?d.current=requestAnimationFrame(M):d.current=null};d.current=requestAnimationFrame(M)},[n,g]);m.useEffect(()=>{const _=l.current;if(!_)return;const N=x=>{g();const S=_.getBoundingClientRect(),j=x.clientX-S.left;if(Math.abs(x.deltaX)>Math.abs(x.deltaY))return;const E=1-x.deltaY*s,C=Math.max(t,Math.min(r,n.scaleX*E)),M=C!==n.scaleX;if(M||o.current?(x.preventDefault(),x.stopPropagation()):c.current++,M){o.current=!0;const L=C/n.scaleX,f={x:j-(j-n.x)*L,y:n.y,scaleX:C};i(f)}c.current=0,h.current&&clearTimeout(h.current),h.current=window.setTimeout(()=>{c.current===0&&(o.current=!1),h.current=null},150)};return _.addEventListener("wheel",N,{passive:!1}),()=>{_.removeEventListener("wheel",N)}},[n,t,r,s,g]);const v=m.useCallback(_=>{if(_.button!==0)return;g(),a.current=!0,u.current={x:_.clientX,y:_.clientY};const N=S=>{if(!a.current)return;const j=S.clientX-u.current.x,E=S.clientY-u.current.y;i(C=>({x:C.x+j,y:C.y+E,scaleX:C.scaleX})),u.current={x:S.clientX,y:S.clientY}},x=()=>{a.current=!1,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",N),document.addEventListener("mouseup",x)},[g]),w=m.useCallback(_=>{_.preventDefault(),b()},[b]);return m.useEffect(()=>()=>{g(),h.current&&clearTimeout(h.current)},[g]),{transform:n,containerRef:l,onMouseDown:v,onDoubleClick:w,resetZoom:b,setTransform:p}}const Le=270,je={zoomIdentity:ps,select:gt,scaleLinear:le,scaleOrdinal:xt,interpolateViridis:fs,interpolateRgb:ms,schemeCategory10:hs},ct=je.scaleLinear().domain([0,1]).range(["rgb(255, 198, 128)","rgb(240, 136, 62)","rgb(219, 109, 40)","rgb(189, 86, 29)","rgb(155, 66, 21)","rgb(118, 45, 10)","rgb(90, 30, 2)"]).interpolate(je.interpolateRgb);var Pe=(t=>(t.TOGETHER="linearized",t.SEPARATE="individual",t.LATEST="latest",t))(Pe||{});function Qs(t,r){const s=t.linear_status_counts(r),n=t.linear_elapsed_time(r),i=[];for(let a=0;a<s.length;a++){const u=t.linear_reports[a];i.push({nodeid:t.nodeid,linear_status_counts:s[a],linear_elapsed_time:n[a],behaviors:u.behaviors,fingerprints:u.fingerprints})}return i}function At({value:t,onChange:r}){return e.jsx(se,{value:t,onChange:r,options:[{value:"log",content:"Log"},{value:"linear",content:"Linear"}]})}function en(){const[t,r]=z("graph_scale_x","log"),[s,n]=z("graph_axis_x","time");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--x",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(A,{icon:s==="inputs"?ve:be,style:{fontSize:"0.9rem"}}),s==="inputs"?"Inputs":"Time"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(At,{value:t,onChange:r}),e.jsx(se,{value:s,onChange:n,options:[{value:"inputs",content:e.jsx(A,{icon:ve})},{value:"time",content:e.jsx(A,{icon:be})}]})]})]})}function tn(){const[t,r]=z("graph_scale_y","linear"),[s,n]=z("graph_axis_y","behaviors");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--y",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem",zIndex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(At,{value:t,onChange:r}),e.jsx(se,{value:s,onChange:n,options:[{value:"behaviors",content:e.jsx(A,{icon:ge})},{value:"fingerprints",content:e.jsx(A,{icon:xe})}]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(A,{icon:s==="behaviors"?ge:xe,style:{fontSize:"0.9rem"}}),s==="behaviors"?"Behaviors":"Fingerprints"]})]})}const ut={linearized:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:$e})," Together"]}),mobileContent:e.jsx(A,{icon:$e})},individual:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:qe})," Separate"]}),mobileContent:e.jsx(A,{icon:qe})},latest:{content:e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:Je})," Latest"]}),mobileContent:e.jsx(A,{icon:Je})}};function sn({tests:t,filterString:r="",testsLoaded:s,workers_after:n=null,viewSetting:i}){const a=m.useRef(null),[u,d]=z("graph_scale_x","log"),[l,o]=z("graph_scale_y","linear"),[c,h]=z("graph_axis_x","time"),[g,p]=z("graph_axis_y","behaviors"),b=mt();We();const v=Se(),w=je.scaleOrdinal(je.schemeCategory10).domain(Array.from(t.keys())),_=m.useMemo(()=>{let f=[];if(i==="linearized")f=Array.from(t.entries()).sortKey(([y,k])=>y).map(([y,k])=>({url:`/tests/${encodeURIComponent(y)}`,reports:Qs(k,n),color:w(y)}));else if(i==="individual"){let y=function(O){if(k.length<=1)return ct(.5);const R=(O-T)/(D-T);return ct(R)};const k=[];for(const O of t.values())for(const R of O.reports_by_worker.values())R.length>0&&k.push(R[0].timestamp);const T=Rs(k)??0,D=ce(k)??0;for(const[O,R]of t.entries())for(const P of R.reports_by_worker.values())P.length>0&&f.push({url:`/tests/${encodeURIComponent(O)}`,reports:P.map(Y=>ye.fromReport(O,Y)),color:y(P[0].timestamp)})}else if(i==="latest")for(const[y,k]of t.entries()){const T=ce(Array.from(k.reports_by_worker.values()),D=>D[0].elapsed_time);T&&f.push({url:`/tests/${encodeURIComponent(y)}`,reports:T.map(D=>ye.fromReport(y,D)),color:w(y)})}return f},[t,n,i,w]),N=m.useMemo(()=>r?_.filter(f=>{var y;return(y=f.url)==null?void 0:y.toLowerCase().includes(r.toLowerCase())}):_,[_,r]),[x,S]=m.useState(800);m.useEffect(()=>{if(a.current){const f=new ResizeObserver(y=>{for(const k of y)S(k.contentRect.width)});return f.observe(a.current),()=>f.disconnect()}},[]);const j=m.useMemo(()=>{const f={top:5,right:5,bottom:25,left:40},y=(x||800)-f.left-f.right,k=Le-f.top-f.bottom;return{margin:f,width:y,height:k,totalWidth:y+f.left+f.right,totalHeight:k+f.top+f.bottom}},[x]),E=m.useMemo(()=>N.flatMap(f=>f.reports),[N]),C=Zs({minScale:1,maxScale:50}),M=qs(E,u,l,c,g,j.width,j.height,C.transform,{yMin:0}),L=10,$=m.useMemo(()=>_s().x(f=>M.viewportScales.xScale(M.xValue(f))).y(f=>M.viewportScales.yScale(M.yValue(f))).addAll(E),[E,M]),B=m.useMemo(()=>(f,y)=>$.find(f,y,L)||null,[$]);return e.jsx("div",{ref:f=>{a.current!==f&&(a.current=f),C.containerRef.current!==f&&(C.containerRef.current=f)},style:{position:"relative",width:"100%",height:`${Le}px`,userSelect:"none"},onMouseDown:C.onMouseDown,onDoubleClick:C.onDoubleClick,onMouseMove:f=>{const y=f.currentTarget.getBoundingClientRect(),k=f.clientX-y.left-j.margin.left,T=f.clientY-y.top-j.margin.top,D=B(k,T);if(D){const O=D.behaviors===1?"":"s",R=D.fingerprints===1?"":"s",P=D.linear_status_counts.sum()===1?"":"s",Y=D.linear_elapsed_time===1?"":"s",F=`
            <div style="font-weight: bold; margin-bottom: 4px;">${kt(D.nodeid)}</div>
            <div>${D.behaviors.toLocaleString()} behavior${O} / ${D.fingerprints.toLocaleString()} fingerprint${R}</div>
            <div>${D.linear_status_counts.sum().toLocaleString()} input${P} / ${D.linear_elapsed_time.toFixed(1)} second${Y}</div>
          `;v.showTooltip(F,f.clientX,f.clientY,"coverage-graph")}else v.hideTooltip("coverage-graph")},onMouseLeave:()=>{v.hideTooltip("coverage-graph")},children:e.jsxs("svg",{className:"coverage-graph__svg",style:{position:"absolute",top:0,left:0,width:"100%",height:`${Le}px`,pointerEvents:"none"},children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"clip-content",children:e.jsx("rect",{y:-2,width:j.width,height:j.height+4})})}),e.jsxs("g",{transform:`translate(${j.margin.left}, ${j.margin.top})`,children:[e.jsx("g",{clipPath:"url(#clip-content)",children:e.jsx(Gs,{lines:N,viewportXScale:M.viewportScales.xScale,viewportYScale:M.viewportScales.yScale,xValue:M.xValue,yValue:M.yValue,navigate:b})}),e.jsx(ot,{baseScale:M.baseScales.xScale,orientation:"bottom",transform:`translate(0, ${M.baseScales.yScale.range()[0]})`,isLogScale:u==="log",zoomTransform:M.constrainedTransform}),e.jsx(ot,{baseScale:M.baseScales.yScale,orientation:"left",isLogScale:l==="log",zoomTransform:M.constrainedTransform})]})]})})}function nn(){const t=["rgb(255, 198, 128)","rgb(240, 136, 62)","rgb(219, 109, 40)","rgb(189, 86, 29)","rgb(155, 66, 21)","rgb(118, 45, 10)","rgb(90, 30, 2)"];return e.jsxs("div",{className:"coverage-graph__color-legend",children:[e.jsx("span",{children:"Older"}),e.jsx("div",{style:{display:"flex",gap:"2px"},children:t.map((r,s)=>e.jsx("div",{className:"coverage-graph__color-legend__square",style:{backgroundColor:r}},s))}),e.jsx("span",{children:"Newer"})]})}function Tt({tests:t,filterString:r="",testsLoaded:s,workers_after:n=null,workerViews:i=["linearized","individual","latest"],workerViewSetting:a}){let[u,d]=z(a,"linearized");const o=X(Array.from(t.values()).flatMap(c=>Array.from(c.reports_by_worker.values()))).size==1;return o&&(u="linearized"),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Coverage"}),e.jsxs("div",{style:{display:"flex",justifyContent:u==="individual"?"space-between":"flex-end",alignItems:u==="individual"?"center":"default",marginBottom:"1rem"},children:[u==="individual"&&e.jsx(nn,{}),e.jsxs("span",{className:"tooltip",children:[e.jsx(se,{value:u,onChange:d,options:i.map(c=>({value:c,content:ut[c].content,mobileContent:ut[c].mobileContent})),disabled:o}),o&&e.jsx("span",{className:"tooltip__text",children:"Switching worker display mode requires multiple workers"})]})]}),e.jsx("div",{className:"coverage-graph__container",children:e.jsxs("div",{className:"coverage-graph__grid",style:{marginRight:"15px",flex:1,height:"auto"},children:[e.jsx(tn,{}),e.jsx(sn,{tests:t,testsLoaded:s,viewSetting:u,workers_after:n,filterString:r}),e.jsx("div",{}),e.jsx(en,{})]})})]})}const te={[I.FAILED_FATALLY]:"Failed fatally",[I.FAILED]:"Failed",[I.SHRINKING]:"Shrinking",[I.RUNNING]:"Running",[I.SKIPPED_DYNAMICALLY]:"Skipped dynamically",[I.WAITING]:"Waiting"};function Be({status:t}){return e.jsx("span",{style:{textAlign:"center"},children:t===I.FAILED_FATALLY?e.jsx("span",{className:"pill pill__failure",children:te[t]}):t===I.FAILED?e.jsx("span",{className:"pill pill__failure",children:te[t]}):t===I.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:te[t]}):t===I.RUNNING?e.jsx("span",{className:"pill pill__success",children:te[t]}):e.jsx("span",{className:"pill pill__neutral",children:te[t]})})}function J({content:t,tooltip:r}){return e.jsxs("span",{className:"tooltip tooltip--underline",children:[t,e.jsx("div",{className:"tooltip__text",children:r})]})}function Lt(t){const r=Math.floor(t/3600),s=Math.floor(t%3600/60),n=Math.floor(t%60);return`${r>0?`${r}:${s.toString().padStart(2,"0")}`:s}:${n.toString().padStart(2,"0")}`}function $t(t){const r=t.ninputs(null),s=t.elapsed_time(null);return s===0?null:r/s}function Oe(t){var s;if(t.linear_reports.length===0)return{inputs:"",behaviors:"",fingerprints:"",executions:"",inputsSinceBranch:"",timeSpent:""};const r=$t(t);return{inputs:t.ninputs(null).toLocaleString(),behaviors:t.behaviors.toLocaleString(),fingerprints:t.fingerprints.toLocaleString(),executions:r===null?"":`${r.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((s=t.since_new_behavior)==null?void 0:s.toLocaleString())??"",timeSpent:Lt(t.elapsed_time(null))}}de.registerLanguage("python",Ct);function rn({failure:t}){return e.jsx("span",{style:{textAlign:"center"},children:t.state==="shrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Fully shrunk"}):t.state==="unshrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Still shrinking..."}):e.jsx(e.Fragment,{})})}function an({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem",marginBottom:"1rem"},children:[e.jsx("div",{className:"failure__title",children:"Failure"}),e.jsx(rn,{failure:t})]}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("reproduction_decorator")+`
`+t.observation.representation})}),e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("traceback")})})]})]})}function on({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"failure__title",children:"Fatal failure"}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",style:{whiteSpace:"pre-wrap"},children:t})})]})]})}function ln(){const{nodeid:t}=Ot(),{tests:r,testsLoaded:s}=ze(t),n=m.useRef(null),[i,a]=m.useState(null);m.useEffect(()=>{Et().then(o=>{a(o)})},[]);const u=r.get(t)??null;if(m.useEffect(()=>{u&&Nt(n)},[u]),!t||!u)return e.jsx("div",{children:"Test not found"});const d=Oe(u),l=[{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:ve})}),tooltip:"Number of inputs"})},{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:ge})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:xe})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:pt})}),tooltip:"Inputs per second"})},{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:_t})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:be})}),tooltip:"Total time spent running"})}];return e.jsxs("div",{ref:n,children:[e.jsxs(Z,{to:"/",className:"back-link",children:[e.jsx(A,{icon:as})," All tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:t}),e.jsx(Be,{status:u.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(Ye,{headers:l,data:[d],row:o=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:o.timeSpent})]})})]}),e.jsx(Tt,{tests:new Map([[t,u]]),testsLoaded:s,workerViewSetting:"graph_worker_view_test"}),u.normalFailures.map(o=>e.jsx(an,{failure:o})),u.fatal_failure&&e.jsx(on,{failure:u.fatal_failure}),e.jsx(Is,{test:u}),(i==null?void 0:i.includes(t))&&e.jsx("div",{className:"card",children:e.jsx(Ve,{title:"Patches",defaultState:"closed",headerClass:"card__header",children:e.jsx(Mt,{nodeid:t})})})]})}function ee({icon:t,tooltip:r}){return e.jsx(J,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(A,{icon:t})}),tooltip:r})}function ae({icon:t,value:r}){return e.jsxs("div",{className:"table__inline-statistic",children:[t,e.jsx("span",{className:"table__inline-statistic__value",children:r})]})}function cn({tests:t,onFilterChange:r}){const s=Array.from(t).sortKey(([p,b])=>{const v=b.ninputs(null);return[b.status,v!=null?-v:-1,p]}).map(([p,b])=>b),n=e.jsx(ee,{icon:ve,tooltip:"Number of inputs"}),i=e.jsx(ee,{icon:ge,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(ee,{icon:xe,tooltip:"Number of fingerprints (sets of behaviors) found"}),u=e.jsx(ee,{icon:pt,tooltip:"Inputs per second"}),d=e.jsx(ee,{icon:_t,tooltip:"Number of inputs since a new behavior"}),l=e.jsx(ee,{icon:be,tooltip:"Total time spent running"}),o=[{content:"Test",sortKey:p=>p.nodeid},{content:"Status",sortKey:p=>p.status,align:"center"},{content:n,align:"right",sortKey:p=>p.ninputs(null)},{content:i,align:"right",sortKey:p=>p.behaviors},{content:a,align:"right",sortKey:p=>p.fingerprints},{content:u,align:"right",sortKey:p=>$t(p)??-1},{content:d,align:"right",sortKey:p=>p.since_new_behavior??0},{content:l,align:"right",sortKey:p=>p.elapsed_time(null)}],c=p=>{const b=Oe(p);return[e.jsx(Z,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(Be,{status:p.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:b.timeSpent})]};function h(p){const b=Oe(p);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(Z,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx(Be,{status:p.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(ae,{icon:n,value:b.inputs}),e.jsx(ae,{icon:i,value:b.behaviors}),e.jsx(ae,{icon:u,value:b.executions}),e.jsx(ae,{icon:d,value:b.inputsSinceBranch}),e.jsx(ae,{icon:l,value:b.timeSpent})]})]})}function g(p){return[p.nodeid,te[p.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(Ye,{headers:o,data:s,row:c,mobileRow:h,getKey:p=>p.database_key??void 0,filterStrings:g,onFilterChange:r})]})}function un(){const{tests:t,testsLoaded:r}=ze(),[s,n]=m.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx(Tt,{tests:t,filterString:s,testsLoaded:r,workerViews:[Pe.TOGETHER,Pe.LATEST],workerViewSetting:"graph_worker_view_tests"}),e.jsx(cn,{tests:t,onFilterChange:n})]})}function dn({min:t,max:r,value:s,onChange:n,step:i=1}){const[a,u]=m.useState(null),d=m.useRef(null);console.assert(t<=r,`min: ${t} max: ${r}`);const[l,o]=s,c=r-t,h=c===0?0:(l-t)/c*100,g=c===0?100:(o-t)/c*100,p=h<50?1:2,b=g<50?2:1,v=m.useCallback(S=>{if(!d.current)return t;const j=d.current.getBoundingClientRect(),E=Math.max(0,Math.min(100,(S-j.left)/j.width*100)),C=t+E/100*c,M=Math.round(C/i)*i;return Math.max(t,Math.min(r,M))},[t,r,c,i]),w=S=>j=>{j.preventDefault(),u(S)},_=m.useCallback(S=>{if(!a)return;const j=v(S.clientX);n(a==="min"?[Math.min(j,o),o]:[l,Math.max(j,l)])},[a,v,l,o,n]),N=m.useCallback(()=>{u(null)},[]),x=S=>{if(a)return;const j=v(S.clientX),E=Math.abs(j-l),C=Math.abs(j-o);E<C?n([Math.min(j,o),o]):n([l,Math.max(j,l)])};return m.useEffect(()=>a?(document.addEventListener("mousemove",_),document.addEventListener("mouseup",N),()=>{document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",N)}):()=>{},[a,_,N]),e.jsx("div",{className:"range-slider",children:e.jsx("div",{className:"range-slider__container",children:e.jsxs("div",{ref:d,className:"range-slider__track",onClick:x,children:[e.jsx("div",{className:"range-slider__range",style:{left:`${h}%`,width:`${g-h}%`}}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--min",style:{left:`${h}%`,zIndex:p},onMouseDown:w("min")}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--max",style:{left:`${g}%`,zIndex:b},onMouseDown:w("max")})]})})})}let hn=class{constructor(r,s){this.uuid=r,this.segments=s}visibleSegments(r){return this.segments.filter(s=>s.end>=r[0]&&s.start<=r[1])}};function we(t){return new Date(t*1e3).toLocaleString()}const mn=24*60*60;function dt(t,r){return[Math.max(t,r-mn),r]}function fn(t){let r=0;for(let a=0;a<t.length;a++)r=(r<<5)-r+t.charCodeAt(a)&4294967295;const s=Math.abs(r)%360,n=45+Math.abs(r>>8)%30,i=45+Math.abs(r>>16)%20;return`hsl(${s}, ${n}%, ${i}%)`}function fe({label:t,value:r}){return e.jsxs("div",{className:"workers__worker__details__item",children:[e.jsx("span",{className:"workers__worker__details__label",children:t}),e.jsx("span",{className:"workers__worker__details__value",children:r})]})}const pn=Ue.memo(({worker:t,range:r,expandedWorkers:s,onWorkerClick:n,segmentStyle:i,navigate:a,showTooltip:u,hideTooltip:d,moveTooltip:l})=>e.jsxs("div",{className:`workers__worker ${s.has(t.uuid)?"workers__worker--expanded":""}`,onClick:()=>n(t.uuid),onMouseLeave:()=>d("workers"),children:[e.jsx("div",{className:"workers__worker__bar",onMouseLeave:()=>d("workers"),children:t.visibleSegments(r).map((o,c)=>e.jsx("div",{className:"workers__timeline__segment",style:i(o),onClick:h=>{St(h,`/tests/${encodeURIComponent(o.nodeid)}`,a),h.stopPropagation()},onMouseEnter:h=>u(kt(o.nodeid),h.clientX,h.clientY,"workers"),onMouseLeave:()=>d("workers"),onMouseMove:h=>l(h.clientX,h.clientY,"workers")},c))}),s.has(t.uuid)&&e.jsx(_n,{worker:t})]},t.uuid)),_n=Ue.memo(({worker:t})=>e.jsx("div",{className:"workers__worker__details",children:e.jsxs("div",{className:"workers__worker__details__grid",children:[e.jsx(fe,{label:"Worker UUID",value:t.uuid}),e.jsx(fe,{label:"Lifetime",value:Lt(t.segments[t.segments.length-1].end-t.segments[0].start)}),e.jsx(fe,{label:"Started",value:we(t.segments[0].start)}),e.jsx(fe,{label:"Last seen",value:we(t.segments[t.segments.length-1].end)})]})}));function gn(){const{tests:t}=ze(),r=mt(),{showTooltip:s,hideTooltip:n,moveTooltip:i}=Se(),[a,u]=m.useState(new Set),d=os(Array.from(t.values()).map(x=>Array.from(x.reports_by_worker.keys())).flat().sortKey(x=>x)),l=new Map;d.forEach(x=>{const S=[];l.set(x,S),Array.from(t.values()).forEach(j=>{if(!j.reports_by_worker.has(x))return;const E=j.reports_by_worker.get(x);S.push(...E.map(C=>({timestamp_monotonic:C.timestamp_monotonic,nodeid:j.nodeid})))}),S.sortKey(j=>j.timestamp_monotonic)});let o=1/0,c=-1/0,h=[];d.forEach(x=>{const S=l.get(x),j=[];let E=null;S.forEach((C,M)=>{o=Math.min(o,C.timestamp_monotonic),c=Math.max(c,C.timestamp_monotonic),!E||E.nodeid!==C.nodeid?(E&&j.push(E),E={nodeid:C.nodeid,start:C.timestamp_monotonic,end:C.timestamp_monotonic}):E.end=C.timestamp_monotonic,M===S.length-1&&E&&j.push(E)}),h.push(new hn(x,j))}),h.sortKey(x=>x.segments[0].start);const[g,p]=m.useState(dt(o,c));m.useEffect(()=>{p(dt(o,c))},[o,c]);const[b,v]=g,w=v-b,_=m.useCallback(x=>{let S,j;return w===0?(S=0,j=100):(S=(x.start-b)/w*100,j=(x.end-x.start)/w*100),{left:`${S}%`,width:`${j}%`,backgroundColor:fn(x.nodeid)}},[w,b]),N=m.useCallback(x=>{u(S=>{const j=new Set(S);return j.has(x)?j.delete(x):j.add(x),j})},[]);return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Workers "}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"card__text",children:[e.jsx("div",{className:"card__text__paragraph",children:"This page shows the history of your workers, and what tests they have been fuzzing."}),e.jsx("div",{className:"card__text__paragraph",children:'Roughly speaking, "one worker" = "one CPU core".'})]}),e.jsxs("div",{className:"workers",children:[e.jsx("div",{className:"workers__controls",children:e.jsx(dn,{min:o,max:c,value:g,onChange:x=>p(x),step:(c-o)/1e3})}),e.jsxs("div",{className:"workers__timeline-header",children:[e.jsx("span",{className:"workers__timeline-header__label",children:we(b)}),e.jsx("span",{className:"workers__timeline-header__label",children:we(v)})]}),h.map(x=>x.visibleSegments(g).length>0&&e.jsx(pn,{worker:x,range:g,expandedWorkers:a,onWorkerClick:N,segmentStyle:_,navigate:r,showTooltip:s,hideTooltip:n,moveTooltip:i},x.uuid))]})]})]})}function xn(){const t=Xt;return e.jsx(t,{children:e.jsx(js,{children:e.jsx(Bs,{children:e.jsx(ks,{children:e.jsx(Ut,{children:e.jsxs(G,{element:e.jsx(Os,{}),children:[e.jsx(G,{path:"/",element:e.jsx(un,{})}),e.jsx(G,{path:"/patches",element:e.jsx(Hs,{})}),e.jsx(G,{path:"/collected",element:e.jsx(Ws,{})}),e.jsx(G,{path:"/workers",element:e.jsx(gn,{})}),e.jsx(G,{path:"/tests/:nodeid",element:e.jsx(ln,{})}),e.jsx(G,{path:"*",element:e.jsx(Vs,{})})]})})})})})})}bs.createRoot(document.getElementById("app")).render(e.jsx(Ue.StrictMode,{children:e.jsx(xn,{})}));
