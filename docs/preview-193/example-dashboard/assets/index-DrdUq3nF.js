var Pt=Object.defineProperty;var Dt=(t,n,s)=>n in t?Pt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s;var T=(t,n,s)=>Dt(t,typeof n!="symbol"?n+"":n,s);import{r as Bt,g as ot,a as h,u as Fe,b as zt,L as ee,O as Ot,c as lt,d as Vt,H as Ut,e as Wt,f as J,R as Ht}from"./react-DOgvK_Td.js";import{F as M,f as ct,S as V,r as Kt,a as Xt,b as Yt,c as Gt,d as qt,L as te,e as Jt,g as Qt,h as Zt,i as es,j as ts,k as ss,l as ns,m as rs,n as Xe,o as Ye,p as Ge,q as ve,s as be,t as ye,u as je,v as is,w as ut,x as dt,O as as}from"./vendor-BAVV2UnT.js";import{d as Pe,a as ht,b as mt,c as os,o as De,l as ft,s as ls,q as cs,e as pt,f as _t,g as us,h as ds,i as hs,j as gt,k as xt}from"./d3-BdqqTklI.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var Ae={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qe;function ms(){if(qe)return ie;qe=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function s(r,i,a){var o=null;if(a!==void 0&&(o=""+a),i.key!==void 0&&(o=""+i.key),"key"in i){a={};for(var u in i)u!=="key"&&(a[u]=i[u])}else a=i;return i=a.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:a}}return ie.Fragment=n,ie.jsx=s,ie.jsxs=s,ie}var Je;function fs(){return Je||(Je=1,Ae.exports=ms()),Ae.exports}var e=fs();Array.prototype.sortKey||(Array.prototype.sortKey=function(t){return this.sort((n,s)=>{const r=t(n),i=t(s);if(Array.isArray(r)&&Array.isArray(i)){for(let a=0;a<Math.min(r.length,i.length);a++){if(r[a]<i[a])return-1;if(r[a]>i[a])return 1}return 0}return r<i?-1:r>i?1:0})});var ps=Bt();const _s=ot(ps);function gs({message:t,onDismiss:n,isVisible:s}){const[r,i]=h.useState(s);return h.useEffect(()=>{if(s){i(!0);return}else{const a=setTimeout(()=>{i(!1)},300);return()=>clearTimeout(a)}},[s]),r?e.jsxs("div",{className:`notification ${s?"notification--visible":"notification--hidden"}`,onClick:n,children:[e.jsx("div",{className:"notification__content",children:t}),e.jsx("button",{className:"notification__close",onClick:a=>{a.stopPropagation(),n()},"aria-label":"Close notification",children:e.jsx(M,{icon:ct})})]}):null}const vt=h.createContext(null);function xs({children:t}){const[n,s]=h.useState([]),r=h.useRef(new Map),i=h.useRef(0),a=h.useCallback(c=>{clearTimeout(r.current.get(c)),r.current.delete(c),s(l=>l.filter(m=>m.id!==c))},[]),o=h.useCallback((c,l)=>{const m=++i.current,d={id:m,message:c,duration:l};if(s(v=>[...v,d]),l!==null){const v=setTimeout(()=>{a(m)},l);r.current.set(m,v)}return m},[a]),u=h.useCallback((c,l,m)=>{if(s(d=>d.map(v=>v.id===c?{...v,message:l,duration:m}:v)),m!==null){clearTimeout(r.current.get(c));const d=setTimeout(()=>{a(c)},m);r.current.set(c,d)}},[a]);return e.jsxs(vt.Provider,{value:{addNotification:o,updateNotification:u,dismissNotification:a},children:[t,e.jsx("div",{className:"notifications",children:n.map((c,l)=>e.jsx("div",{className:"notification-wrapper",style:{top:`${20+l*80}px`},children:e.jsx(gs,{message:c.message,isVisible:!0,onDismiss:()=>a(c.id)})},c.id))})]})}function vs(){const t=h.useContext(vt);if(!t)throw new Error("useNotification must be used within a NotificationProvider");return t}function Be(){const[t,n]=h.useState(!1);return h.useEffect(()=>{function s(){n(window.matchMedia("(max-width: 768px)").matches)}return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),t}function re({value:t,onChange:n,options:s}){const r=Be();return console.assert(V(s.map(i=>i.value)).size===s.length),e.jsx("div",{className:"scale-toggle",children:s.map(i=>e.jsx("button",{className:`scale-toggle__button${t===i.value?" scale-toggle__button--active":""}`,onClick:()=>{if(s.length==2&&t===i.value){const a=s.find(o=>o.value!==i.value).value;n(a)}else n(i.value)},children:r?i.mobileContent??i.content:i.content},String(i.value)))})}class bt{constructor(n,s,r,i){T(this,"createdAt");this.name=n,this.predicate=s,this.component=r,this.extraData=i,this.createdAt=Date.now()}}const yt=h.createContext(void 0);function bs({children:t}){const[n,s]=h.useState(new Map([["covering",new Map],["rolling",new Map]])),[r,i]=h.useState("covering"),a=n.get(r)||new Map,o=l=>{s(m=>{const d=new Map(m);return d.set(r,l),d})},c={filters:a,setFilters:o,removeFilter:(l,m)=>{const d=new Map(a),p=(d.get(l)||[]).filter(_=>_.name!==m);p.length===0?d.delete(l):d.set(l,p),o(d)},observationCategory:r,setObservationCategory:i};return e.jsx(yt.Provider,{value:c,children:t})}function Ne(){const t=h.useContext(yt);if(t===void 0)throw new Error("useFilters must be used within a FilterProvider");return t}const jt=h.createContext(null);function ys({state:t}){return t.visible?zt.createPortal(e.jsx("div",{className:"cursor-tooltip",style:{position:"fixed",left:`${t.x+10}px`,top:`${t.y-28}px`,display:"block",pointerEvents:"none",zIndex:9999},dangerouslySetInnerHTML:{__html:t.content}}),document.body):null}function js({children:t}){const n=Fe(),[s,r]=h.useState({visible:!1,content:"",x:0,y:0,owner:null});h.useEffect(()=>{r(c=>({...c,visible:!1,owner:null}))},[n.pathname]);const i=h.useCallback((c,l,m,d)=>{r({visible:!0,content:c,x:l,y:m,owner:d})},[]),a=h.useCallback(c=>{r(l=>l.owner===c?{...l,visible:!1,owner:null}:l)},[]),o=h.useCallback((c,l,m)=>{r(d=>d.visible&&d.owner===m&&(d.x!==c||d.y!==l)?{...d,x:c,y:l}:d)},[]),u=h.useMemo(()=>({showTooltip:i,hideTooltip:a,moveTooltip:o,visible:s.visible}),[i,a,o,s.visible]);return e.jsxs(jt.Provider,{value:u,children:[t,e.jsx(ys,{state:s})]})}function ze(){const t=h.useContext(jt);if(!t)throw new Error("useTooltip must be used within a TooltipProvider");return t}var ws=Kt();const he=ot(ws);function wt(t,n=0){return Array.from(t).reduce((s,r)=>s+r,n)}function Nt(t,n=!1){t.current&&(n&&t.current.querySelectorAll("code").forEach(s=>{s.removeAttribute("data-highlighted")}),t.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(s=>{he.highlightElement(s)}))}function ue(t,n){if(n){let s=null,r=null;for(let i=0;i<t.length;i++){const a=t[i],o=n(a);o!=null&&(r===null||o>r)&&(r=o,s=a)}return s}else{let s=null;for(let r=0;r<t.length;r++){const i=t[r];i!=null&&(s===null||i>s)&&(s=i)}return s}}function Ns(t,n){{let s=null;for(let r=0;r<t.length;r++){const i=t[r];i!=null&&(s===null||i<s)&&(s=i)}return s}}function Re(t,n,s){let r=0,i=t.length;for(;r<i;){const a=r+i>>>1;(s?s(t[a])<=n:t[a]<=n)?r=a+1:i=a}return r}let ae=null;function Ss(){return ae||(ae=document.createElement("div"),ae.style.cssText=`
      position: absolute;
      visibility: hidden;
      white-space: nowrap;
      top: -9999px;
      left: -9999px;
      pointer-events: none;
      z-index: -1;
    `,document.body.appendChild(ae)),ae}function Ee(t,n=""){const s=Ss();s.className=n,s.textContent=t;const r=s.getBoundingClientRect();return{width:r.width,height:r.height}}function St(t,n,s){if(t.metaKey||t.ctrlKey){const r=window.location,i=`${r.origin}${r.pathname}#${n}`;console.log(r.origin,r.pathname,n,i),window.open(i,"_blank")}else s(n)}function kt(t){return t.split("::").pop()||t}const G={select:Pe,scaleLinear:ft,scaleOrdinal:De,scaleBand:os,axisBottom:mt,axisLeft:ht},Qe=5,Y=2.5;function ks({feature:t,observations:n}){const s=h.useRef(null),r=h.useRef(null),{filters:i,setFilters:a}=Ne(),{showTooltip:o,hideTooltip:u,moveTooltip:c}=ze(),l=i.get(t)||[],m=h.useMemo(()=>{if(l.length===0)return V();console.assert(l.length===1);const p=l[0];return V(p.extraData.selectedValues)},[l]),d=h.useMemo(()=>({raw:n.raw.filter(p=>p.status!=="gave_up"),filtered:n.filtered.filter(p=>p.status!=="gave_up")}),[n]),v=p=>{let _=V();m.equals(V([p]))?_=V():_=V([p]);let w;_.size===1?w=_.first():w=_.map(A=>`${A}`).join(" or ");const N=[];_.size>0&&N.push(new bt(w,A=>_.some(E=>A.features.get(t)===E),t,{selectedValues:_}));const f=new Map(i);f.set(t,N),a(f)};return h.useEffect(()=>{const p=V(d.raw.map(j=>j.features.get(t)));let _=new Map;for(const j of d.filtered){const g=j.features.get(t);_.set(g,(_.get(g)||0)+1)}const w=wt(Array.from(_.values()));_=new Map([..._.entries()].sortKey(([j,g])=>j===ge?0:j===xe?1:j)),G.select(r.current).selectAll("*").remove();const N=s.current.clientWidth,f=p.size<Qe?85:170,A=G.select(r.current).attr("width",N).attr("height",f).append("g"),E=function(j,g){const[L,R]=g;o(`${t}<br>${L}: ${R}`,j.clientX,j.clientY,"tyche-nominal")};if(p.size<Qe){const j={top:0,right:15,bottom:20,left:15},g=N-j.left-j.right,L=f-j.top-j.bottom,R=G.scaleLinear().domain([0,1]).range([0,g]);let $;_.has(ge)||_.has(xe)?$=U=>U===ge?W.SUCCESS:U===xe?W.ERROR:W.PRIMARY:$=G.scaleOrdinal().domain(Array.from(_.keys())).range([W.PRIMARY,W.ACCENT,W.ACCENT2,W.ACCENT3,W.ACCENT4]);const C=A.append("g").attr("transform",`translate(${j.left},${j.top})`);let I=0;const F=L-j.bottom;_.forEach((U,x)=>{const b=U/w*g,y=m.has(x);C.append("rect").attr("x",I).attr("y",0).attr("width",b).attr("height",F).attr("fill",$(x)).style("cursor","pointer").on("click",()=>v(x)).on("mouseover",S=>{E(S,[x,U])}).on("mousemove",S=>c(S.clientX,S.clientY,"tyche-nominal")).on("mouseleave",()=>u("tyche-nominal")),y&&C.append("rect").attr("x",I+Y).attr("y",Y).attr("width",b-2*Y).attr("height",F-2*Y).attr("fill",$(x)).attr("stroke","white").attr("stroke-width",Y).style("pointer-events","none"),C.append("text").attr("x",I+b/2).attr("y",F/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","white").text(x).style("font-size","12px"),I+=b}),C.append("g").attr("transform",`translate(0,${F})`).call(G.axisBottom(R).tickFormat(U=>`${Math.round(Number(U)*100)}%`)),C.append("text").attr("x",g/2).attr("y",F+30).attr("text-anchor","middle").text("% of observations").style("font-size","12px")}else{const j={top:5,right:5,bottom:30,left:30},g=N-j.left-j.right,L=f-j.top-j.bottom,R=G.scaleBand().domain(Array.from(_.keys())).range([0,g]).padding(.2),$=G.scaleLinear().domain([0,ue(Array.from(_.values()))||0]).range([L,0]),C=A.append("g").attr("transform",`translate(${j.left},${j.top})`);C.selectAll(".bar").data(Array.from(_.entries())).enter().append("rect").attr("class","bar").attr("x",([I,F])=>R(I)||0).attr("y",([I,F])=>$(F)).attr("width",R.bandwidth()).attr("height",([I,F])=>L-$(F)).attr("fill",W.PRIMARY).style("cursor","pointer").on("click",function(I,[F,U]){v(F)}).on("mouseover",function(I,F){E(I,F)}).on("mousemove",I=>c(I.clientX,I.clientY,"tyche-nominal")).on("mouseleave",()=>u("tyche-nominal")),C.selectAll(".inner-bar").data(Array.from(_.entries()).filter(([I,F])=>m.has(I))).enter().append("rect").attr("class","inner-bar").attr("x",([I,F])=>(R(I)||0)+Y).attr("y",([I,F])=>$(F)+Y).attr("width",R.bandwidth()-2*Y).attr("height",([I,F])=>L-$(F)-2*Y).attr("fill",W.PRIMARY).attr("stroke","white").attr("stroke-width",Y).style("pointer-events","none"),C.append("g").attr("transform",`translate(0,${L})`).call(G.axisBottom(R)).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),C.append("g").call(G.axisLeft($).ticks(7).tickFormat(I=>Math.round(Number(I)).toString())),C.append("text").attr("transform","rotate(-90)").attr("y",-30).attr("x",-L/2).attr("text-anchor","middle").text("Count").style("font-size","12px")}},[d]),e.jsxs("div",{children:[e.jsx("div",{className:"tyche__nominal__feature",children:t}),e.jsx("div",{ref:s,className:"tyche__nominal__chart",children:e.jsx("svg",{ref:r,style:{width:"100%"}})})]})}function Oe({title:t,children:n,defaultState:s="open",onStateChange:r,headerClass:i="",contentClass:a=""}){const[o,u]=h.useState(s),c=()=>{const l=o==="open"?"closed":"open";u(l),r==null||r(l)};return e.jsxs("div",{children:[e.jsxs("div",{className:`collapsible__header ${i}`,onClick:c,children:[e.jsx("span",{className:"collapsible__toggle",children:o==="open"?e.jsx(M,{icon:Xt}):e.jsx(M,{icon:Yt})}),t]}),o==="open"&&e.jsx("div",{className:`${a}`,children:n})]})}function Ve({title:t,children:n,defaultState:s="open",onStateChange:r}){return e.jsx("div",{className:"tyche__section",children:e.jsx(Oe,{title:t,defaultState:s,onStateChange:r,headerClass:"tyche__section__header",contentClass:"tyche__section__content",children:n})})}function As({observations:t}){const n=new Set;return t.raw.forEach(s=>{for(const r of s.features.keys())r.startsWith("Retried draw from")||n.add(r)}),n.size===0?null:e.jsx(Ve,{title:"Features",children:Array.from(n).sort().map(s=>e.jsx(ks,{feature:s,observations:t}))})}function Rs(){const{filters:t,removeFilter:n}=Ne(),s=Array.from(t.values()).flat().sortKey(r=>r.createdAt);return s.length===0?null:e.jsxs("div",{className:"tyche__filters",children:[e.jsx("div",{className:"tyche__filters__title",children:"Current Filters"}),s.map(r=>e.jsxs("div",{className:"tyche__filters__filter",children:[e.jsxs("div",{className:"tyche__filters__filter__component",children:[e.jsx("div",{className:"tyche__filters__filter__remove",onClick:()=>n(r.component,r.name),children:e.jsx(M,{icon:ct})}),r.component]}),e.jsx("div",{className:"tyche__filters__filter__name",children:r.name})]},`${r.component}-${r.name}`))]})}function At(t){const n=t.regex,s=new RegExp("[\\p{XID_Start}_]\\p{XID_Continue}*","u"),r=["and","as","assert","async","await","break","case","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","in","is","lambda","match","nonlocal|10","not","or","pass","raise","return","try","while","with","yield"],u={$pattern:/[A-Za-z]\w+|__\w+__/,keyword:r,built_in:["__import__","abs","all","any","ascii","bin","bool","breakpoint","bytearray","bytes","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","exec","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip"],literal:["__debug__","Ellipsis","False","None","NotImplemented","True"],type:["Any","Callable","Coroutine","Dict","List","Literal","Generic","Optional","Sequence","Set","Tuple","Type","Union"]},c={className:"meta",begin:/^(>>>|\.\.\.) /},l={className:"subst",begin:/\{/,end:/\}/,keywords:u,illegal:/#/},m={begin:/\{\{/,relevance:0},d={className:"string",contains:[t.BACKSLASH_ESCAPE],variants:[{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,c],relevance:10},{begin:/([uU]|[bB]|[rR]|[bB][rR]|[rR][bB])?"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,c],relevance:10},{begin:/([fF][rR]|[rR][fF]|[fF])'''/,end:/'''/,contains:[t.BACKSLASH_ESCAPE,c,m,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"""/,end:/"""/,contains:[t.BACKSLASH_ESCAPE,c,m,l]},{begin:/([uU]|[rR])'/,end:/'/,relevance:10},{begin:/([uU]|[rR])"/,end:/"/,relevance:10},{begin:/([bB]|[bB][rR]|[rR][bB])'/,end:/'/},{begin:/([bB]|[bB][rR]|[rR][bB])"/,end:/"/},{begin:/([fF][rR]|[rR][fF]|[fF])'/,end:/'/,contains:[t.BACKSLASH_ESCAPE,m,l]},{begin:/([fF][rR]|[rR][fF]|[fF])"/,end:/"/,contains:[t.BACKSLASH_ESCAPE,m,l]},t.APOS_STRING_MODE,t.QUOTE_STRING_MODE]},v="[0-9](_?[0-9])*",p=`(\\b(${v}))?\\.(${v})|\\b(${v})\\.`,_=`\\b|${r.join("|")}`,w={className:"number",relevance:0,variants:[{begin:`(\\b(${v})|(${p}))[eE][+-]?(${v})[jJ]?(?=${_})`},{begin:`(${p})[jJ]?`},{begin:`\\b([1-9](_?[0-9])*|0+(_?0)*)[lLjJ]?(?=${_})`},{begin:`\\b0[bB](_?[01])+[lL]?(?=${_})`},{begin:`\\b0[oO](_?[0-7])+[lL]?(?=${_})`},{begin:`\\b0[xX](_?[0-9a-fA-F])+[lL]?(?=${_})`},{begin:`\\b(${v})[jJ](?=${_})`}]},N={className:"comment",begin:n.lookahead(/# type:/),end:/$/,keywords:u,contains:[{begin:/# type:/},{begin:/#/,end:/\b\B/,endsWithParent:!0}]},f={className:"params",variants:[{className:"",begin:/\(\s*\)/,skip:!0},{begin:/\(/,end:/\)/,excludeBegin:!0,excludeEnd:!0,keywords:u,contains:["self",c,w,d,t.HASH_COMMENT_MODE]}]};return l.contains=[d,w,c],{name:"Python",aliases:["py","gyp","ipython"],unicodeRegex:!0,keywords:u,illegal:/(<\/|\?)|=>/,contains:[c,w,{scope:"variable.language",match:/\bself\b/},{beginKeywords:"if",relevance:0},{match:/\bor\b/,scope:"keyword"},d,N,t.HASH_COMMENT_MODE,{match:[/\bdef/,/\s+/,s],scope:{1:"keyword",3:"title.function"},contains:[f]},{variants:[{match:[/\bclass/,/\s+/,s,/\s*/,/\(\s*/,s,/\s*\)/]},{match:[/\bclass/,/\s+/,s]}],scope:{1:"keyword",3:"title.class",6:"title.class.inherited"}},{className:"meta",begin:/^[\t ]*@/,end:/(?=#)|$/,contains:[w,f,d]}]}}function Ze({currentPage:t,pageCount:n,onPageChange:s}){console.assert(n>1);function r(){return n<=7?Array.from({length:n},(c,l)=>l):t<=3?[0,1,2,3,4,"ellipsis",n-1]:t>=n-4?[0,"ellipsis",n-5,n-4,n-3,n-2,n-1]:[0,"ellipsis",t-1,t,t+1,"ellipsis",n-1]}const i=r();function a(c){typeof c=="number"&&t!==c&&s(c)}function o(){t>0&&s(t-1)}function u(){t<n-1&&s(t+1)}return e.jsxs("div",{className:"pagination",children:[e.jsx("div",{className:`pagination__nav pagination__nav--left ${t===0?"pagination__nav--disabled":""}`,onClick:o,children:e.jsx(M,{icon:Gt})}),i.map((c,l)=>{if(c==="ellipsis")return e.jsx("div",{className:" pagination__ellipsis",children:"..."},`ellipsis-${l}`);const m=c===t;return e.jsx("div",{className:`pagination__number ${m?"pagination__number--current":""}`,onClick:()=>a(c),children:c+1},c)}),e.jsx("div",{className:`pagination__nav pagination__nav--right ${t===n-1?"pagination__nav--disabled":""}`,onClick:u,children:e.jsx(M,{icon:qt})})]})}he.registerLanguage("python",At);const Ce=30;function Es({observations:t,observationCategory:n}){const s=h.useRef(null),[r,i]=h.useState(0);h.useEffect(()=>{i(0)},[n]);function a(){s.current&&s.current.querySelectorAll("code:not([data-highlighted='yes'])").forEach(l=>{he.highlightElement(l)})}h.useEffect(()=>{a()},[t,r]);const o=new Map;t.filtered.forEach(l=>{const m=l.representation;o.set(m,(o.get(m)||0)+1)});const u=Math.ceil(o.size/Ce),c=Array.from(o.entries()).sortKey(([l,m])=>-m).slice(r*Ce,(r+1)*Ce);return e.jsx(Ve,{title:"Textual representation",defaultState:"closed",onStateChange:l=>{l==="open"&&requestAnimationFrame(()=>{a()})},children:e.jsxs("div",{ref:s,children:[u>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"12px"},children:e.jsx(Ze,{currentPage:r,pageCount:u,onPageChange:i})}),c.map(([l,m])=>e.jsxs("div",{style:{position:"relative"},className:"tyche__representation__example",children:[e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:l})}),m>1&&e.jsxs("div",{className:"tyche__representation__example__count",children:["x ",m]})]},l)),u>1&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"12px"},children:e.jsx(Ze,{currentPage:r,pageCount:u,onPageChange:i})})]})})}const et=640;function Cs({name:t,observations:n,verticalAxis:s,horizontalAxis:r,cssStyle:i=(a,o)=>({})}){const{filters:a,setFilters:o}=Ne(),{showTooltip:u,hideTooltip:c,moveTooltip:l}=ze(),m=a.get(t)||[],d=h.useMemo(()=>{if(m.length===0)return V();console.assert(m.length===1);const x=m[0];return V(x.extraData.selectedCells)},[m]),v=[],p=Array(s.length).fill(0),_=Array(r.length).fill(0);let w=0;for(let x=0;x<s.length;x++){v[x]=[];for(let b=0;b<r.length;b++)v[x][b]={count:0,widthPercent:0}}n.filtered.forEach(x=>{for(let b=0;b<s.length;b++){const[,y]=s[b];if(y(x)){for(let S=0;S<r.length;S++){const[,P]=r[S];if(P(x)){v[b][S].count++,p[b]++,_[S]++,w++;break}}break}}});const N=p.map((x,b)=>x>0?b:null).filter(x=>x!==null),f=_.map((x,b)=>x>0?b:null).filter(x=>x!==null),A=(x,b)=>{let y=V();if(x!==null&&b!==null){const k=te([x,b]);d.equals(V([k]))?y=V():y=V([k])}else x!==null?(console.assert(b===null),f.forEach(k=>{v[x][k].count>0&&(y=y.add(te([x,k])))})):b!==null&&(console.assert(x===null),N.forEach(k=>{v[k][b].count>0&&(y=y.add(te([k,b])))}));function S(){if(y.size===0)return"";let k=y;const z=[],K=[...N.map(D=>({name:s[D][0],cells:f.filter(O=>v[D][O].count>0).map(O=>te([D,O]))})),...f.map(D=>({name:r[D][0],cells:N.filter(O=>v[O][D].count>0).map(O=>te([O,D]))}))];for(const D of K)D.cells.length>0&&D.cells.every(O=>k.has(O))&&(z.push(D.name),k=k.subtract(V(D.cells)));for(;k.size>0;){const D=k.first(),[O,ke]=D.toArray();z.push(`${s[O][0]}+${r[ke][0]}`),k=k.delete(D)}return console.assert(k.size==0),z.join(" or ")}const P=[];y.size>0&&P.push(new bt(S(),k=>y.some(z=>{const[K,D]=z.toArray(),O=s[K][1],ke=r[D][1];return O(k)&&ke(k)}),t,{selectedCells:y}));const H=new Map(a);H.set(t,P),o(H)};if(N.length===0||f.length===0)return e.jsx("div",{children:"No observations"});const E=30,j=30,g=45*N.length;for(let x=0;x<s.length;x++)for(let b=0;b<r.length;b++)v[x][b].widthPercent=p[x]>0?v[x][b].count/p[x]*100:0;const R=N.map(x=>p[x]/w*g).map(x=>Math.max(x,j)),$=f.map((x,b)=>b===0?0:b===f.length-1?100:b/(f.length-1)*100),{rowHeaderWidth:C,columnHeaderHeight:I,rowTotalWidth:F}=h.useMemo(()=>({rowHeaderWidth:Math.max(...N.map(x=>Ee(s[x][0],"tyche__mosaic__row-header").width)),columnHeaderHeight:Math.max(...f.map(x=>Ee(r[x][0],"tyche__mosaic__column-header").height)),rowTotalWidth:Math.max(...N.map(x=>Ee(p[x].toString(),"tyche__mosaic__row-total").width))}),[N,f,s,r,p]),U=et-C-F;return N.forEach(x=>{const b=f.map(S=>v[x][S]);if(b.reduce((S,P)=>S+P.widthPercent,0)>0){const P=b.map(k=>k.widthPercent/100*U).map((k,z)=>b[z].count>0&&k>0&&k<E?E:k),H=P.reduce((k,z)=>k+z,0);f.forEach((k,z)=>{v[x][k].widthPercent=H>0?P[z]/H*100:0})}}),e.jsxs("div",{className:"tyche__mosaic__container",style:{maxWidth:`${et}px`},children:[e.jsx("div",{className:"tyche__mosaic__column-headers",style:{marginLeft:`${C}px`,marginRight:`${F}px`,height:`${I}px`},children:f.map((x,b)=>{const y=b===0,S=b===f.length-1;return e.jsx("div",{className:"tyche__mosaic__column-header",style:{left:`${$[b]}%`,transform:y?"translateX(0%)":S?"translateX(-100%)":"translateX(-50%)",textAlign:y?"left":S?"right":"center"},onClick:()=>A(null,x),children:r[x][0]},`header-${x}`)})}),N.map((x,b)=>e.jsxs("div",{className:"tyche__mosaic__row",style:{height:`${R[b]}px`},children:[e.jsx("div",{className:"tyche__mosaic__row-header",style:{width:`${C}px`,cursor:"pointer"},onClick:()=>A(x,null),children:s[x][0]}),e.jsx("div",{className:"tyche__mosaic__row-cells",children:f.map(y=>{const S=v[x][y];if(S.count===0)return null;const P=d.has(te([x,y])),H=`${s[x][0]} and ${r[y][0]}<br>Count: ${S.count}`;return e.jsx("div",{className:`tyche__mosaic__cell${P?" tyche__mosaic__cell--selected":""}`,style:{width:`${S.widthPercent}%`,minWidth:`${E}px`,minHeight:`${j}px`,...i(s[x][0],r[y][0])},onClick:()=>A(x,y),onMouseEnter:k=>u(H,k.clientX,k.clientY,"tyche-mosaic"),onMouseMove:k=>l(k.clientX,k.clientY,"tyche-mosaic"),onMouseLeave:()=>c("tyche-mosaic"),children:e.jsx("span",{className:"tyche__mosaic__cell-value",children:S.count})},`cell-${x}-${y}`)})}),e.jsx("div",{className:"tyche__mosaic__row-total",style:{width:`${F}px`},children:p[x]})]},`row-${x}`)),e.jsxs("div",{className:"tyche__mosaic__column-totals-row",style:{height:`${I}px`},children:[e.jsx("div",{style:{width:`${C}px`}}),e.jsx("div",{className:"tyche__mosaic__column-totals",style:{marginRight:`${F}px`},children:f.map((x,b)=>{const y=b===0,S=b===f.length-1;return e.jsx("div",{className:"tyche__mosaic__column-total",style:{left:`${$[b]}%`,transform:y?"translateX(0%)":S?"translateX(-100%)":"translateX(-50%)",textAlign:y?"left":S?"right":"center"},children:_[x]},`total-${x}`)})}),e.jsx("div",{className:"tyche__mosaic__grand-total",style:{width:`${F}px`},children:w})]})]})}function Ts({observations:t}){function n(s,r){const i={};return s==="Passed"?i.backgroundColor=W.SUCCESS:s==="Invalid"?i.backgroundColor=W.WARNING:s==="Failed"&&(i.backgroundColor=W.ERROR),r==="Duplicate"&&(i.opacity=.7),i}return e.jsx(Ve,{title:"Sample breakdown",children:e.jsx(Cs,{name:"samples",observations:t,verticalAxis:[["Passed",s=>s.status==="passed"],["Invalid",s=>s.status==="gave_up"]],horizontalAxis:[["Unique",s=>s.isUnique??!1],["Duplicate",s=>s.isDuplicate??!1]],cssStyle:n})})}const ge="Present",xe="Not present";var W=(t=>(t.PRIMARY="#6b8ab5",t.SUCCESS="#8ba86b",t.WARNING="#d59a7e",t.ERROR="#c77a7e",t.ACCENT="#c1a2bb",t.ACCENT2="#9fc7c6",t.ACCENT3="#edd39a",t.ACCENT4="#99c7d6",t.ACCENT5="#8faac6",t))(W||{});function Ls({test:t}){const{filters:n,observationCategory:s,setObservationCategory:r}=Ne(),i=s==="rolling"?t.rolling_observations.sortKey(u=>-u.run_start):t.corpus_observations,a=h.useMemo(()=>{const u=Array.from(n.values()).flat();return u.length===0?i:i.filter(c=>u.every(l=>l.predicate(c)))},[i,n]),o={raw:i,filtered:a};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:e.jsx("span",{children:"Observations"})}),e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:s,onChange:r,options:[{value:"covering",content:"Covering"},{value:"rolling",content:"Rolling"}]})}),e.jsx(Rs,{}),o.raw.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Ts,{observations:o}),e.jsx(As,{observations:o}),e.jsx(Es,{observations:o,observationCategory:s})]}):e.jsx("div",{className:"tyche__section",children:"No observations"})]})}function Ms({test:t}){return e.jsx(bs,{children:e.jsx(Ls,{test:t})})}class me{withProperties(n){return Object.assign(Object.create(this.constructor.prototype),this,n)}}class Ue extends me{constructor(n,s){super(),this.state=n,this.observation=s}static fromJson(n){return new Ue(n.state,de.fromJson(n.observation))}}class Z extends me{constructor(n=new Map([[0,0],[1,0],[2,0],[3,0]])){super(),this.counts=n}static fromJson(n){const s=new Map([[0,0],[1,0],[2,0],[3,0]]);for(const[r,i]of Object.entries(n))console.assert(typeof i=="number"),s.set(Number(r),i);return new Z(s)}add(n){const s=new Map(this.counts);for(const[r,i]of n.counts.entries())s.set(r,s.get(r)+i);return new Z(s)}subtract(n){const s=new Map(this.counts);for(const[r,i]of n.counts.entries())s.set(r,s.get(r)-i);return new Z(s)}sum(){return wt(this.counts.values())}}var Rt=(t=>(t[t.OVERRUN=0]="OVERRUN",t[t.INVALID=1]="INVALID",t[t.VALID=2]="VALID",t[t.INTERESTING=3]="INTERESTING",t))(Rt||{}),Te=(t=>(t.GENERATE="generate",t.REPLAY="replay",t.DISTILL="distill",t.SHRINK="shrink",t.FAILED="failed",t))(Te||{});class Se extends me{constructor(s,r,i,a,o,u,c,l){super();T(this,"status_counts_diff");T(this,"elapsed_time_diff");T(this,"timestamp_monotonic");this.elapsed_time=s,this.timestamp=r,this.status_counts=i,this.behaviors=a,this.fingerprints=o,this.since_new_behavior=u,this.phase=c,this.worker_uuid=l,this.status_counts_diff=null,this.elapsed_time_diff=null,this.timestamp_monotonic=null}get ninputs(){return this.status_counts.sum()}static fromJson(s,r){return new Se(r.elapsed_time,r.timestamp,Z.fromJson(r.status_counts),r.behaviors,r.fingerprints,r.since_new_behavior,r.phase,s)}}class de extends me{constructor(s,r,i,a,o,u,c,l,m,d,v){super();T(this,"isDuplicate",null);T(this,"isUnique",null);this.type=s,this.status=r,this.status_reason=i,this.representation=a,this.arguments_=o,this.how_generated=u,this.features=c,this.timing=l,this.metadata=m,this.property=d,this.run_start=v}static fromJson(s){return new de(s.type,s.status,s.status_reason,s.representation,new Map(Object.entries(s.arguments)),s.how_generated,new Map(Object.entries(s.features)),new Map(Object.entries(s.timing)),new Map(Object.entries(s.metadata)),s.property,Number(s.run_start))}}var X=(t=>(t[t.FAILED_FATALLY=0]="FAILED_FATALLY",t[t.FAILED=1]="FAILED",t[t.SHRINKING=2]="SHRINKING",t[t.RUNNING=3]="RUNNING",t[t.WAITING=4]="WAITING",t))(X||{});function tt(t,n){const s=n?n.status_counts:new Z,r=n?n.elapsed_time:0,i=t.status_counts.subtract(s),a=t.elapsed_time-r,o=n?Math.max(t.timestamp,n.timestamp_monotonic+a):t.timestamp;return console.assert(Array.from(i.counts.values()).every(u=>u>=0)),console.assert(a>=0),t.withProperties({status_counts_diff:i,elapsed_time_diff:a,timestamp_monotonic:o})}const ce=class ce extends me{constructor(s,r,i,a,o,u,c){super();T(this,"linear_reports");T(this,"_status_counts_cumsum");T(this,"_elapsed_time_cumsum");T(this,"load_finished_at",null);this.database_key=s,this.nodeid=r,this.rolling_observations=i,this.corpus_observations=a,this.failures=o,this.fatal_failure=u,this.reports_by_worker=c,this.linear_reports=[],this._status_counts_cumsum=new Map,this._elapsed_time_cumsum=new Map,this.load_finished_at=null;const l=this.reports_by_worker;this.reports_by_worker=new Map;const m=Array.from(l.entries()).flatMap(([d,v])=>v.map(p=>[d,p])).sortKey(([d,v])=>v.timestamp);for(const[d,v]of m)this.add_report(d,v);this._check_invariants()}static fromJson(s){return new ce(s.database_key,s.nodeid,[],[],new Map(Object.entries(s.failures).map(([r,i])=>[r,Ue.fromJson(i)])),s.fatal_failure,new Map(Object.entries(s.reports_by_worker).map(([r,i])=>[r,i.map(Se.fromJson)])))}_assert_reports_ordered(s){for(let r=0;r<s.length-1;r++)console.assert(s[r].timestamp_monotonic<=s[r+1].timestamp_monotonic)}_check_invariants(){this._assert_reports_ordered(this.linear_reports);const s=this.linear_status_counts(null);for(let i=0;i<s.length-1;i++)console.assert(s[i].sum()<=s[i+1].sum());const r=this.linear_elapsed_time(null);for(let i=0;i<r.length-1;i++)console.assert(r[i]<=r[i+1]);console.assert(r.length===s.length&&s.length===this.linear_reports.length);for(const[i,a]of this.reports_by_worker.entries())this._assert_reports_ordered(a)}add_report(s,r){let i=null,a=0;if(this.reports_by_worker.has(s)){const u=this.reports_by_worker.get(s);a=Re(u,r.elapsed_time,c=>c.elapsed_time),i=a!=0?u[a-1]:null}const o=tt(r,i);if(this.reports_by_worker.has(s)||this.reports_by_worker.set(s,[]),this.reports_by_worker.get(s).splice(a,0,o),o.phase!==Te.REPLAY||o.behaviors>=this.behaviors&&o.fingerprints>=this.fingerprints){const u=Re(this.linear_reports,o.timestamp_monotonic,c=>c.timestamp_monotonic);if(this.linear_reports.splice(u,0,o),u!=this.linear_reports.length-1){let c=null,l;for(l=0;l<this.linear_reports.length-(u+1);l++){const m=this.linear_reports[u+1+l];if(o.worker_uuid===m.worker_uuid){c=m;break}}c&&(console.assert(this.linear_reports[u+1+l]===c),this.linear_reports[u+1+l]=tt(c,o));for(const m of[this._status_counts_cumsum,this._elapsed_time_cumsum])for(const[d,[v,p]]of m.entries())u>=v&&m.set(d,[v,p.slice(0,u-v)])}}}get status(){if(this.fatal_failure)return X.FAILED_FATALLY;if(this.failures.size>0)return X.FAILED;if(this.linear_reports.length===0)return X.WAITING;const s=this.linear_reports[this.linear_reports.length-1],r=new Date().getTime()/1e3;return s.phase==Te.SHRINK?X.SHRINKING:s.ninputs===0||s.timestamp<r-ce.WAITING_STATUS_DURATION?X.WAITING:X.RUNNING}get behaviors(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].behaviors}get fingerprints(){return this.linear_reports.length===0?0:this.linear_reports[this.linear_reports.length-1].fingerprints}get since_new_behavior(){return this.linear_reports.length===0?null:this.linear_reports[this.linear_reports.length-1].since_new_behavior}elapsed_time(s){const r=this.linear_elapsed_time(s);return r.length===0?0:r[r.length-1]}ninputs(s){const r=this.linear_status_counts(s);return r.length===0?0:r[r.length-1].sum()}_cumsum(s,r,i,a,o){if(a===null&&(a=-1/0),s.has(a)){const[m,d]=s.get(a);if(d.length<this.linear_reports.slice(m).length){let v=d.length>0?d[d.length-1]:o;for(const p of this.linear_reports.slice(m+d.length))v=i(v,p[r]),d.push(v);s.set(a,[m,d])}return d}const u=[],c=Re(this.linear_reports,a,m=>m.timestamp_monotonic);let l=o;for(const m of this.linear_reports.slice(c))l=i(l,m[r]),u.push(l);return s.set(a,[c,u]),u}linear_status_counts(s){return this._cumsum(this._status_counts_cumsum,"status_counts_diff",(r,i)=>r.add(i),s,new Z)}linear_elapsed_time(s){return this._cumsum(this._elapsed_time_cumsum,"elapsed_time_diff",(r,i)=>r+i,s,0)}};T(ce,"WAITING_STATUS_DURATION",120);let Le=ce;const Et=h.createContext(null);function st(t){const n=new Map;t.forEach(r=>{n.set(r.representation,(n.get(r.representation)||0)+1)}),t.forEach(r=>{const i=n.get(r.representation);r.isUnique=i==1,r.isDuplicate=i>1});const s=new Set;t.forEach(r=>{r.features.forEach((i,a)=>{s.add(a)})}),t.forEach(r=>{s.forEach(i=>{r.features.has(i)||r.features.set(i,xe)});for(const[i,a]of r.features)a===""&&r.features.set(i,ge)})}function $s(t,n){const s=new Map(t);function r(i){if(s.has(i))return s.get(i);{const a=new Le(null,i,[],[],new Map,null,new Map);return s.set(a.nodeid,a),a}}switch(n.type){case 1:return t;case 2:{const{tests:i}=n;for(const{database_key:a,nodeid:o,failures:u,fatal_failure:c}of i){const l=r(o);l.database_key=a,u.forEach((m,d)=>{l.failures.set(d,m)}),l.fatal_failure=c}return s}case 3:{const{nodeid:i,worker_uuid:a,reports:o}=n,u=r(i);for(const c of o)u.add_report(a,c);return s}case 5:{const{nodeid:i,failures:a}=n,o=r(i);return a.forEach((u,c)=>{o.failures.set(c,u)}),s}case 4:{const{nodeid:i,observation_type:a,observations:o}=n,u=r(i);return a==="rolling"?(u.rolling_observations.push(...o),u.rolling_observations=u.rolling_observations.sortKey(c=>-c.run_start).slice(0,300),st(u.rolling_observations)):(console.assert(a==="corpus"),u.corpus_observations.push(...o),st(u.corpus_observations)),s}case 7:{const{nodeid:i}=n,a=r(i);return a.load_finished_at=Date.now(),s}default:throw new Error("non-exhaustive switch in testsReducer")}}function Is({children:t}){const[n,s]=h.useState(null),[r,i]=h.useReducer($s,new Map),[a,o]=h.useState(!1),[u,c]=h.useState(null),[l,m]=h.useState({count_tests:null,count_tests_loaded:null}),{addNotification:d,updateNotification:v,dismissNotification:p}=vs();h.useRef(null);const _=h.useCallback(N=>{o(!0),c(N)},[]),w=h.useCallback(()=>{const N=Date.now();return l.count_tests_loaded!==null&&l.count_tests!==null&&l.count_tests_loaded===l.count_tests&&Array.from(r.values()).every(f=>f.load_finished_at===null?!1:N-f.load_finished_at>200)},[l,r]);return h.useEffect(()=>{if(a){r.clear(),m({count_tests:null,count_tests_loaded:null});{fetch(new URL("dashboard_state/tests.json",import.meta.url)).then(f=>f.text()).then(f=>JSON.parse(f)).then(f=>{Object.entries(f).forEach(([A,E])=>{i({type:2,tests:[{database_key:E.database_key,nodeid:A,failures:E.failures,fatal_failure:E.fatal_failure}]});for(const[j,g]of Object.entries(E.reports_by_worker))i({type:3,nodeid:A,worker_uuid:j,reports:g.map(L=>Se.fromJson(j,L))});i({type:7,nodeid:A})})});const N=new Worker(new URL("/preview-193/example-dashboard/assets/jsonWorker-KJVNTzbb.js",import.meta.url));return fetch(new URL("dashboard_state/observations.json",import.meta.url)).then(f=>f.text()).then(f=>new Promise(A=>{N.onmessage=E=>A(E.data),N.postMessage(f)})).then(f=>{for(const[A,E]of Object.entries(f))i({type:4,nodeid:A,observation_type:"rolling",observations:E.rolling.map(de.fromJson)}),i({type:4,nodeid:A,observation_type:"corpus",observations:E.corpus.map(de.fromJson)})}),()=>N.terminate()}}},[u,a]),e.jsx(Et.Provider,{value:{tests:r,socket:n,doLoadData:_,testsLoaded:w},children:t})}function We(t=null){const n=h.useContext(Et);if(!n)throw new Error("useData must be used within a DataProvider");return h.useEffect(()=>{n.doLoadData(t)},[t,n.doLoadData]),n}function fe({to:t,children:n,isActive:s}){const r=Fe();return e.jsx(ee,{to:t,className:`sidebar__link ${s(r.pathname)?"sidebar__link--active":""}`,children:n})}function Fs(){const t=Fe(),[n,s]=h.useState(!1),r=h.useRef(null);return h.useEffect(()=>{function i(a){var o;n&&((o=r.current)==null?void 0:o.contains(a.target))===!1&&s(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[n]),h.useEffect(()=>{s(!1)},[t]),e.jsxs("div",{className:"layout",children:[!n&&e.jsx("div",{className:"toggle-sidebar",onClick:()=>s(!0),children:e.jsx(M,{icon:Jt,size:"lg"})}),n&&e.jsx("div",{className:"opacity-overlay"}),e.jsxs("div",{ref:r,className:`sidebar ${n?"sidebar--open":""}`,children:[e.jsx(ee,{to:"/",className:"sidebar__title",children:"HypoFuzz"}),e.jsxs("nav",{className:"sidebar__nav",children:[e.jsx(fe,{to:"/",isActive:i=>i==="/"||i.startsWith("/tests/"),children:"Tests"}),e.jsx(fe,{to:"/patches",isActive:i=>i==="/patches",children:"Patches"}),e.jsx(fe,{to:"/collected",isActive:i=>i==="/collected",children:"Collection"}),e.jsx(fe,{to:"/workers",isActive:i=>i==="/workers",children:"Workers"}),e.jsx("div",{className:"sidebar__separator"}),e.jsx("a",{href:`${"/preview-193/example-dashboard".replace(/\/$/,"")}/docs/`,className:"sidebar__link",children:"Docs"})]})]}),e.jsx("div",{className:"content",children:e.jsx(Ot,{})})]})}function He({headers:t,data:n,row:s,mobileRow:r,getKey:i,onFilterChange:a,filterStrings:o}){const[u,c]=h.useState(null),[l,m]=h.useState(0),[d,v]=h.useState(""),p=Be(),_=h.useMemo(()=>{let f=n;if(d&&(f=n.filter(E=>o?o(E).some(j=>j.toLowerCase().includes(d.toLowerCase())):!0)),u===null)return f;const A=[...f].sortKey(E=>t[u].sortKey(E));return l===0?A:A.reverse()},[n,u,l,t,d,s,o,r,p]),w=f=>{t[f].sortKey&&(u===f?m(A=>A===0?1:0):(c(f),m(0)))};function N(f){v(f),a==null||a(f)}return e.jsxs("div",{className:"table",children:[o!==void 0&&e.jsxs("div",{className:"table__filter",children:[e.jsx("input",{type:"text",placeholder:"Filter",value:d,onChange:f=>N(f.target.value),className:"table__filter__input"}),d&&e.jsx("span",{className:"table__filter__clear",onClick:()=>N(""),children:e.jsx(M,{icon:Qt})})]}),r!==void 0&&p?_.map(f=>e.jsx("div",{children:r(f)},i?i(f):void 0)):e.jsxs("table",{className:"table__table",children:[e.jsx("thead",{children:e.jsx("tr",{children:t.map((f,A)=>e.jsx("th",{onClick:()=>w(A),className:f.sortKey?"table--sortable":"",children:e.jsxs("div",{className:`table__header table__header--${f.align??"left"}`,children:[f.content,f.sortKey&&e.jsx("div",{className:"table__sort",children:[0,1].map(E=>e.jsx("div",{className:`table__sort__arrow table__sort__arrow--${E===0?"asc":"desc"} ${u===A&&l===E?"table__sort__arrow--active":""}`,children:E===0?e.jsx(M,{icon:Zt}):e.jsx(M,{icon:es})}))})]})},A))})}),e.jsx("tbody",{children:_.map(f=>{const A=s(f);return console.assert(A.length===t.length),e.jsx("tr",{children:A.map((E,j)=>e.jsx("td",{children:E},j))},i?i(f):void 0)})})]}),d&&_.length<n.length&&e.jsxs("div",{className:"table__filter-status",children:["Showing ",_.length," of ",n.length," rows",e.jsx("span",{className:"table__filter-status__clear",onClick:()=>{v(""),a==null||a("")},children:"[clear]"})]})]})}async function Ke(t){return await(await fetch(new URL("dashboard_state/api.json",import.meta.url))).json()}async function Ps(t){var s;const n=await Ke();return(s=n==null?void 0:n.patches)==null?void 0:s[t]}async function Ct(){const t=await Ke();return t==null?void 0:t.available_patches}async function Ds(){const t=await Ke();return t==null?void 0:t.collection_status}const nt={not_collected:0,collected:1};function Bs(){const[t,n]=h.useState(null);if(h.useEffect(()=>{Ds().then(a=>{n(a)})},[]),t===null)return null;if(!t.length)return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection"}),"No tests collected."]});const s=[...t].sortKey(a=>[nt[a.status],a.status_reason,a.nodeid]),r=[{content:"Test",sortKey:a=>a.nodeid},{content:"Status",sortKey:a=>[nt[a.status],a.status_reason],align:"center"}],i=a=>[e.jsx("div",{style:{wordBreak:"break-all"},children:a.status=="collected"?e.jsx(ee,{to:`/tests/${encodeURIComponent(a.nodeid)}`,className:"test__link",children:a.nodeid}):a.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:a.status==="collected"?e.jsx("div",{className:"pill pill__success",children:"Collected"}):e.jsxs("div",{className:"pill pill__neutral",children:["Not collected (",a.status_reason,")"]})})];return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Test collection status"}),e.jsx(He,{headers:r,data:s,row:i,getKey:a=>a.database_key,filterStrings:a=>[a.nodeid,a.status==="collected"?"Collected":`Not collected (${a.status_reason})`]})]})}function zs(){return e.jsx("h1",{children:"Page not found!"})}function Os(t){const n=t.regex;return{name:"Diff",aliases:["patch"],contains:[{className:"meta",relevance:10,match:n.either(/^@@ +-\d+,\d+ +\+\d+,\d+ +@@/,/^\*\*\* +\d+,\d+ +\*\*\*\*$/,/^--- +\d+,\d+ +----$/)},{className:"comment",variants:[{begin:n.either(/Index: /,/^index/,/={3,}/,/^-{3}/,/^\*{3} /,/^\+{3}/,/^diff --git/),end:/$/},{match:/^\*{15}$/}]},{className:"addition",begin:/^\+/,end:/$/},{className:"deletion",begin:/^-/,end:/$/},{className:"addition",begin:/^!/,end:/$/}]}}he.registerLanguage("diff",Os);function Tt({nodeid:t}){const[n,s]=h.useState({}),[r,i]=h.useState(!0),[a,o]=h.useState(null),[u,c]=h.useState(!1),l=h.useRef(null);if(h.useEffect(()=>{Ps(t).then(w=>{w&&s(w),i(!1)})},[t]),h.useEffect(()=>{Nt(l,!0)},[n,a]),r)return e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading patches..."})});if(Object.values(n).every(w=>w===null))return e.jsx("div",{className:"card",children:e.jsx("p",{children:"No patches for this test"})});const m=new Map([["failing","Failing"],["covering","Covering"]]),d=a??Array.from(m.keys()).find(w=>n[w]),v=n[d],p=async()=>{await navigator.clipboard.writeText(v),c(!0),setTimeout(()=>{c(!1)},2e3)},_=()=>{const w=new Blob([v],{type:"text/plain"}),N=URL.createObjectURL(w),f=document.createElement("a");f.href=N,f.download=`${d}-${t.split("::").pop()}.patch`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(N)};return e.jsxs("div",{ref:l,children:[e.jsx("div",{style:{paddingTop:"10px",paddingBottom:"10px",display:"flex",fontSize:"1.05rem",fontWeight:"500"},children:e.jsx(re,{value:d,onChange:o,options:Array.from(m.entries()).filter(([w])=>n[w]).map(([w,N])=>({value:w,content:N}))})}),e.jsxs("pre",{className:"patch__pre",children:[e.jsxs("div",{className:"patch__controls",children:[e.jsx("div",{className:`patch__controls__control ${u?"patch__controls__control--success":""}`,onClick:p,title:"Copy patch",children:e.jsx(M,{icon:u?ts:ss})}),e.jsx("div",{className:"patch__controls__control",onClick:_,title:"Download patch",children:e.jsx(M,{icon:ns})})]}),e.jsx("code",{className:"language-diff",children:v})]})]})}function Vs(){const[t,n]=h.useState(null);return h.useEffect(()=>{Ct().then(s=>{n(s)})},[]),t===null||t.length===0?e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Patches"}),e.jsx("p",{children:"No tests collected"})]}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Patches"}),t.map(s=>e.jsx(Oe,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:s}),e.jsxs(ee,{to:`/tests/${encodeURIComponent(s)}`,style:{color:"var(--secondary-color, #888)",fontSize:"0.9em",textDecoration:"none",marginLeft:"12px"},children:["View test ",e.jsx(M,{icon:rs})]})]}),headerClass:"patches__test",defaultState:"closed",children:e.jsx(Tt,{nodeid:s})}))]})}const B={scaleSymlog:ls,scaleLinear:ft,select:Pe,zoom:xt,zoomIdentity:gt,pointer:hs,line:ds,axisBottom:mt,axisLeft:ht,brush:us,scaleOrdinal:De,schemeCategory10:_t,interpolateViridis:pt,quadtree:cs};class we{constructor(n,s,r,i,a){this.nodeid=n,this.linear_status_counts=s,this.linear_elapsed_time=r,this.behaviors=i,this.fingerprints=a}static fromReport(n,s){return new we(n,s.status_counts,s.elapsed_time,s.behaviors,s.fingerprints)}}const Us=10,Lt=270,rt=5;class Ws{constructor(n,s,r,i,a,o,u,c){T(this,"lines");T(this,"scaleSetting");T(this,"scaleSettingY");T(this,"axisSettingX");T(this,"axisSettingY");T(this,"xValue");T(this,"yValue");T(this,"width");T(this,"height");T(this,"margin");T(this,"x");T(this,"y");T(this,"g");T(this,"zoom");T(this,"chartArea");T(this,"navigate");T(this,"tooltip");T(this,"brush",null);T(this,"eventListeners",new Map);T(this,"xAxis");T(this,"yAxis");T(this,"viewportX");T(this,"viewportY");T(this,"quadtree");this.lines=s,this.scaleSetting=r,this.scaleSettingY=i,this.axisSettingX=a,this.axisSettingY=o,this.navigate=u,this.xValue=d=>a=="time"?d.linear_elapsed_time:d.linear_status_counts.sum(),this.yValue=d=>o=="behaviors"?d.behaviors:d.fingerprints,this.margin={top:5,right:5,bottom:25,left:40},this.width=n.clientWidth-this.margin.left-this.margin.right,this.height=Lt-this.margin.top-this.margin.bottom;const l=s.map(d=>d.reports).flat();this.x=(r==="log"?B.scaleSymlog():B.scaleLinear()).domain([0,ue(l.map(d=>this.xValue(d)))||1]).range([0,this.width]),this.y=(i==="log"?B.scaleSymlog():B.scaleLinear()).domain([0,ue(l.map(d=>this.yValue(d)))||0]).range([this.height,0]),this.viewportX=this.x,this.viewportY=this.y,this.g=B.select(n).append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`);const m=this.g.append("defs");m.append("clipPath").attr("id","clip-content").append("rect").attr("width",this.width).attr("height",this.height+5).attr("x",0).attr("y",-5),m.append("clipPath").attr("id","clip-x-axis").append("rect").attr("width",this.width+rt*2).attr("height",this.height).attr("x",-rt).attr("y"),this.chartArea=this.g.append("g").attr("class","chart-area").attr("clip-path","url(#clip-content)"),this.chartArea.append("rect").attr("width",this.width).attr("height",this.height).attr("fill","none").attr("pointer-events","all"),this.zoom=B.zoom().scaleExtent([1,1/0]).on("zoom",d=>this.zoomTo(d.transform,!1)),this.chartArea.call(this.zoom),this.chartArea.on("dblclick.zoom",()=>{this.chartArea.transition().duration(500).call(this.zoom.transform,B.zoomIdentity)}),this.tooltip=B.select(".coverage-graph__tooltip"),this.xAxis=this.g.append("g").attr("transform",`translate(0,${this.height})`).attr("clip-path","url(#clip-x-axis)").call(this.createXAxis(this.x)),this.yAxis=this.g.append("g").call(this.createYAxis(this.y)),this.chartArea.on("mousemove",d=>{const[v,p]=B.pointer(d),_=this.quadtree.find(v,p,Us);_?this.tooltip.style("display","block").style("left",`${d.pageX+10}px`).style("top",`${d.pageY-10}px`).html(`
                <strong>${kt(_.nodeid)}</strong><br/>
                ${_.behaviors.toLocaleString()} behaviors / ${_.fingerprints.toLocaleString()} fingerprints<br/>
                ${_.linear_status_counts.sum().toLocaleString()} inputs / ${_.linear_elapsed_time.toFixed(1)} seconds
              `):this.tooltip.style("display","none")}).on("mouseout",()=>{this.tooltip.style("display","none")}),this.drawLines(),this.updateQuadtree()}logAxis(n,s){const r=[0];let i=1;for(;i<=s;)r.push(i),i*=10;return n.tickValues(r).tickFormat(a=>{const o=a.valueOf();return console.assert(o>=0),o>=1e6?`${Math.floor(o/1e6)}M`:o>=1e3?`${Math.floor(o/1e3)}k`:o>0?o.toLocaleString():"0"})}createXAxis(n){if(this.scaleSetting==="log"){const s=n.domain()[1];return this.logAxis(B.axisBottom(n),s)}else return B.axisBottom(n).ticks(5).tickFormat(s=>s.toLocaleString())}createYAxis(n){if(this.scaleSettingY==="log"){const s=n.domain()[1];return this.logAxis(B.axisLeft(n),s)}else return B.axisLeft(n).ticks(5)}updateQuadtree(){const n=this.lines.map(s=>s.reports).flat();this.quadtree=B.quadtree().x(s=>this.viewportX(this.xValue(s))).y(s=>this.viewportY(this.yValue(s))).addAll(n)}zoomTo(n,s){const r=n.rescaleX(this.x),i=s?n.rescaleY(this.y):this.y;this.viewportX=r,this.viewportY=i,this.xAxis.call(this.createXAxis(r)),s&&this.yAxis.call(this.createYAxis(i)),this.g.selectAll(".chart-area path").attr("d",B.line().x(a=>r(this.xValue(a))).y(a=>i(this.yValue(a)))),this.updateQuadtree()}drawLines(){const n=B.line().x(s=>this.x(this.xValue(s))).y(s=>this.y(this.yValue(s)));this.lines.forEach(s=>{this.chartArea.append("path").datum(s.reports).attr("fill","none").attr("stroke",s.color).attr("d",n).attr("class","coverage-line").style("cursor","pointer").on("mouseover",function(){B.select(this).classed("coverage-line__selected",!0)}).on("mouseout",function(){B.select(this).classed("coverage-line__selected",!1)}).on("click",r=>{s.url&&St(r,s.url,this.navigate)})})}enableBoxBrush(){for(const n of["wheel","mousedown","mousemove","mouseup"])this.chartArea.on(`${n}.zoom`,null);this.brush=B.brush().extent([[0,0],[this.width,this.height]]).on("end",n=>{if(!n.selection)return;const[[s,r],[i,a]]=n.selection;if(this.chartArea.call(this.brush.clear),this.chartArea.call(this.zoom),Math.abs(i-s)<5||Math.abs(a-r)<5){this.emit("boxSelectEnd");return}const o=this.width/(i-s),u=this.height/(a-r),c=Math.max(o,u),l=B.zoomIdentity.translate(this.width/2,this.height/2).scale(c).translate(-(s+i)/2,-(r+a)/2);this.chartArea.transition().duration(250).call(this.zoom.transform,l).on("end",()=>{this.emit("boxSelectEnd")})}),this.chartArea.style("cursor","crosshair").call(this.brush)}cleanup(){this.tooltip.style("display","none"),this.g.selectAll("path").classed("coverage-line__selected",!1)}on(n,s){this.eventListeners.has(n)||this.eventListeners.set(n,[]),this.eventListeners.get(n).push(s)}off(n,s){this.eventListeners.has(n)&&this.eventListeners.set(n,this.eventListeners.get(n).filter(r=>r!==s))}emit(n){this.eventListeners.has(n)&&this.eventListeners.get(n).forEach(s=>s())}}const oe=new Map;function q(t,n){const[s,r]=h.useState(()=>{const a=sessionStorage.getItem(t);return a===null?n:JSON.parse(a)});h.useEffect(()=>(oe.has(t)||oe.set(t,new Set),oe.get(t).add(r),()=>{oe.get(t).delete(r)}),[t]);function i(a){sessionStorage.setItem(t,JSON.stringify(a)),oe.get(t).forEach(o=>o(a))}return[s,i]}const se={zoom:xt,zoomIdentity:gt,select:Pe,scaleOrdinal:De,interpolateViridis:pt,schemeCategory10:_t};var Me=(t=>(t.TOGETHER="linearized",t.SEPARATE="individual",t.LATEST="latest",t))(Me||{});function Hs(t,n){const s=t.linear_status_counts(n),r=t.linear_elapsed_time(n),i=[];for(let a=0;a<s.length;a++){const o=t.linear_reports[a];i.push({nodeid:t.nodeid,linear_status_counts:s[a],linear_elapsed_time:r[a],behaviors:o.behaviors,fingerprints:o.fingerprints})}return i}function Mt({value:t,onChange:n}){return e.jsx(re,{value:t,onChange:n,options:[{value:"log",content:"Log"},{value:"linear",content:"Linear"}]})}function Ks(){const[t,n]=q("graph_scale_x","log"),[s,r]=q("graph_axis_x","time");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--x",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(M,{icon:s==="inputs"?ye:je,style:{fontSize:"0.9rem"}}),s==="inputs"?"Inputs":"Time"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Mt,{value:t,onChange:n}),e.jsx(re,{value:s,onChange:r,options:[{value:"inputs",content:e.jsx(M,{icon:ye})},{value:"time",content:e.jsx(M,{icon:je})}]})]})]})}function Xs(){const[t,n]=q("graph_scale_y","linear"),[s,r]=q("graph_axis_y","behaviors");return e.jsxs("div",{className:"coverage-graph__label coverage-graph__label--y",style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Mt,{value:t,onChange:n}),e.jsx(re,{value:s,onChange:r,options:[{value:"behaviors",content:e.jsx(M,{icon:ve})},{value:"fingerprints",content:e.jsx(M,{icon:be})}]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(M,{icon:s==="behaviors"?ve:be,style:{fontSize:"0.9rem"}}),s==="behaviors"?"Behaviors":"Fingerprints"]})]})}const it={linearized:{content:e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:Ge})," Together"]}),mobileContent:e.jsx(M,{icon:Ge})},individual:{content:e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:Ye})," Separate"]}),mobileContent:e.jsx(M,{icon:Ye})},latest:{content:e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:Xe})," Latest"]}),mobileContent:e.jsx(M,{icon:Xe})}};function $t({tests:t,filterString:n="",testsLoaded:s,workers_after:r=null,workerViews:i=["linearized","individual","latest"],workerViewSetting:a}){const o=h.useRef(null),[u,c]=q("graph_scale_x","log"),[l,m]=q("graph_scale_y","linear"),[d,v]=q("graph_axis_x","time"),[p,_]=q("graph_axis_y","behaviors"),[w,N]=q(a,"linearized"),[f,A]=h.useState(!0),[E,j]=h.useState({transform:null,zoomY:!1}),[g,L]=h.useState(!1),R=lt(),$=Be(),[C,I]=h.useState(!1),F=se.scaleOrdinal(se.schemeCategory10).domain(Array.from(t.keys())),U=h.useMemo(()=>{let y=[];if(w==="linearized")y=Array.from(t.entries()).sortKey(([S,P])=>S).map(([S,P])=>({url:`/tests/${encodeURIComponent(S)}`,reports:Hs(P,r),color:F(S)}));else if(w==="individual"){let S=function(z){if(P.length<=1)return se.interpolateViridis(.5);const K=(z-H)/(k-H);return se.interpolateViridis(K)};const P=[];for(const z of t.values())for(const K of z.reports_by_worker.values())K.length>0&&P.push(K[0].timestamp);const H=Ns(P)??0,k=ue(P)??0;for(const[z,K]of t.entries())for(const D of K.reports_by_worker.values())D.length>0&&y.push({url:null,reports:D.map(O=>we.fromReport(z,O)),color:S(D[0].timestamp)})}else if(w==="latest")for(const[S,P]of t.entries()){const H=ue(Array.from(P.reports_by_worker.values()),k=>k[0].elapsed_time);H&&y.push({url:null,reports:H.map(k=>we.fromReport(S,k)),color:F(S)})}return y},[t,r,w]),x=h.useMemo(()=>n?U.filter(y=>{var S;return(S=y.url)==null?void 0:S.toLowerCase().includes(n.toLowerCase())}):U,[U,n]);h.useEffect(()=>{if(!o.current||!f&&C&&s())return;f&&A(!1),se.select(o.current).selectAll("*").remove();const y=new Ws(o.current,x,u,l,d,p,R,$);return E.transform&&y.zoom.transform(y.chartArea,E.transform),y.zoomTo(E.transform??se.zoomIdentity,E.zoomY),y.zoom.on("zoom.saveTransform",S=>{j({transform:S.transform,zoomY:!1})}),g&&y.enableBoxBrush(),y.on("boxSelectEnd",b),()=>{y.cleanup()}},[t,u,l,d,p,w,f,g,R]);const b=()=>{L(!g),A(!0)};return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",style:{marginBottom:"1rem"},children:"Coverage"}),e.jsx("div",{className:"coverage-graph__tooltip"}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"1rem"},children:e.jsx(re,{value:w,onChange:N,options:i.map(y=>({value:y,content:it[y].content,mobileContent:it[y].mobileContent}))})}),e.jsx("div",{className:"coverage-graph__container",children:e.jsxs("div",{className:"coverage-graph__grid",style:{marginRight:"15px",flex:1,height:"auto"},children:[e.jsx(Xs,{}),e.jsx("svg",{className:"coverage-graph__svg",ref:o,style:{width:"100%",height:`${Lt}px`},onMouseEnter:()=>I(!0),onMouseLeave:()=>{I(!1),A(!0)}}),e.jsx("div",{}),e.jsx(Ks,{})]})})]})}function $e({status:t}){return e.jsx("span",{style:{textAlign:"center"},children:t===X.FAILED_FATALLY?e.jsx("span",{className:"pill pill__failure",children:"Failed fatally"}):t===X.FAILED?e.jsx("span",{className:"pill pill__failure",children:"Failed"}):t===X.SHRINKING?e.jsx("span",{className:"pill pill__warning",children:"Shrinking"}):t===X.RUNNING?e.jsx("span",{className:"pill pill__success",children:"Running"}):e.jsx("span",{className:"pill pill__neutral",children:"Waiting"})})}function Q({content:t,tooltip:n}){return e.jsxs("span",{className:"tooltip",children:[t,e.jsx("div",{className:"tooltip__text",children:n})]})}function It(t){const n=Math.floor(t/3600),s=Math.floor(t%3600/60),r=Math.floor(t%60);return`${n>0?`${n}:${s.toString().padStart(2,"0")}`:s}:${r.toString().padStart(2,"0")}`}function Ft(t){const n=t.ninputs(null),s=t.elapsed_time(null);return s===0?null:n/s}function Ie(t){var s;if(t.linear_reports.length===0)return{inputs:"—",behaviors:"—",fingerprints:"—",executions:"—",inputsSinceBranch:"—",timeSpent:"—"};const n=Ft(t);return{inputs:t.ninputs(null).toLocaleString(),behaviors:t.behaviors.toLocaleString(),fingerprints:t.fingerprints.toLocaleString(),executions:n===null?"—":`${n.toFixed(1).toLocaleString()}/s`,inputsSinceBranch:((s=t.since_new_behavior)==null?void 0:s.toLocaleString())??"—",timeSpent:It(t.elapsed_time(null))}}he.registerLanguage("python",At);function Ys({failure:t}){return e.jsx("span",{style:{textAlign:"center"},children:t.state==="shrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Fully shrunk"}):t.state==="unshrunk"?e.jsx("span",{className:"pill pill__neutral",children:"Still shrinking..."}):e.jsx(e.Fragment,{})})}function Gs({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem",marginBottom:"1rem"},children:[e.jsx("div",{className:"failure__title",children:"Failure"}),e.jsx(Ys,{failure:t})]}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Call"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("reproduction_decorator")+`
`+t.observation.representation})}),e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",children:t.observation.metadata.get("traceback")})})]})]})}function qs({failure:t}){return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"failure__title",children:"Fatal failure"}),e.jsxs("div",{className:"failure__item",children:[e.jsx("div",{className:"failure__item__subtitle",children:"Traceback"}),e.jsx("pre",{children:e.jsx("code",{className:"language-python",style:{whiteSpace:"pre-wrap"},children:t})})]})]})}function Js(){const{nodeid:t}=Vt(),{tests:n,testsLoaded:s}=We(t),r=h.useRef(null),[i,a]=h.useState(null);h.useEffect(()=>{Ct().then(l=>{a(l)})},[]);const o=n.get(t)??null;if(h.useEffect(()=>{o&&Nt(r)},[o==null?void 0:o.failures]),!t||!o)return e.jsx("div",{children:"Test not found"});const u=Ie(o),c=[{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:ye})}),tooltip:"Number of inputs"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:ve})}),tooltip:"Number of behaviors (typically branches) found"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:be})}),tooltip:"Number of fingerprints (sets of behaviors) found"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:ut})}),tooltip:"Inputs per second"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:dt})}),tooltip:"Number of inputs since a new behavior"})},{content:e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:je})}),tooltip:"Total time spent running"})}];return e.jsxs("div",{ref:r,children:[e.jsxs(ee,{to:"/",className:"back-link",children:[e.jsx(M,{icon:is})," Back to all tests"]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.7rem"},children:[e.jsx("span",{style:{wordBreak:"break-all",fontSize:"1.5rem",fontWeight:"bold"},children:t}),e.jsx($e,{status:o.status})]}),e.jsx("div",{style:{paddingTop:"1rem",paddingBottom:"1rem"},children:e.jsx(He,{headers:c,data:[u],row:l=>[e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputs}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.behaviors}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.fingerprints}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.executions}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.inputsSinceBranch}),e.jsx("div",{style:{fontVariantNumeric:"tabular-nums"},children:l.timeSpent})]})})]}),e.jsx($t,{tests:new Map([[t,o]]),testsLoaded:s,workerViewSetting:"graph_worker_view_test"}),Array.from(o.failures.values()).map(l=>e.jsx(Gs,{failure:l})),o.fatal_failure&&e.jsx(qs,{failure:o.fatal_failure}),e.jsx(Ms,{test:o}),(i==null?void 0:i.includes(t))&&e.jsx("div",{className:"card",children:e.jsx(Oe,{title:"Patches",defaultState:"closed",headerClass:"card__header",children:e.jsx(Tt,{nodeid:t})})})]})}function ne({icon:t,tooltip:n}){return e.jsx(Q,{content:e.jsx("div",{className:"table__header__icon",children:e.jsx(M,{icon:t})}),tooltip:n})}function le({icon:t,value:n}){return e.jsxs("div",{className:"table__inline-statistic",children:[t,e.jsx("span",{className:"table__inline-statistic__value",children:n})]})}function Qs({tests:t,onFilterChange:n}){const s=Array.from(t).sortKey(([p,_])=>[_.status,p]).map(([p,_])=>_),r=e.jsx(ne,{icon:ye,tooltip:"Number of inputs"}),i=e.jsx(ne,{icon:ve,tooltip:"Number of behaviors (typically branches) found"}),a=e.jsx(ne,{icon:be,tooltip:"Number of fingerprints (sets of behaviors) found"}),o=e.jsx(ne,{icon:ut,tooltip:"Inputs per second"}),u=e.jsx(ne,{icon:dt,tooltip:"Number of inputs since a new behavior"}),c=e.jsx(ne,{icon:je,tooltip:"Total time spent running"}),l=[{content:"Test",sortKey:p=>p.nodeid},{content:"Status",sortKey:p=>p.status,align:"center"},{content:r,align:"right",sortKey:p=>p.ninputs(null)},{content:i,align:"right",sortKey:p=>p.behaviors},{content:a,align:"right",sortKey:p=>p.fingerprints},{content:o,align:"right",sortKey:p=>Ft(p)??-1},{content:u,align:"right",sortKey:p=>p.since_new_behavior??0},{content:c,align:"right",sortKey:p=>p.elapsed_time(null)}],m=p=>{const _=Ie(p);return[e.jsx(ee,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx($e,{status:p.status})}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.inputs}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.behaviors}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.fingerprints}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.executions}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.inputsSinceBranch}),e.jsx("div",{style:{textAlign:"right",fontVariantNumeric:"tabular-nums"},children:_.timeSpent})]};function d(p){const _=Ie(p);return e.jsxs("div",{className:"table__mobile-row",children:[e.jsxs("div",{className:"table__mobile-row__header",children:[e.jsx(ee,{to:`/tests/${encodeURIComponent(p.nodeid)}`,className:"test__link",style:{wordBreak:"break-all"},children:p.nodeid}),e.jsx($e,{status:p.status})]}),e.jsxs("div",{className:"table__mobile-row__statistics",children:[e.jsx(le,{icon:r,value:_.inputs}),e.jsx(le,{icon:i,value:_.behaviors}),e.jsx(le,{icon:o,value:_.executions}),e.jsx(le,{icon:u,value:_.inputsSinceBranch}),e.jsx(le,{icon:c,value:_.timeSpent})]})]})}function v(p){return[p.nodeid,Rt[p.status]]}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Tests"}),e.jsx(He,{headers:l,data:s,row:m,mobileRow:d,filterStrings:v,onFilterChange:n})]})}function Zs(){const{tests:t,testsLoaded:n}=We(),[s,r]=h.useState("");return e.jsxs("div",{className:"dashboard",children:[e.jsx($t,{tests:t,filterString:s,testsLoaded:n,workerViews:[Me.TOGETHER,Me.LATEST],workerViewSetting:"graph_worker_view_tests"}),e.jsx(Qs,{tests:t,onFilterChange:r})]})}function en({min:t,max:n,value:s,onChange:r,step:i=1}){const[a,o]=h.useState(null),u=h.useRef(null);console.assert(t<=n,`min: ${t} max: ${n}`);const[c,l]=s,m=n-t,d=m===0?0:(c-t)/m*100,v=m===0?100:(l-t)/m*100,p=d<50?1:2,_=v<50?2:1,w=h.useCallback(j=>{if(!u.current)return t;const g=u.current.getBoundingClientRect(),L=Math.max(0,Math.min(100,(j-g.left)/g.width*100)),R=t+L/100*m,$=Math.round(R/i)*i;return Math.max(t,Math.min(n,$))},[t,n,m,i]),N=j=>g=>{g.preventDefault(),o(j)},f=h.useCallback(j=>{if(!a)return;const g=w(j.clientX);r(a==="min"?[Math.min(g,l),l]:[c,Math.max(g,c)])},[a,w,c,l,r]),A=h.useCallback(()=>{o(null)},[]),E=j=>{if(a)return;const g=w(j.clientX),L=Math.abs(g-c),R=Math.abs(g-l);L<R?r([Math.min(g,l),l]):r([c,Math.max(g,c)])};return h.useEffect(()=>a?(document.addEventListener("mousemove",f),document.addEventListener("mouseup",A),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",A)}):()=>{},[a,f,A]),e.jsx("div",{className:"range-slider",children:e.jsx("div",{className:"range-slider__container",children:e.jsxs("div",{ref:u,className:"range-slider__track",onClick:E,children:[e.jsx("div",{className:"range-slider__range",style:{left:`${d}%`,width:`${v-d}%`}}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--min",style:{left:`${d}%`,zIndex:p},onMouseDown:N("min")}),e.jsx("div",{className:"range-slider__thumb range-slider__thumb--max",style:{left:`${v}%`,zIndex:_},onMouseDown:N("max")})]})})})}let tn=class{constructor(n,s){this.uuid=n,this.segments=s}visibleSegments(n){return this.segments.filter(s=>s.end>=n[0]&&s.start<=n[1])}};function pe(t){return new Date(t*1e3).toLocaleString()}const sn=24*60*60;function at(t,n){return[Math.max(t,n-sn),n]}function nn(t){let n=0;for(let a=0;a<t.length;a++)n=(n<<5)-n+t.charCodeAt(a)&4294967295;const s=Math.abs(n)%360,r=45+Math.abs(n>>8)%30,i=45+Math.abs(n>>16)%20;return`hsl(${s}, ${r}%, ${i}%)`}function _e({label:t,value:n}){return e.jsxs("div",{className:"workers__worker__details__item",children:[e.jsx("span",{className:"workers__worker__details__label",children:t}),e.jsx("span",{className:"workers__worker__details__value",children:n})]})}function rn(){const{tests:t}=We(),n=lt(),{showTooltip:s,hideTooltip:r,moveTooltip:i}=ze(),[a,o]=h.useState(new Set),u=as(Array.from(t.values()).map(g=>Array.from(g.reports_by_worker.keys())).flat().sortKey(g=>g)),c=new Map;u.forEach(g=>{const L=[];c.set(g,L),Array.from(t.values()).forEach(R=>{if(!R.reports_by_worker.has(g))return;const $=R.reports_by_worker.get(g);L.push(...$.map(C=>({timestamp_monotonic:C.timestamp_monotonic,nodeid:R.nodeid})))}),L.sortKey(R=>R.timestamp_monotonic)});let l=1/0,m=-1/0,d=[];u.forEach(g=>{const L=c.get(g),R=[];let $=null;L.forEach((C,I)=>{l=Math.min(l,C.timestamp_monotonic),m=Math.max(m,C.timestamp_monotonic),!$||$.nodeid!==C.nodeid?($&&R.push($),$={nodeid:C.nodeid,start:C.timestamp_monotonic,end:C.timestamp_monotonic}):$.end=C.timestamp_monotonic,I===L.length-1&&$&&R.push($)}),d.push(new tn(g,R))}),d.sortKey(g=>g.segments[0].start);const[v,p]=h.useState(at(l,m));h.useEffect(()=>{p(at(l,m))},[l,m]);const[_,w]=v,N=w-_,f=h.useCallback(g=>{let L,R;return N===0?(L=0,R=100):(L=(g.start-_)/N*100,R=(g.end-g.start)/N*100),{left:`${L}%`,width:`${R}%`,backgroundColor:nn(g.nodeid)}},[N,_,w]);function A(g){o(L=>{const R=new Set(L);return R.has(g)?R.delete(g):R.add(g),R})}function E({worker:g,range:L}){return e.jsxs("div",{className:`workers__worker ${a.has(g.uuid)?"workers__worker--expanded":""}`,onClick:()=>A(g.uuid),onMouseLeave:()=>r("workers"),children:[e.jsx("div",{className:"workers__worker__bar",onMouseLeave:()=>r("workers"),children:g.visibleSegments(L).map((R,$)=>e.jsx("div",{className:"workers__timeline__segment",style:f(R),onClick:C=>{St(C,`/tests/${encodeURIComponent(R.nodeid)}`,n),C.stopPropagation()},onMouseEnter:C=>s(kt(R.nodeid),C.clientX,C.clientY,"workers"),onMouseLeave:()=>r("workers"),onMouseMove:C=>i(C.clientX,C.clientY,"workers")},$))}),a.has(g.uuid)&&e.jsx(j,{worker:g})]},g.uuid)}function j({worker:g}){return e.jsx("div",{className:"workers__worker__details",children:e.jsxs("div",{className:"workers__worker__details__grid",children:[e.jsx(_e,{label:"Worker UUID",value:g.uuid}),e.jsx(_e,{label:"Lifetime",value:It(g.segments[g.segments.length-1].end-g.segments[0].start)}),e.jsx(_e,{label:"Started",value:pe(g.segments[0].start)}),e.jsx(_e,{label:"Last seen",value:pe(g.segments[g.segments.length-1].end)})]})})}return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card__header",children:"Workers "}),e.jsxs("div",{className:"card__body",children:[e.jsxs("div",{className:"card__text",children:[e.jsx("div",{className:"card__text__paragraph",children:"This page shows the history of your workers, and what tests they have been fuzzing."}),e.jsx("div",{className:"card__text__paragraph",children:'Roughly speaking, "one worker" = "one CPU core".'})]}),e.jsxs("div",{className:"workers",children:[e.jsx("div",{className:"workers__controls",children:e.jsx(en,{min:l,max:m,value:v,onChange:g=>p(g),step:(m-l)/1e3})}),e.jsxs("div",{className:"workers__timeline-header",children:[e.jsx("span",{className:"workers__timeline-header__label",children:pe(_)}),e.jsx("span",{className:"workers__timeline-header__label",children:pe(w)})]}),d.map(g=>g.visibleSegments(v).length>0&&e.jsx(E,{worker:g,range:v}))]})]})]})}function an(){const t=Ut;return e.jsx(t,{children:e.jsx(xs,{children:e.jsx(Is,{children:e.jsx(js,{children:e.jsx(Wt,{children:e.jsxs(J,{element:e.jsx(Fs,{}),children:[e.jsx(J,{path:"/",element:e.jsx(Zs,{})}),e.jsx(J,{path:"/patches",element:e.jsx(Vs,{})}),e.jsx(J,{path:"/collected",element:e.jsx(Bs,{})}),e.jsx(J,{path:"/workers",element:e.jsx(rn,{})}),e.jsx(J,{path:"/tests/:nodeid",element:e.jsx(Js,{})}),e.jsx(J,{path:"*",element:e.jsx(zs,{})})]})})})})})})}_s.createRoot(document.getElementById("app")).render(e.jsx(Ht.StrictMode,{children:e.jsx(an,{})}));
